require=// modules are defined as an array
// [ module function, map of requireuires ]
//
// map of requireuires is short require name -> numeric require
//
// anything defined in a previous bundle is accessed via the
// orig method which is the requireuire for previous bundles

(function outer (modules, cache, entry) {
    // Save the require from previous bundle to this closure if any
    var previousRequire = typeof require == "function" && require;

    function findProxyquireifyName() {
        var deps = Object.keys(modules)
            .map(function (k) { return modules[k][1]; });

        for (var i = 0; i < deps.length; i++) {
            var pq = deps[i]['proxyquireify'];
            if (pq) return pq;
        }
    }

    var proxyquireifyName = findProxyquireifyName();

    function newRequire(name, jumped){
        // Find the proxyquireify module, if present
        var pqify = (proxyquireifyName != null) && cache[proxyquireifyName];

        // Proxyquireify provides a separate cache that is used when inside
        // a proxyquire call, and is set to null outside a proxyquire call.
        // This allows the regular caching semantics to work correctly both
        // inside and outside proxyquire calls while keeping the cached
        // modules isolated.
        // When switching from one proxyquire call to another, it clears
        // the cache to prevent contamination between different sets
        // of stubs.
        var currentCache = (pqify && pqify.exports._cache) || cache;

        if(!currentCache[name]) {
            if(!modules[name]) {
                // if we cannot find the the module within our internal map or
                // cache jump to the current global require ie. the last bundle
                // that was added to the page.
                var currentRequire = typeof require == "function" && require;
                if (!jumped && currentRequire) return currentRequire(name, true);

                // If there are other bundles on this page the require from the
                // previous one is saved to 'previousRequire'. Repeat this as
                // many times as there are bundles until the module is found or
                // we exhaust the require chain.
                if (previousRequire) return previousRequire(name, true);
                var err = new Error('Cannot find module \'' + name + '\'');
                err.code = 'MODULE_NOT_FOUND';
                throw err;
            }
            var m = currentCache[name] = {exports:{}};

            // The normal browserify require function
            var req = function(x){
                var id = modules[name][1][x];
                return newRequire(id ? id : x);
            };

            // The require function substituted for proxyquireify
            var moduleRequire = function(x){
                var pqify = (proxyquireifyName != null) && cache[proxyquireifyName];
                // Only try to use the proxyquireify version if it has been `require`d
                if (pqify && pqify.exports._proxy) {
                    return pqify.exports._proxy(req, x);
                } else {
                    return req(x);
                }
            };

            modules[name][0].call(m.exports,moduleRequire,m,m.exports,outer,modules,currentCache,entry);
        }
        return currentCache[name].exports;
    }
    for(var i=0;i<entry.length;i++) newRequire(entry[i]);

    // Override the current require with this new one
    return newRequire;
})
({1:[function(require,module,exports){
// shim for using process in browser
var process = module.exports = {};

// cached from whatever global is present so that test runners that stub it
// don't break things.  But we need to wrap it in a try catch in case it is
// wrapped in strict mode code which doesn't define any globals.  It's inside a
// function because try/catches deoptimize in certain engines.

var cachedSetTimeout;
var cachedClearTimeout;

function defaultSetTimout() {
    throw new Error('setTimeout has not been defined');
}
function defaultClearTimeout () {
    throw new Error('clearTimeout has not been defined');
}
(function () {
    try {
        if (typeof setTimeout === 'function') {
            cachedSetTimeout = setTimeout;
        } else {
            cachedSetTimeout = defaultSetTimout;
        }
    } catch (e) {
        cachedSetTimeout = defaultSetTimout;
    }
    try {
        if (typeof clearTimeout === 'function') {
            cachedClearTimeout = clearTimeout;
        } else {
            cachedClearTimeout = defaultClearTimeout;
        }
    } catch (e) {
        cachedClearTimeout = defaultClearTimeout;
    }
} ())
function runTimeout(fun) {
    if (cachedSetTimeout === setTimeout) {
        //normal enviroments in sane situations
        return setTimeout(fun, 0);
    }
    // if setTimeout wasn't available but was latter defined
    if ((cachedSetTimeout === defaultSetTimout || !cachedSetTimeout) && setTimeout) {
        cachedSetTimeout = setTimeout;
        return setTimeout(fun, 0);
    }
    try {
        // when when somebody has screwed with setTimeout but no I.E. maddness
        return cachedSetTimeout(fun, 0);
    } catch(e){
        try {
            // When we are in I.E. but the script has been evaled so I.E. doesn't trust the global object when called normally
            return cachedSetTimeout.call(null, fun, 0);
        } catch(e){
            // same as above but when it's a version of I.E. that must have the global object for 'this', hopfully our context correct otherwise it will throw a global error
            return cachedSetTimeout.call(this, fun, 0);
        }
    }


}
function runClearTimeout(marker) {
    if (cachedClearTimeout === clearTimeout) {
        //normal enviroments in sane situations
        return clearTimeout(marker);
    }
    // if clearTimeout wasn't available but was latter defined
    if ((cachedClearTimeout === defaultClearTimeout || !cachedClearTimeout) && clearTimeout) {
        cachedClearTimeout = clearTimeout;
        return clearTimeout(marker);
    }
    try {
        // when when somebody has screwed with setTimeout but no I.E. maddness
        return cachedClearTimeout(marker);
    } catch (e){
        try {
            // When we are in I.E. but the script has been evaled so I.E. doesn't  trust the global object when called normally
            return cachedClearTimeout.call(null, marker);
        } catch (e){
            // same as above but when it's a version of I.E. that must have the global object for 'this', hopfully our context correct otherwise it will throw a global error.
            // Some versions of I.E. have different rules for clearTimeout vs setTimeout
            return cachedClearTimeout.call(this, marker);
        }
    }



}
var queue = [];
var draining = false;
var currentQueue;
var queueIndex = -1;

function cleanUpNextTick() {
    if (!draining || !currentQueue) {
        return;
    }
    draining = false;
    if (currentQueue.length) {
        queue = currentQueue.concat(queue);
    } else {
        queueIndex = -1;
    }
    if (queue.length) {
        drainQueue();
    }
}

function drainQueue() {
    if (draining) {
        return;
    }
    var timeout = runTimeout(cleanUpNextTick);
    draining = true;

    var len = queue.length;
    while(len) {
        currentQueue = queue;
        queue = [];
        while (++queueIndex < len) {
            if (currentQueue) {
                currentQueue[queueIndex].run();
            }
        }
        queueIndex = -1;
        len = queue.length;
    }
    currentQueue = null;
    draining = false;
    runClearTimeout(timeout);
}

process.nextTick = function (fun) {
    var args = new Array(arguments.length - 1);
    if (arguments.length > 1) {
        for (var i = 1; i < arguments.length; i++) {
            args[i - 1] = arguments[i];
        }
    }
    queue.push(new Item(fun, args));
    if (queue.length === 1 && !draining) {
        runTimeout(drainQueue);
    }
};

// v8 likes predictible objects
function Item(fun, array) {
    this.fun = fun;
    this.array = array;
}
Item.prototype.run = function () {
    this.fun.apply(null, this.array);
};
process.title = 'browser';
process.browser = true;
process.env = {};
process.argv = [];
process.version = ''; // empty string to avoid regexp issues
process.versions = {};

function noop() {}

process.on = noop;
process.addListener = noop;
process.once = noop;
process.off = noop;
process.removeListener = noop;
process.removeAllListeners = noop;
process.emit = noop;
process.prependListener = noop;
process.prependOnceListener = noop;

process.listeners = function (name) { return [] }

process.binding = function (name) {
    throw new Error('process.binding is not supported');
};

process.cwd = function () { return '/' };
process.chdir = function (dir) {
    throw new Error('process.chdir is not supported');
};
process.umask = function() { return 0; };

},{}],2:[function(require,module,exports){
'use strict';

var has = Object.prototype.hasOwnProperty;

/**
 * Decode a URI encoded string.
 *
 * @param {String} input The URI encoded string.
 * @returns {String} The decoded string.
 * @api private
 */
function decode(input) {
  return decodeURIComponent(input.replace(/\+/g, ' '));
}

/**
 * Simple query string parser.
 *
 * @param {String} query The query string that needs to be parsed.
 * @returns {Object}
 * @api public
 */
function querystring(query) {
  var parser = /([^=?&]+)=?([^&]*)/g
    , result = {}
    , part;

  while (part = parser.exec(query)) {
    var key = decode(part[1])
      , value = decode(part[2]);

    //
    // Prevent overriding of existing properties. This ensures that build-in
    // methods like `toString` or __proto__ are not overriden by malicious
    // querystrings.
    //
    if (key in result) continue;
    result[key] = value;
  }

  return result;
}

/**
 * Transform a query string to an object.
 *
 * @param {Object} obj Object that should be transformed.
 * @param {String} prefix Optional prefix.
 * @returns {String}
 * @api public
 */
function querystringify(obj, prefix) {
  prefix = prefix || '';

  var pairs = [];

  //
  // Optionally prefix with a '?' if needed
  //
  if ('string' !== typeof prefix) prefix = '?';

  for (var key in obj) {
    if (has.call(obj, key)) {
      pairs.push(encodeURIComponent(key) +'='+ encodeURIComponent(obj[key]));
    }
  }

  return pairs.length ? prefix + pairs.join('&') : '';
}

//
// Expose the module.
//
exports.stringify = querystringify;
exports.parse = querystring;

},{}],3:[function(require,module,exports){
'use strict';

/**
 * Check if we're required to add a port number.
 *
 * @see https://url.spec.whatwg.org/#default-port
 * @param {Number|String} port Port number we need to check
 * @param {String} protocol Protocol we need to check against.
 * @returns {Boolean} Is it a default port for the given protocol
 * @api private
 */
module.exports = function required(port, protocol) {
  protocol = protocol.split(':')[0];
  port = +port;

  if (!port) return false;

  switch (protocol) {
    case 'http':
    case 'ws':
    return port !== 80;

    case 'https':
    case 'wss':
    return port !== 443;

    case 'ftp':
    return port !== 21;

    case 'gopher':
    return port !== 70;

    case 'file':
    return false;
  }

  return port !== 0;
};

},{}],4:[function(require,module,exports){
(function (global){
'use strict';

var required = require('requires-port')
  , qs = require('querystringify')
  , protocolre = /^([a-z][a-z0-9.+-]*:)?(\/\/)?([\S\s]*)/i
  , slashes = /^[A-Za-z][A-Za-z0-9+-.]*:\/\//;

/**
 * These are the parse rules for the URL parser, it informs the parser
 * about:
 *
 * 0. The char it Needs to parse, if it's a string it should be done using
 *    indexOf, RegExp using exec and NaN means set as current value.
 * 1. The property we should set when parsing this value.
 * 2. Indication if it's backwards or forward parsing, when set as number it's
 *    the value of extra chars that should be split off.
 * 3. Inherit from location if non existing in the parser.
 * 4. `toLowerCase` the resulting value.
 */
var rules = [
  ['#', 'hash'],                        // Extract from the back.
  ['?', 'query'],                       // Extract from the back.
  ['/', 'pathname'],                    // Extract from the back.
  ['@', 'auth', 1],                     // Extract from the front.
  [NaN, 'host', undefined, 1, 1],       // Set left over value.
  [/:(\d+)$/, 'port', undefined, 1],    // RegExp the back.
  [NaN, 'hostname', undefined, 1, 1]    // Set left over.
];

/**
 * These properties should not be copied or inherited from. This is only needed
 * for all non blob URL's as a blob URL does not include a hash, only the
 * origin.
 *
 * @type {Object}
 * @private
 */
var ignore = { hash: 1, query: 1 };

/**
 * The location object differs when your code is loaded through a normal page,
 * Worker or through a worker using a blob. And with the blobble begins the
 * trouble as the location object will contain the URL of the blob, not the
 * location of the page where our code is loaded in. The actual origin is
 * encoded in the `pathname` so we can thankfully generate a good "default"
 * location from it so we can generate proper relative URL's again.
 *
 * @param {Object|String} loc Optional default location object.
 * @returns {Object} lolcation object.
 * @api public
 */
function lolcation(loc) {
  loc = loc || global.location || {};

  var finaldestination = {}
    , type = typeof loc
    , key;

  if ('blob:' === loc.protocol) {
    finaldestination = new URL(unescape(loc.pathname), {});
  } else if ('string' === type) {
    finaldestination = new URL(loc, {});
    for (key in ignore) delete finaldestination[key];
  } else if ('object' === type) {
    for (key in loc) {
      if (key in ignore) continue;
      finaldestination[key] = loc[key];
    }

    if (finaldestination.slashes === undefined) {
      finaldestination.slashes = slashes.test(loc.href);
    }
  }

  return finaldestination;
}

/**
 * @typedef ProtocolExtract
 * @type Object
 * @property {String} protocol Protocol matched in the URL, in lowercase.
 * @property {Boolean} slashes `true` if protocol is followed by "//", else `false`.
 * @property {String} rest Rest of the URL that is not part of the protocol.
 */

/**
 * Extract protocol information from a URL with/without double slash ("//").
 *
 * @param {String} address URL we want to extract from.
 * @return {ProtocolExtract} Extracted information.
 * @api private
 */
function extractProtocol(address) {
  var match = protocolre.exec(address);

  return {
    protocol: match[1] ? match[1].toLowerCase() : '',
    slashes: !!match[2],
    rest: match[3]
  };
}

/**
 * Resolve a relative URL pathname against a base URL pathname.
 *
 * @param {String} relative Pathname of the relative URL.
 * @param {String} base Pathname of the base URL.
 * @return {String} Resolved pathname.
 * @api private
 */
function resolve(relative, base) {
  var path = (base || '/').split('/').slice(0, -1).concat(relative.split('/'))
    , i = path.length
    , last = path[i - 1]
    , unshift = false
    , up = 0;

  while (i--) {
    if (path[i] === '.') {
      path.splice(i, 1);
    } else if (path[i] === '..') {
      path.splice(i, 1);
      up++;
    } else if (up) {
      if (i === 0) unshift = true;
      path.splice(i, 1);
      up--;
    }
  }

  if (unshift) path.unshift('');
  if (last === '.' || last === '..') path.push('');

  return path.join('/');
}

/**
 * The actual URL instance. Instead of returning an object we've opted-in to
 * create an actual constructor as it's much more memory efficient and
 * faster and it pleases my OCD.
 *
 * @constructor
 * @param {String} address URL we want to parse.
 * @param {Object|String} location Location defaults for relative paths.
 * @param {Boolean|Function} parser Parser for the query string.
 * @api public
 */
function URL(address, location, parser) {
  if (!(this instanceof URL)) {
    return new URL(address, location, parser);
  }

  var relative, extracted, parse, instruction, index, key
    , instructions = rules.slice()
    , type = typeof location
    , url = this
    , i = 0;

  //
  // The following if statements allows this module two have compatibility with
  // 2 different API:
  //
  // 1. Node.js's `url.parse` api which accepts a URL, boolean as arguments
  //    where the boolean indicates that the query string should also be parsed.
  //
  // 2. The `URL` interface of the browser which accepts a URL, object as
  //    arguments. The supplied object will be used as default values / fall-back
  //    for relative paths.
  //
  if ('object' !== type && 'string' !== type) {
    parser = location;
    location = null;
  }

  if (parser && 'function' !== typeof parser) parser = qs.parse;

  location = lolcation(location);

  //
  // Extract protocol information before running the instructions.
  //
  extracted = extractProtocol(address || '');
  relative = !extracted.protocol && !extracted.slashes;
  url.slashes = extracted.slashes || relative && location.slashes;
  url.protocol = extracted.protocol || location.protocol || '';
  address = extracted.rest;

  //
  // When the authority component is absent the URL starts with a path
  // component.
  //
  if (!extracted.slashes) instructions[2] = [/(.*)/, 'pathname'];

  for (; i < instructions.length; i++) {
    instruction = instructions[i];
    parse = instruction[0];
    key = instruction[1];

    if (parse !== parse) {
      url[key] = address;
    } else if ('string' === typeof parse) {
      if (~(index = address.indexOf(parse))) {
        if ('number' === typeof instruction[2]) {
          url[key] = address.slice(0, index);
          address = address.slice(index + instruction[2]);
        } else {
          url[key] = address.slice(index);
          address = address.slice(0, index);
        }
      }
    } else if ((index = parse.exec(address))) {
      url[key] = index[1];
      address = address.slice(0, index.index);
    }

    url[key] = url[key] || (
      relative && instruction[3] ? location[key] || '' : ''
    );

    //
    // Hostname, host and protocol should be lowercased so they can be used to
    // create a proper `origin`.
    //
    if (instruction[4]) url[key] = url[key].toLowerCase();
  }

  //
  // Also parse the supplied query string in to an object. If we're supplied
  // with a custom parser as function use that instead of the default build-in
  // parser.
  //
  if (parser) url.query = parser(url.query);

  //
  // If the URL is relative, resolve the pathname against the base URL.
  //
  if (
      relative
    && location.slashes
    && url.pathname.charAt(0) !== '/'
    && (url.pathname !== '' || location.pathname !== '')
  ) {
    url.pathname = resolve(url.pathname, location.pathname);
  }

  //
  // We should not add port numbers if they are already the default port number
  // for a given protocol. As the host also contains the port number we're going
  // override it with the hostname which contains no port number.
  //
  if (!required(url.port, url.protocol)) {
    url.host = url.hostname;
    url.port = '';
  }

  //
  // Parse down the `auth` for the username and password.
  //
  url.username = url.password = '';
  if (url.auth) {
    instruction = url.auth.split(':');
    url.username = instruction[0] || '';
    url.password = instruction[1] || '';
  }

  url.origin = url.protocol && url.host && url.protocol !== 'file:'
    ? url.protocol +'//'+ url.host
    : 'null';

  //
  // The href is just the compiled result.
  //
  url.href = url.toString();
}

/**
 * This is convenience method for changing properties in the URL instance to
 * insure that they all propagate correctly.
 *
 * @param {String} part          Property we need to adjust.
 * @param {Mixed} value          The newly assigned value.
 * @param {Boolean|Function} fn  When setting the query, it will be the function
 *                               used to parse the query.
 *                               When setting the protocol, double slash will be
 *                               removed from the final url if it is true.
 * @returns {URL}
 * @api public
 */
function set(part, value, fn) {
  var url = this;

  switch (part) {
    case 'query':
      if ('string' === typeof value && value.length) {
        value = (fn || qs.parse)(value);
      }

      url[part] = value;
      break;

    case 'port':
      url[part] = value;

      if (!required(value, url.protocol)) {
        url.host = url.hostname;
        url[part] = '';
      } else if (value) {
        url.host = url.hostname +':'+ value;
      }

      break;

    case 'hostname':
      url[part] = value;

      if (url.port) value += ':'+ url.port;
      url.host = value;
      break;

    case 'host':
      url[part] = value;

      if (/:\d+$/.test(value)) {
        value = value.split(':');
        url.port = value.pop();
        url.hostname = value.join(':');
      } else {
        url.hostname = value;
        url.port = '';
      }

      break;

    case 'protocol':
      url.protocol = value.toLowerCase();
      url.slashes = !fn;
      break;

    case 'pathname':
    case 'hash':
      if (value) {
        var char = part === 'pathname' ? '/' : '#';
        url[part] = value.charAt(0) !== char ? char + value : value;
      } else {
        url[part] = value;
      }
      break;

    default:
      url[part] = value;
  }

  for (var i = 0; i < rules.length; i++) {
    var ins = rules[i];

    if (ins[4]) url[ins[1]] = url[ins[1]].toLowerCase();
  }

  url.origin = url.protocol && url.host && url.protocol !== 'file:'
    ? url.protocol +'//'+ url.host
    : 'null';

  url.href = url.toString();

  return url;
}

/**
 * Transform the properties back in to a valid and full URL string.
 *
 * @param {Function} stringify Optional query stringify function.
 * @returns {String}
 * @api public
 */
function toString(stringify) {
  if (!stringify || 'function' !== typeof stringify) stringify = qs.stringify;

  var query
    , url = this
    , protocol = url.protocol;

  if (protocol && protocol.charAt(protocol.length - 1) !== ':') protocol += ':';

  var result = protocol + (url.slashes ? '//' : '');

  if (url.username) {
    result += url.username;
    if (url.password) result += ':'+ url.password;
    result += '@';
  }

  result += url.host + url.pathname;

  query = 'object' === typeof url.query ? stringify(url.query) : url.query;
  if (query) result += '?' !== query.charAt(0) ? '?'+ query : query;

  if (url.hash) result += url.hash;

  return result;
}

URL.prototype = { set: set, toString: toString };

//
// Expose the URL parser and some additional properties that might be useful for
// others or testing.
//
URL.extractProtocol = extractProtocol;
URL.location = lolcation;
URL.qs = qs;

module.exports = URL;

}).call(this,typeof global !== "undefined" ? global : typeof self !== "undefined" ? self : typeof window !== "undefined" ? window : {})
},{"querystringify":2,"requires-port":3}],"/wrapper/src/layers/direct-bidding-layer.js":[function(require,module,exports){
"use strict";function DirectBiddingLayer(e){function r(e){for(var r=[],a=0;a<e.length;a++){for(var s=!1,n=0;n<SpaceCamp.htSlots.length;n++)if(e[a].htSlotName===SpaceCamp.htSlots[n].getName()){s=!0;var o={htSlot:SpaceCamp.htSlots[n],ref:""};e[a].hasOwnProperty("firstPartyData")&&(o.firstPartyData=e[a].firstPartyData),r.push(o)}s||EventsService.emit("error","unrecognized header tag slot name "+e[a].htSlotName+" in call to retrieveDemand")}if(0===r.length)return EventsService.emit("warning","no valid header tag slots found in call to retrieveDemand"),{sessionId:"",promise:Prms.resolve({})};var c=TimerService.createTimer(t,!0);return EventsService.emit("hs_session_start",{sessionId:c}),TimerService.addTimerCallback(c,function(){EventsService.emit("global_timeout_reached",{sessionId:c})}),{promise:i._executeNext(c,r).then(function(e){EventsService.emit("hs_session_end",{sessionId:c});for(var r={slot:{},page:[]},t=0;t<e.length;t++)if(!e[t].pass&&Utilities.isObject(e[t].targeting)&&!Utilities.isEmpty(e[t].targeting))if("slot"===e[t].targetingType){var i=e[t].htSlot.getName();r.slot.hasOwnProperty(i)||(r.slot[i]=[]),r.slot[i].push({targeting:e[t].targeting,price:e[t].price?e[t].price:0,adm:e[t].adm?e[t].adm:"",size:e[t].size?e[t].size:[],partnerId:e[t].partnerId?e[t].partnerId:"",winNotice:e[t].winNotice?e[t].winNotice:System.noOp})}else if("page"===e[t].targetingType){var a={targeting:e[t].targeting,partnerId:e[t].partnerId?e[t].partnerId:""};e.hasOwnProperty("price")&&(a.price=e[t].price),e.hasOwnProperty("adm")&&(a.adm=e[t].adm),r.page.push(a)}return r}),sessionId:c}}var t,i=Layer();!function(){EventsService=SpaceCamp.services.EventsService,TimerService=SpaceCamp.services.TimerService,t=e.globalTimeout,SpaceCamp.globalTimeout=t,i._setDirectInterface("DirectBiddingLayer",{retrieveDemand:r})}();var a={retrieveDemand:r};return Classify.derive(i,a)}var Classify=require("classify.js"),Layer=require("layer.js"),Prms=require("prms.js"),SpaceCamp=require("space-camp.js"),Utilities=require("utilities.js"),Whoopsie=require("whoopsie.js"),System=require("system.js"),EventsService,TimerService;module.exports=DirectBiddingLayer;
},{"classify.js":"/wrapper/src/libs/classify.js","layer.js":"/wrapper/src/layers/layer.js","prms.js":"/wrapper/src/libs/external/prms.js","space-camp.js":"/wrapper/src/space-camp.js","system.js":"/wrapper/src/libs/system.js","utilities.js":"/wrapper/src/libs/utilities.js","whoopsie.js":"/wrapper/src/libs/whoopsie.js"}],"/wrapper/src/layers/gpt-layer.js":[function(require,module,exports){
"use strict";function GptLayer(e){var r,t,__directInterface;return function(){r=Layer(),t={slotDemandHistory:{},globalTimeout:e.globalTimeout},SpaceCamp.globalTimeout=e.globalTimeout,__directInterface={};for(var s=0;s<GptLayerModules.length;s++)__directInterface=Utilities.mergeObjects(__directInterface,GptLayerModules[s](e,t,r._executeNext));r._setDirectInterface("GptLayer",__directInterface)}(),Classify.derive(r,{__baseClass:r,__state:t,__directInterface:__directInterface})}var Classify=require("classify.js"),Layer=require("layer.js"),SpaceCamp=require("space-camp.js"),Utilities=require("utilities.js"),Whoopsie=require("whoopsie.js"),GptLayerModules=[require("gpt-set-targeting.js"),require("gpt-clear-targeting.js"),require("gpt-map-slots.js"),require("gpt-display.js"),require("gpt-refresh.js"),require("gpt-destroy-slots.js"),require("gpt-options.js")];module.exports=GptLayer;
},{"classify.js":"/wrapper/src/libs/classify.js","gpt-clear-targeting.js":"/wrapper/src/modules/gpt-layer/gpt-clear-targeting.js","gpt-destroy-slots.js":"/wrapper/src/modules/gpt-layer/gpt-destroy-slots.js","gpt-display.js":"/wrapper/src/modules/gpt-layer/gpt-display.js","gpt-map-slots.js":"/wrapper/src/modules/gpt-layer/gpt-map-slots.js","gpt-options.js":"/wrapper/src/modules/gpt-layer/gpt-options.js","gpt-refresh.js":"/wrapper/src/modules/gpt-layer/gpt-refresh.js","gpt-set-targeting.js":"/wrapper/src/modules/gpt-layer/gpt-set-targeting.js","layer.js":"/wrapper/src/layers/layer.js","space-camp.js":"/wrapper/src/space-camp.js","utilities.js":"/wrapper/src/libs/utilities.js","whoopsie.js":"/wrapper/src/libs/whoopsie.js"}],"/wrapper/src/layers/identity-layer.js":[function(require,module,exports){
"use strict";function IdentityLayer(e){function t(e,t){return l[e]=T.IN_PROGRESS,new Prms(function(r){t.retrieve().then(function(){l[e]=T.COMPLETE,r()}).catch(function(t){l[e]=T.COMPLETE,r()})})}function r(){for(var e=[],r=Prms.defer(),i=Object.keys(o);i.length;){var n=Utilities.randomSplice(i),s=o[n];if(s.enabled)try{e.push(t(n,s.instance))}catch(e){}}return Prms.all(e).then(function(){r.resolve()}),r}function i(){var e={};for(var t in o)if(o.hasOwnProperty(t)){var r=o[t];if(r.enabled){var i=r.instance.getResults();i&&(e[t]={data:i})}}return e}function n(){for(var e in l)l.hasOwnProperty(e)&&l[e]!==T.COMPLETE&&EventsService.emit("hs_identity_timeout",{statsId:o[e].instance.getStatsId()})}function s(){v===T.NOT_STARTED&&(m=r(),v=T.IN_PROGRESS,m.promise.then(function(){n(),v=T.COMPLETE}),0===f?m.resolve():S||(S=TimerService.createTimer(f,!1,function(){m.resolve()})))}function a(){return v===T.NOT_STARTED?Prms.resolve(null):(v!==T.COMPLETE&&S&&TimerService.startTimer(S),m.promise.then(function(){return i()}))}function c(e,t){return a().then(function(r){if(r&&!Utilities.isEmpty(r))for(var i=0;i<t.length;i++)t[i].identityData=r;return u._executeNext(e,t)})}var u,o,v,l,f,m,S,T={NOT_STARTED:0,IN_PROGRESS:1,COMPLETE:2};return function(){EventsService=SpaceCamp.services.EventsService,TimerService=SpaceCamp.services.TimerService,u=Layer(),f=e.timeout,v=T.NOT_STARTED,l={},o=e.partners,EventsService.emit("hs_define_identity_timeout",{timeout:f});for(var t=Object.keys(o),r=t.length-1;r>=0;r--){var i=Utilities.randomSplice(t),n=o[i];if(n.enabled)try{if(n.instance=IdentityPartnerConstructors[i](n.configs),!n.instance){n.enabled=!1;continue}l[i]=T.NOT_STARTED}catch(e){n.enabled=!1}}u._setDirectInterface("IdentityLayer",{retrieve:s,getResult:a}),u._setExecutor(c)}(),Classify.derive(u,{__EnumStatuses:T,retrieve:s,getResult:a,__executor:c,__sendStatsTimeouts:n,__getAllPartnerResults:i,__invokeAllPartners:r,__partnerCaller:t})}var Classify=require("classify.js"),Layer=require("layer.js"),Prms=require("prms.js"),SpaceCamp=require("space-camp.js"),Utilities=require("utilities.js"),IdentityPartnerConstructors={AdserverOrgIp:require("adserver-org-ip.js")},EventsService,TimerService;module.exports=IdentityLayer;
},{"adserver-org-ip.js":"/wrapper/src/modules/identity-layer/adserver-org-ip/adserver-org-ip.js","classify.js":"/wrapper/src/libs/classify.js","layer.js":"/wrapper/src/layers/layer.js","prms.js":"/wrapper/src/libs/external/prms.js","space-camp.js":"/wrapper/src/space-camp.js","utilities.js":"/wrapper/src/libs/utilities.js"}],"/wrapper/src/layers/layer.js":[function(require,module,exports){
"use strict";function Layer(){function e(e,r){return Prms.resolve(r)}function r(e,r){__directInterface={},__directInterface[e]=r}function t(e){i=e}function n(){return __directInterface}function u(e){s=e}function o(e,r){return s(e,r)}function c(e,r){return Prms.resolve().then(function(){return i(e,r)})}var __directInterface,i,s;return function(){__directInterface=null,i=e,s=e}(),{__layerLoopBack:e,_setDirectInterface:r,_setExecutor:t,_executeNext:o,setNext:u,getDirectInterface:n,execute:c}}var Prms=require("prms.js"),Whoopsie=require("whoopsie.js");module.exports=Layer;
},{"prms.js":"/wrapper/src/libs/external/prms.js","whoopsie.js":"/wrapper/src/libs/whoopsie.js"}],"/wrapper/src/layers/mediation-layer.js":[function(require,module,exports){
"use strict";function MediationLayer(e){function t(e,t){return r._executeNext(e,t).then(function(t){for(var r={slot:{},partner:{}},i=[],a=t.slice();t.length;){var n=Utilities.randomSplice(t);if(n.htSlot){var o=n.htSlot.getName();n.pass||(n.hasOwnProperty("price")&&Utilities.isNumber(n.price)?(r.slot.hasOwnProperty(o)?r.slot[o].price<n.price&&(r.slot[o]=n):r.slot[o]=n,s===Constants.MediationLevels.PARTNER&&(r.partner[o]=r.partner[o]||{},r.partner[o].hasOwnProperty(n.partnerId)?r.partner[o][n.partnerId].price<n.price&&(r.partner[o][n.partnerId]=n):r.partner[o][n.partnerId]=n)):s===Constants.MediationLevels.PARTNER&&i.push(n))}}for(var p in r.slot)if(r.slot.hasOwnProperty(p)){var l=r.slot[p];if(EventsService.emit("hs_slot_highest_bid",{sessionId:e,statsId:l.partnerStatsId,htSlotId:l.htSlot.getId(),requestId:l.requestId,xSlotNames:[l.xSlotName]}),s===Constants.MediationLevels.HT_SLOT)i.push(l);else if(s===Constants.MediationLevels.PARTNER)for(var c in r.partner[p])r.partner[p].hasOwnProperty(c)&&i.push(r.partner[p][c])}return s===Constants.MediationLevels.NONE?a:i})}var r,s;return function(){EventsService=SpaceCamp.services.EventsService,r=Layer(),r._setExecutor(t),s=Constants.MediationLevels[e.mediationLevel]}(),Classify.derive(r,{__executor:t})}var Classify=require("classify.js"),Layer=require("layer.js"),Constants=require("constants.js"),Utilities=require("utilities.js"),Whoopsie=require("whoopsie.js"),SpaceCamp=require("space-camp.js"),EventsService;module.exports=MediationLayer;
},{"classify.js":"/wrapper/src/libs/classify.js","constants.js":"/wrapper/src/libs/constants.js","layer.js":"/wrapper/src/layers/layer.js","space-camp.js":"/wrapper/src/space-camp.js","utilities.js":"/wrapper/src/libs/utilities.js","whoopsie.js":"/wrapper/src/libs/whoopsie.js"}],"/wrapper/src/layers/partners-layer.js":[function(require,module,exports){
"use strict";function PartnersLayer(e){function r(e,r,t,i,a){if(a&&t.getPrefetchDisabled())return[];var n=i.slice(),s=[],c=t.retrieve(e,n),o=c.map(function(e){var r=Prms.defer();return e.then(function(e){r.resolve(e)}).catch(function(e){r.resolve([])}),r});return Utilities.appendToArray(s,o),s}function t(e,t,i){for(var a={defers:[],promises:[]},n=Object.keys(s);n.length;){var c=Utilities.randomSplice(n),o=s[c];if(o.enabled)try{for(var l=r(e,c,o.instance,t,i),u=0;u<l.length;u++)a.defers.push(l[u]),a.promises.push(l[u].promise)}catch(e){}}return a}function i(e){for(var r in e)if(e.hasOwnProperty(r)&&c.hasOwnProperty(r))for(var t=c[r],i=0;i<t.length;i++){var a=t[i];s.hasOwnProperty(a)&&s[a].instance.setFirstPartyData(e[r])}}function a(e,r){var i=t(e,r);return TimerService.addTimerCallback(e,function(){for(var e=0;e<i.defers.length;e++)i.defers[e].resolve([])}),Prms.all(i.promises).then(function(r){return TimerService.clearTimer(e),r?Utilities.mergeArrays.apply(null,r):[]})}var n,s,c={rubicon:["RubiconHtb","RubiconExtHtb"]};return function(){TimerService=SpaceCamp.services.TimerService,n=Layer(),s=e.partners;for(var r={},t=Object.keys(s),c=t.length-1;c>=0;c--){var o=Utilities.randomSplice(t),l=s[o];if(l.enabled)try{if(l.instance=PartnerConstructors[o](l.configs,o),!l.instance){l.enabled=!1;continue}l.instance.getDirectInterface()&&(r=Utilities.mergeObjects(r,l.instance.getDirectInterface()))}catch(e){l.enabled=!1}}var u={Partners:r,setFirstPartyData:i};n._setDirectInterface("PartnersLayer",u),n._setExecutor(a)}(),Classify.derive(n,{__partners:s,__partnerCaller:r})}var Classify=require("classify.js"),Layer=require("layer.js"),Prms=require("prms.js"),SpaceCamp=require("space-camp.js"),Utilities=require("utilities.js"),Whoopsie=require("whoopsie.js"),PartnerConstructors={DynamicPartnerLoader:require("dynamic-partner-loader.js")},TimerService;module.exports=PartnersLayer;
},{"classify.js":"/wrapper/src/libs/classify.js","dynamic-partner-loader.js":"/wrapper/src/modules/partners-layer/dynamic-partner-loader/dynamic-partner-loader.js","layer.js":"/wrapper/src/layers/layer.js","prms.js":"/wrapper/src/libs/external/prms.js","space-camp.js":"/wrapper/src/space-camp.js","utilities.js":"/wrapper/src/libs/utilities.js","whoopsie.js":"/wrapper/src/libs/whoopsie.js"}],"/wrapper/src/layers/post-gpt-layer.js":[function(require,module,exports){
"use strict";function PostGptLayer(e){function t(e){var t=System.generateUniqueId(),r=document.createElement("div");r.id=t,document.body.appendChild(r);var s=GptHelper.loadGpt();s.cmd.push(function(){window.parent.googletag.pubads().getTargetingKeys().map(function(e){s.pubads().setTargeting(e,window.parent.googletag.pubads().getTargeting(e))});var r=e.getAdUnitPath(),a=[];e.getSizes().map(function(e){a.push([e.getWidth(),e.getHeight()])});var n=e.getTargetingMap(),o=s.defineSlot(r,a,t).addService(s.pubads());for(var g in n)n.hasOwnProperty(g)&&o.setTargeting(g,n[g]);o.setTargeting(i.key,i.value),s.enableServices(),s.display(t)})}function r(e,r,i){return Prms.resolve().then(function(){var o=TimerService.createTimer(a,!0);TimerService.addTimerCallback(o,function(){EventsService.emit("global_timeout_reached",{sessionId:o})});var g=SpaceCamp.htSlots,p=[{reference:e}];p[0].divId=e.getSlotElementId();for(var c={},l=e.getTargetingKeys(),d=0;d<l.length;d++)c[l[d]]=e.getTargeting(l[d]);var u=[],v=e.getSizes(Browser.getViewportWidth(),Browser.getViewportHeight())||e.getSizes();if(!v)return new Prms(function(r){t(e),r()});for(var m=0;m<v.length;m++)u.push([v[m].getWidth(),v[m].getHeight()]);p[0].sizes=u,p[0].targeting=c,p[0].adUnitPath=e.getAdUnitPath();var h=s.filter(g,p),S=s.select(h,p);return Utilities.isEmpty(S)?new Prms(function(r){t(e),r()}):(EventsService.emit("hs_session_start",{sessionId:o}),n._executeNext(o,S).then(function(s){if(EventsService.emit("hs_session_end",{sessionId:o}),0===s.length)return void t(e,o);r.width=s[0].size[0],r.height=s[0].size[1],r.removeAttribute("style"),i.width=s[0].size[0],i.height=s[0].size[1],SpaceCamp.services.RenderService.render(r.contentDocument,s[0].targeting.pubKitAdId)}))})}var i,s,a,n=Layer();!function(){EventsService=SpaceCamp.services.EventsService,TimerService=SpaceCamp.services.TimerService,i=e.lineItemDisablerTargeting,a=e.globalTimeout,SpaceCamp.globalTimeout=a,s=HtSlotMapper(e.slotMapping),n._setDirectInterface("PostGptLayer",{display:r})}();var o={__htSlotMapper:s,__lineItemDisablerTargeting:i,display:r,__displayFallbackAd:t};return Classify.derive(n,o)}var Browser=require("browser.js"),Classify=require("classify.js"),GptHelper=require("gpt-helper.js"),HtSlotMapper=require("ht-slot-mapper.js"),Layer=require("layer.js"),Prms=require("prms.js"),SpaceCamp=require("space-camp.js"),System=require("system.js"),Utilities=require("utilities.js"),Whoopsie=require("whoopsie.js"),EventsService,TimerService;module.exports=PostGptLayer;
},{"browser.js":"/wrapper/src/libs/browser.js","classify.js":"/wrapper/src/libs/classify.js","gpt-helper.js":"/wrapper/src/libs/gpt-helper.js","ht-slot-mapper.js":"/wrapper/src/libs/ht-slot-mapper.js","layer.js":"/wrapper/src/layers/layer.js","prms.js":"/wrapper/src/libs/external/prms.js","space-camp.js":"/wrapper/src/space-camp.js","system.js":"/wrapper/src/libs/system.js","utilities.js":"/wrapper/src/libs/utilities.js","whoopsie.js":"/wrapper/src/libs/whoopsie.js"}],"/wrapper/src/libs/bid-transformer.js":[function(require,module,exports){
"use strict";function BidTransformer(e){function t(t){return e.roundingType===BidTransformer.RoundingTypes.FLOOR?Math.floor(t):t}function r(r){var o=0,s=1,u=r.toString(),a=u.indexOf(".");if(a>-1&&(o=u.length-a-1,u=u.slice(0,a)+u.slice(a+1)),o>=i)o-=i;else{var l=i-o;o=0,u=Utilities.padEnd(u,u.length+l,"0")}u.length>9&&(o-=u.length-9,u=u.slice(0,9)),s=Math.pow(10,o),u=Number(u);var p=e.buckets.length;if(u<e.floor*s)u=0;else if(u>=e.buckets[p-1].max*s)u=e.buckets[p-1].max*s;else{for(var d,c=e.floor,f=0;f<p&&(d=e.buckets[f],!(u<=d.max*s));f++)c=d.max;e.roundingType!==BidTransformer.RoundingTypes.NONE&&(u-=c*s,u/=d.step*s,u=t(u),u*=d.step*s,u+=c*s)}u=u.toString(),o+=n;var g=u.length-o;g<1&&(u=Utilities.padStart(u,u.length+(1-g),"0"),g=1);var h=u.slice(0,g);return 0!==e.outputPrecision&&(h=h+"."+u.slice(g),e.outputPrecision>0&&(h=o<e.outputPrecision?Utilities.padEnd(h,g+e.outputPrecision+1,"0"):h.slice(0,g+e.outputPrecision+1))),h}var i,n,o={floor:0,buckets:[{max:1/0,step:1}]};return function(){i=Math.round(Math.log(e.bidUnitInCents)*Math.LOG10E),n=Math.round(Math.log(e.outputCentsDivisor)*Math.LOG10E),e.roundingType=BidTransformer.RoundingTypes[e.roundingType];for(var t=["floor","buckets"],r=0;r<t.length;r++){var s=t[r];e.hasOwnProperty(s)||(e[s]=o[s])}}(),{apply:r}}var Utilities=require("utilities.js"),Whoopsie=require("whoopsie.js");BidTransformer.RoundingTypes={NONE:0,FLOOR:1},module.exports=BidTransformer;
},{"utilities.js":"/wrapper/src/libs/utilities.js","whoopsie.js":"/wrapper/src/libs/whoopsie.js"}],"/wrapper/src/libs/browser.js":[function(require,module,exports){
"use strict";function Browser(){function t(t,e){return t=t||"http:",e=e||"https:","https:"===document.location.protocol?e:t}function e(){return("CSS1Compat"===w.document.compatMode?w.document.documentElement:w.document.body).clientWidth}function n(){return("CSS1Compat"===w.document.compatMode?w.document.documentElement:w.document.body).clientHeight}function r(){return w.screen.width}function o(){return w.screen.height}function i(){return document.referrer}function a(){return w.location.hostname}function u(){return navigator.userAgent}function c(){return navigator.language||navigator.browserLanguage||navigator.userLanguage||navigator.systemLanguage}function l(){return w.location.pathname}function s(){try{return window.top===window.self}catch(t){return!1}}function g(){return s()?location.href:document.referrer||location.href}function d(){try{return localStorage.setItem("test","test"),localStorage.removeItem("test"),!0}catch(t){return!1}}function h(t,e,n,r){try{for(var o,i=window,a=0;;)if(!(n&&a<n)){if(r&&a>r)break;if(t&&(o=t(i)))return o;var u;try{u=i.frameElement}catch(t){u=null}if(null===u){if(e&&(o=e(i)))return o;break}i=i.parent,a++}}catch(t){}return null}function m(t){return h(function(e){return e.hasOwnProperty(t)?e[t]:null})}function f(t,e){var n=e||w,r=n.document.createElement("iframe");return t&&(r.src=t),r.width=0,r.height=0,r.scrolling="no",r.marginWidth=0,r.marginHeight=0,r.frameBorder=0,r.setAttribute("style","border: 0px; vertical-align: bottom; visibility: hidden; display: none;"),n.document.body.appendChild(r),r}function p(t){var e=t+"=",n=w.document.cookie.split(";");for(var r in n)if(n.hasOwnProperty(r)){for(var o=n[r];" "===o.charAt(0);)o=o.substring(1,o.length);if(0===o.indexOf(e))return o.substring(e.length,o.length)}return null}function v(){var t=!1;try{new window.ActiveXObject("ShockwaveFlash.ShockwaveFlash")&&(t=!0)}catch(e){navigator.mimeTypes&&void 0!==navigator.mimeTypes["application/x-shockwave-flash"]&&navigator.mimeTypes["application/x-shockwave-flash"].enabledPlugin&&(t=!0)}return t}var w;return function(){w=h(null,function(t){return t})}(),{topWindow:w,getProtocol:t,isLocalStorageSupported:d,getViewportWidth:e,getViewportHeight:n,isTopFrame:s,getScreenWidth:r,getScreenHeight:o,getReferrer:i,getPageUrl:g,getHostname:a,getUserAgent:u,getLanguage:c,getPathname:l,getNearestEntity:m,traverseContextTree:h,createHiddenIFrame:f,readCookie:p,isFlashSupported:v}}var Whoopsie=require("whoopsie.js");module.exports=Browser();
},{"whoopsie.js":"/wrapper/src/libs/whoopsie.js"}],"/wrapper/src/libs/cache.js":[function(require,module,exports){
"use strict";function Cache(){function t(t){if(!i)return!1;try{localStorage.removeItem(u+t)}catch(t){return!1}return!0}function e(e){if(!i)return null;var r;try{r=JSON.parse(localStorage.getItem(u+e))}catch(t){return null}return null===r?null:!r.e||r.e<System.now()?(t(e),null):Utilities.isObject(r.d)?r.d:null}function r(t,e,r){if(!i)return!1;r>a&&(r=a);var n=System.now(),l={t:n,d:e,e:n+r};try{localStorage.setItem(u+t,JSON.stringify(l))}catch(t){return!1}return!0}function n(t){i=t}var i,u="IXWRAPPER",a=6048e5;return function(){i=Browser.isLocalStorageSupported()}(),{setLocalStorageAvailability:n,deleteData:t,getData:e,setData:r}}var Browser=require("browser.js"),Utilities=require("utilities.js"),System=require("system.js");module.exports=Cache();
},{"browser.js":"/wrapper/src/libs/browser.js","system.js":"/wrapper/src/libs/system.js","utilities.js":"/wrapper/src/libs/utilities.js"}],"/wrapper/src/libs/classify.js":[function(require,module,exports){
"use strict";function Classify(){function r(r){for(var e in r)r.hasOwnProperty(e)&&"_"===e[0]&&"__"!==e.slice(0,2)&&delete r[e];return r}function e(e,o){var n,s={};for(n in e)e.hasOwnProperty(n)&&(s[n]=e[n]);for(n in o)o.hasOwnProperty(n)&&(s[n]=o[n]);return r(s)}return{__removeProtectedMembers:r,derive:e}}var Whoopsie=require("whoopsie.js");module.exports=Classify();
},{"whoopsie.js":"/wrapper/src/libs/whoopsie.js"}],"/wrapper/src/libs/command-queue.js":[function(require,module,exports){
"use strict";function CommandQueue(i){function t(i){if(Utilities.isFunction(i))try{i()}catch(i){}}return function(){if(Utilities.isArray(i))for(var t=0;t<i.length;t++)try{i[t]()}catch(i){}}(),{push:t}}var Utilities=require("utilities.js");module.exports=CommandQueue;
},{"utilities.js":"/wrapper/src/libs/utilities.js"}],"/wrapper/src/libs/config-validators.js":[function(require,module,exports){
"use strict";var Constants=require("./constants.js"),Inspector=require("./external/schema-inspector.js"),ConfigValidators={PostGptLayer:function(e){var t=Inspector.validate({type:"object",strict:!0,properties:{lineItemDisablerTargeting:{type:"object",properties:{key:{type:"string",minLength:1},value:{type:"array",minLength:1,items:{type:"string"}}}},globalTimeout:{type:"integer",gte:0},slotMapping:{type:"object"}}},e);return t.valid?null:t.format()},GptLayer:function(e){var t=Inspector.validate({type:"object",properties:{globalTimeout:{type:"integer",gte:0},enableSingleRequest:{type:"boolean",optional:!0},disableInitialLoad:{type:"boolean",optional:!0},slotMapping:{optional:!0,type:"object",properties:{selectors:{type:"array",items:{type:["array","string"],minLength:1,items:{type:"string",minLength:1}}},filters:{type:"array",items:{type:"string",minLength:1}}}}}},e);return t.valid?null:t.format()},IdentityLayer:function(e,t){var r=Inspector.validate({type:"object",strict:!0,properties:{timeout:{type:"integer",gte:0},partners:{type:"object",properties:{"*":{type:"object",properties:{configs:{type:"object"},enabled:{type:"boolean"}}}}}}},e);if(!r.valid)return r.format();for(var n in e.partners)if(e.partners.hasOwnProperty(n)&&-1===t.indexOf(n))return'Identity partner ID "'+n+'" is unrecognized';return null},PartnersLayer:function(e,t){var r=Inspector.validate({type:"object",strict:!0,properties:{prefetchOnLoad:{optional:!0,type:"object",strict:!0,properties:{enabled:{type:"boolean"},configs:{optional:!0,type:"object",strict:!0,properties:{dynamic:{optional:!0,type:"object",strict:!0,properties:{var:{optional:!0,type:"string",minLength:1},slotMapping:{type:"object",strict:!0,properties:{style:{type:"string",eq:["ALL","SINGLE"]},selectors:{type:"array",minLength:1,items:{type:["array","string"],minLength:1,items:{type:"string",minLength:1}}},filters:{type:"array",items:{type:"string",minLength:1}}}}}},pageType:{optional:!0,type:"object",strict:!0,properties:{var:{optional:!0,type:"string",minLength:1},mapping:{type:"object",strict:!0,properties:{"*":{type:"array",items:{type:"string",minLength:1}}}}}},fixed:{optional:!0,type:"object",strict:!0,properties:{htSlotNames:{type:"array",items:{type:"string",minLength:1}}}}}}}},partners:{type:"object",properties:{"*":{type:"object",properties:{configs:{type:"object"},enabled:{type:"boolean"}}}}}}},e);if(!r.valid)return r.format();for(var n in e.partners)if(e.partners.hasOwnProperty(n)&&-1===t.indexOf(n))return'Partner ID "'+n+'" is unrecognized';return null},DirectBiddingLayer:function(e){var t=Inspector.validate({type:"object",strict:!0,properties:{globalTimeout:{type:"integer",gte:0}}},e);return t.valid?null:t.format()},MediationLayer:function(e){var t=Inspector.validate({type:"object",strict:!0,properties:{mediationLevel:{type:"string",eq:["NONE","HT_SLOT","PARTNER"]}}},e);return t.valid?null:t.format()},PreGptLayer:function(){return null},StorageLayer:function(){return null},ModuleLoader:function(e,t,r){var n=Inspector.validate({type:"object",properties:{htSlots:{type:"object"},Services:{type:"object",properties:{"*":{type:"object"}}},Layers:{type:"array",minLength:1,items:{type:"object",properties:{layerId:{type:"string",minLength:1},configs:{type:"object"}}}}}},e);if(!n.valid)return n.format();for(var i in e.Services)if(-1===t.indexOf(i))return"members of `configs.Services` must be one of the predefined values in `ServiceConstructors`";for(var o=0;o<e.Layers.length;o++)if(-1===r.indexOf(e.Layers[o].layerId))return"`configs.Layers["+o+"].layerId` must be one of the predefined values in `LayerConstructors`";return null},HeaderTagSlot:function(e,t){var r=Inspector.validate({type:"object",strict:!0,properties:{id:{type:"string"},divId:{optional:!0,type:"string"},adUnitPath:{optional:!0,type:"string"},sizeMapping:{optional:!0,type:"object",properties:{"*":{type:"array",minLength:1,items:{type:"array",exactLength:2,items:{type:"integer",gte:0}}}}},targeting:{optional:!0,type:"array",items:{type:"object",properties:{"*":{type:"array",minLength:1,items:{type:"string",minLength:1}}}}},deviceType:{optional:!0,type:"string",minLength:1},position:{type:"string",eq:["atf","btf"],optional:!0}}},e);if(!r.valid)return"Invalid config: "+r.format();if(r=Inspector.validate({type:"string",minLength:1},t),!r.valid)return"Invalid ID: "+r.format();if(!e.hasOwnProperty("sizeMapping"))return'`config` must have property "sizeMapping"';var n=/^(\d+)x(\d+)$/,i=0;for(var o in e.sizeMapping)if(e.sizeMapping.hasOwnProperty(o)){if(!1===n.test(o))return"Keys of `config.sizeMapping` must be of form `widthxheight`";i++}return 0===i?"`config.sizeMapping` must not be empty":null},PartnerProfile:function(e,t,r){var n=Inspector.validate({type:"object",strict:!0,properties:{profile:{type:"object",strict:!0,properties:{partnerId:{type:"string",minLength:1},namespace:{type:"string",minLength:1},statsId:{type:"string",minLength:1},version:{type:"string",minLength:1,optional:!0},targetingType:{type:"string",eq:["page","slot"]},bidUnitInCents:{type:"number",gt:0,optional:!0,exec:function(e,t){(t>1&&t%10!=0||t<1&&!/^0\.0*1$/.test(t.toString()))&&this.report("must be a power of 10")}},enabledAnalytics:{type:"object",properties:{"*":{type:"boolean"}}},features:{type:"object",properties:{"*":{type:"object",strict:!0,properties:{enabled:{type:"boolean"},value:{type:"any"}}},prefetchDisabled:{optional:!0,type:"object",strict:!0,properties:{enabled:{type:"boolean"}}}}},targetingKeys:{type:"object",strict:!0,properties:{id:{optional:!0,type:"string",minLength:1},om:{optional:!0,type:"string",minLength:1},pm:{optional:!0,type:"string",minLength:1},pmid:{optional:!0,type:"string",minLength:1},ybot_ad:{optional:!0,type:"string",minLength:1},ybot_size:{optional:!0,type:"string",minLength:1},ybot_cpm:{optional:!0,type:"string",minLength:1},ybot_slot:{optional:!0,type:"string",minLength:1},retargeter:{optional:!0,type:"string",minLength:1}}},lineItemType:{type:"integer",exec:function(e,t){var r=!1;for(var n in Constants.LineItemTypes)if(Constants.LineItemTypes.hasOwnProperty(n)&&Constants.LineItemTypes[n]===t){r=!0;break}r||this.report("must be one of the predefined values in `Constants.LineItemTypes`")}},callbackType:{type:"integer"},architecture:{type:"integer"},parseAfterTimeout:{type:"boolean",optional:!0},requestType:{type:"integer"}}},requiredResources:{type:["array","null"],items:{type:"string",minLength:1}},fns:{type:"object",exec:function(e,t){for(var r in t)t.hasOwnProperty(r)&&"function"!=typeof t[r]&&this.report(r+" must be a function, is "+typeof t[r]);t.hasOwnProperty("retriever")?(t.hasOwnProperty("parseResponse")||t.hasOwnProperty("generateRequestObj")||t.hasOwnProperty("adResponseCallback"))&&this.report("must either have retriever or the other three."):t.hasOwnProperty("parseResponse")||t.hasOwnProperty("generateRequestObj")||this.report("must either have retriever or the other three.")}}}},{profile:e,requiredResources:t,fns:r});return n.valid?null:n.format()},partnerBaseConfig:function(e){var t=Inspector.validate({type:"object",properties:{timeout:{optional:!0,type:"integer",gte:0},xSlots:{type:"object",properties:{"*":{type:"object"}}},mapping:{type:"object",properties:{"*":{type:"array",items:{type:"string",minLength:1,exec:function(e,t){this.origin.xSlots&&!this.origin.xSlots.hasOwnProperty(t)&&this.report("`configs.mapping` must map htSlotsNames to partner slots defined in `configs.xSlots`")}}}}},targetingKeyOverride:{optional:!0,type:"object",properties:{"*":{type:"string",minLength:1}}},lineItemType:{type:"string",optional:!0,exec:function(e,t){t&&!Constants.LineItemTypes.hasOwnProperty(t)&&this.report(t+" must be one of the predefined values in `Constants.LineItemTypes`")}},bidTransformer:{type:"object",optional:!0,exec:function(e,t){if(t){var r=ConfigValidators.bidTransformerConfig(t);null!==r&&this.report(r)}}}}},e);return t.valid?null:t.format()},bidTransformerConfig:function(e){var t=Inspector.validate({type:"object",optional:!0,strict:!0,properties:{bidUnitInCents:{type:"number",gt:0,optional:!0,exec:function(e,t){(t>1&&t%10!=0||t<1&&!/^0\.0*1$/.test(t.toString()))&&this.report("must be a power of 10")}},outputCentsDivisor:{type:"number",gt:0,optional:!0,exec:function(e,t){(t>1&&t%10!=0||t<1&&!/^0\.0*1$/.test(t.toString()))&&this.report("must be a power of 10")}},outputPrecision:{type:"integer",gte:-1,optional:!0},roundingType:{type:"string",eq:["NONE","FLOOR"],optional:!0},floor:{type:"integer",gte:0,optional:!0},buckets:{type:"array",minLenth:1,items:{type:"object",properties:{max:{type:["integer","string"],gt:0,exec:function(e,t){"string"==typeof t&&"infinity"!==t&&this.report('The only acceptable string for bucket max is "infinity". Please check your config.')}},step:{type:"integer",gt:0}}},optional:!0}},exec:function(e,t){if(t){if(t.hasOwnProperty("floor")&&!t.hasOwnProperty("buckets")||!t.hasOwnProperty("floor")&&t.hasOwnProperty("buckets"))return void this.report("`configs.floor` and `configs.buckets` must be configured together");if(t.hasOwnProperty("floor")&&t.hasOwnProperty("buckets"))for(var r=t.floor,n=0;n<t.buckets.length;n++){var i=t.buckets[n].max,o=t.buckets[n].step;if("infinity"===i&&(i=1/0),i<=r)return void this.report("`configs.buckets["+n+"].max` is not in ascending order");if(i!==1/0&&(i-r)%o!=0)return void this.report("`configs.buckets["+n+"].step` must evenly divide its range");r=i}}}},e);return t.valid?null:t.format()},EventsService:function(){return null},HeaderStatsService:function(e){var t=Inspector.validate({type:"object",properties:{siteId:{type:"string",minLength:1},configId:{type:"string",minLength:1},options:{type:"object",properties:{auctionCycle:{type:"boolean"}}}}},e);return t.valid?null:t.format()},RenderService:function(e){var t=Inspector.validate({type:"object",properties:{sizeRetargeting:{optional:!0,type:"object",properties:{"*":{type:"array",exactLength:2,items:{type:"integer"}}}}}},e);if(!t.valid)return t.format();if(e.sizeRetargeting)for(var r in e.sizeRetargeting)if(e.sizeRetargeting.hasOwnProperty(r)&&!/^[0-9]+x[0-9]+$/.test(r))return"Invalid sizeRetargeting key `"+r+"`, must be format `widthxheight`";return null},TimerService:function(){return null},ComplianceService:function(e){var t=Inspector.validate({type:"object",strict:!0,properties:{gdprAppliesDefault:{type:"boolean"},timeout:{type:"integer",gte:0},customFn:{type:"string",optional:!0}}},e);return t.valid?null:t.format()},HtSlotMapper:function(e,t){var r=Inspector.validate({type:"object",properties:{selectors:{type:"array",minLength:1,items:{type:["array","string"],minLength:1,items:{type:"string",minLength:1}}},filters:{type:"array",items:{type:"string",minLength:1}}}},e);if(!r.valid)return r.format();for(var n=0;n<e.selectors.length;n++){var i=e.selectors[n];if("string"==typeof i){if(-1===t.indexOf(i))return"Unrecognized selector `"+i+"`"}else for(var o=0;o<i.length;o++){var p=i[o];if(-1===t.indexOf(p))return"Unrecognized selector `"+p+"`"}}for(var s=0;s<e.filters.length;s++){var a=e.filters[s];if(-1===t.indexOf(a))return"Unrecognized filter `"+a+"`"}return null},DeviceTypeChecker:function(e){var t=Inspector.validate({type:"object",strict:!0,properties:{method:{type:"string",eq:Object.keys(Constants.DeviceTypeMethods)},configs:{optional:!0,type:"object"}}},e);if(!t.valid)return t.format();if("REFERENCE"===e.method&&(t=Inspector.validate({type:"object",strict:!0,properties:{reference:{type:"string",minLength:1}}},e.configs)),"SIZE_MAPPING"===e.method&&(t=Inspector.validate({type:"object",strict:!0,properties:{sizeMapping:{type:"object",properties:{"*":{type:"string",minLength:1}}}}},e.configs),e.configs.hasOwnProperty("sizeMapping"))){var r=/^(\d+)x(\d+)$/,n=0;for(var i in e.configs.sizeMapping)if(e.configs.sizeMapping.hasOwnProperty(i)){if(!1===r.test(i))return"Keys of `configs.sizeMapping` must be of form `widthxheight`";n++}if(0===n)return"`configs.sizeMapping` must not be empty"}return t.valid?null:t.format()}};module.exports=ConfigValidators;
},{"./constants.js":"/wrapper/src/libs/constants.js","./external/schema-inspector.js":"/wrapper/src/libs/external/schema-inspector.js"}],"/wrapper/src/libs/constants.js":[function(require,module,exports){
"use strict";var Constants={DEFAULT_UID_LENGTH:8,MIN_BANNER_DIMENSION:1,MIN_BID_FLOOR:0,MIN_SITE_ID:0,DEFAULT_UID_CHARSET:"ALPHANUM",SESSION_ID_LENGTH:8,PUBKIT_AD_ID_LENGTH:16,RENDER_SERVICE_EXPIRY_SWEEP_TIMER:3e4,LineItemTypes:{ID_AND_SIZE:1,ID_AND_PRICE:2,CUSTOM:3},DeviceTypeMethods:{USER_AGENT:1,REFERENCE:2,SIZE_MAPPING:3},RequestArchitectures:{MRA:1,SRA:2},InitialLoadStates:{DISABLED:1,ENABLED:2},MediationLevels:{NONE:1,HT_SLOT:2,PARTNER:3}};module.exports=Constants;
},{}],"/wrapper/src/libs/device-type-checker.js":[function(require,module,exports){
"use strict";function DeviceTypeChecker(e){function i(){return Device.mobile()?DeviceTypeChecker.DeviceTypes.MOBILE:(Device.tablet(),DeviceTypeChecker.DeviceTypes.DESKTOP)}function t(){var i;try{i=eval(e.configs.reference)}catch(e){throw Whoopsie("INTERNAL_ERROR","DeviceTypeChecker: could not eval() `reference`.")}if(!Utilities.isFunction(i)){if(Utilities.isString(i))return i;throw Whoopsie("INVALID_TYPE","DeviceTypeChecker: `reference` must refer to a function or a string")}try{return i()}catch(e){throw Whoopsie("INTERNAL_ERROR","DeviceTypeChecker: could not execute `reference` function.")}}function c(){switch(r){case Constants.DeviceTypeMethods.USER_AGENT:return i();case Constants.DeviceTypeMethods.REFERENCE:return t();default:return i()}}var r;return function(){r=Constants.DeviceTypeMethods[e.method]||Constants.DeviceTypeMethods.USER_AGENT}(),{getDeviceType:c}}var Constants=require("constants.js"),Utilities=require("utilities.js"),Whoopsie=require("whoopsie.js"),Device=require("device.js");DeviceTypeChecker.isValidDeviceType=function(e){for(var i in DeviceTypeChecker.DeviceTypes)if(DeviceTypeChecker.DeviceTypes.hasOwnProperty(i)&&"TABLET"!==i&&e===DeviceTypeChecker.DeviceTypes[i])return!0;return!1},DeviceTypeChecker.DeviceTypes={DESKTOP:"desktop",MOBILE:"mobile",TABLET:"tablet"},module.exports=DeviceTypeChecker;
},{"constants.js":"/wrapper/src/libs/constants.js","device.js":"/wrapper/src/libs/external/device.js","utilities.js":"/wrapper/src/libs/utilities.js","whoopsie.js":"/wrapper/src/libs/whoopsie.js"}],"/wrapper/src/libs/external/async.js":[function(require,module,exports){
(function (process,global){
!function(n,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports):"function"==typeof define&&define.amd?define(["exports"],t):t(n.async=n.async||{})}(this,function(n){"use strict";function t(n){return n}function e(n,t,e){switch(e.length){case 0:return n.call(t);case 1:return n.call(t,e[0]);case 2:return n.call(t,e[0],e[1]);case 3:return n.call(t,e[0],e[1],e[2])}return n.apply(t,e)}function r(n,t,r){return t=nt(void 0===t?n.length-1:t,0),function(){for(var u=arguments,o=-1,i=nt(u.length-t,0),c=Array(i);++o<i;)c[o]=u[t+o];o=-1;for(var f=Array(t+1);++o<t;)f[o]=u[o];return f[t]=r(c),e(n,this,f)}}function u(n){return function(){return n}}function o(n){var t=typeof n;return null!=n&&("object"==t||"function"==t)}function i(n){var t=o(n)?ot.call(n):"";return t==tt||t==et||t==rt}function c(n){return!!lt&&lt in n}function f(n){if(null!=n){try{return pt.call(n)}catch(n){}try{return n+""}catch(n){}}return""}function a(n){return!(!o(n)||c(n))&&(i(n)?bt:yt).test(f(n))}function l(n,t){return null==n?void 0:n[t]}function s(n,t){var e=l(n,t);return a(e)?e:void 0}function p(n,e){return xt(r(n,e,t),n+"")}function h(n){return p(function(t,e){var r=Et(function(e,r){var u=this;return n(t,function(n,t){n.apply(u,e.concat([t]))},r)});return e.length?r.apply(this,e):r})}function y(n){return"number"==typeof n&&n>-1&&n%1==0&&n<=Lt}function v(n){return null!=n&&y(n.length)&&!i(n)}function d(){}function m(n){return function(){if(null!==n){var t=n;n=null,t.apply(this,arguments)}}}function g(n,t){for(var e=-1,r=Array(n);++e<n;)r[e]=t(e);return r}function b(n){return null!=n&&"object"==typeof n}function j(n){return b(n)&&It.call(n)==Tt}function S(){return!1}function k(n,t){return!!(t=null==t?Wt:t)&&("number"==typeof n||Qt.test(n))&&n>-1&&n%1==0&&n<t}function O(n){return b(n)&&y(n.length)&&!!Gt[Jt.call(n)]}function w(n,t){var e=zt(n),r=!e&&Pt(n),u=!e&&!r&&Ct(n),o=!e&&!r&&!u&&ee(n),i=e||r||u||o,c=i?g(n.length,String):[],f=c.length;for(var a in n)!t&&!ue.call(n,a)||i&&("length"==a||u&&("offset"==a||"parent"==a)||o&&("buffer"==a||"byteLength"==a||"byteOffset"==a)||k(a,f))||c.push(a);return c}function x(n){var t=n&&n.constructor;return n===("function"==typeof t&&t.prototype||oe)}function E(n){if(!x(n))return ie(n);var t=[];for(var e in Object(n))fe.call(n,e)&&"constructor"!=e&&t.push(e);return t}function L(n){return v(n)?w(n):E(n)}function A(n){var t=-1,e=n.length;return function(){return++t<e?{value:n[t],key:t}:null}}function _(n){var t=-1;return function(){var e=n.next();return e.done?null:(t++,{value:e.value,key:t})}}function T(n){var t=L(n),e=-1,r=t.length;return function(){var u=t[++e];return e<r?{value:n[u],key:u}:null}}function F(n){if(v(n))return A(n);var t=_t(n);return t?_(t):T(n)}function I(n){return function(){if(null===n)throw new Error("Callback was already called.");var t=n;n=null,t.apply(this,arguments)}}function B(n){return function(t,e,r){function u(n,t){if(f-=1,n)c=!0,r(n);else{if(t===ae||c&&f<=0)return c=!0,r(null);o()}}function o(){for(;f<n&&!c;){var t=i();if(null===t)return c=!0,void(f<=0&&r(null));f+=1,e(t.value,t.key,I(u))}}if(r=m(r||d),n<=0||!t)return r(null);var i=F(t),c=!1,f=0;o()}}function $(n,t,e,r){B(t)(n,e,r)}function M(n,t){return function(e,r,u){return n(e,t,r,u)}}function P(n,t,e){function r(n){n?e(n):++o===i&&e(null)}e=m(e||d);var u=0,o=0,i=n.length;for(0===i&&e(null);u<i;u++)t(n[u],u,I(r))}function z(n){return function(t,e,r){return n(se,t,e,r)}}function R(n,t,e,r){r=m(r||d),t=t||[];var u=[],o=0;n(t,function(n,t,r){var i=o++;e(n,function(n,t){u[i]=t,r(n)})},function(n){r(n,u)})}function U(n){return function(t,e,r,u){return n(B(e),t,r,u)}}function V(n){return Et(function(t,e){var r;try{r=n.apply(this,t)}catch(n){return e(n)}o(r)&&"function"==typeof r.then?r.then(function(n){e(null,n)},function(n){e(n.message?n:new Error(n))}):e(null,r)})}function D(n,t){for(var e=-1,r=n?n.length:0;++e<r&&!1!==t(n[e],e,n););return n}function q(n,t){return n&&ge(n,t,L)}function C(n,t,e,r){for(var u=n.length,o=e+(r?1:-1);r?o--:++o<u;)if(t(n[o],o,n))return o;return-1}function W(n){return n!==n}function Q(n,t,e){for(var r=e-1,u=n.length;++r<u;)if(n[r]===t)return r;return-1}function G(n,t,e){return t===t?Q(n,t,e):C(n,W,e)}function N(n,t){for(var e=-1,r=n?n.length:0,u=Array(r);++e<r;)u[e]=t(n[e],e,n);return u}function H(n,t){var e=-1,r=n.length;for(t||(t=Array(r));++e<r;)t[e]=n[e];return t}function J(n){return"symbol"==typeof n||b(n)&&Oe.call(n)==Se}function K(n){if("string"==typeof n)return n;if(zt(n))return N(n,K)+"";if(J(n))return Ee?Ee.call(n):"";var t=n+"";return"0"==t&&1/n==-we?"-0":t}function X(n,t,e){var r=-1,u=n.length;t<0&&(t=-t>u?0:u+t),e=e>u?u:e,e<0&&(e+=u),u=t>e?0:e-t>>>0,t>>>=0;for(var o=Array(u);++r<u;)o[r]=n[r+t];return o}function Y(n,t,e){var r=n.length;return e=void 0===e?r:e,!t&&e>=r?n:X(n,t,e)}function Z(n,t){for(var e=n.length;e--&&G(t,n[e],0)>-1;);return e}function nn(n,t){for(var e=-1,r=n.length;++e<r&&G(t,n[e],0)>-1;);return e}function tn(n){return n.split("")}function en(n){return Le.test(n)}function rn(n){return n.match(Pe)||[]}function un(n){return en(n)?rn(n):tn(n)}function on(n){return null==n?"":K(n)}function cn(n,t,e){if((n=on(n))&&(e||void 0===t))return n.replace(ze,"");if(!n||!(t=K(t)))return n;var r=un(n),u=un(t);return Y(r,nn(r,u),Z(r,u)+1).join("")}function fn(n){return n=n.toString().replace(De,""),n=n.match(Re)[2].replace(" ",""),n=n?n.split(Ue):[],n=n.map(function(n){return cn(n.replace(Ve,""))})}function an(n,t){var e={};q(n,function(n,t){function r(t,e){var r=N(u,function(n){return t[n]});r.push(e),n.apply(null,r)}var u;if(zt(n))u=H(n),n=u.pop(),e[t]=u.concat(u.length>0?r:n);else if(1===n.length)e[t]=n;else{if(u=fn(n),0===n.length&&0===u.length)throw new Error("autoInject task functions require explicit parameters.");u.pop(),e[t]=u.concat(r)}}),be(e,t)}function ln(n){setTimeout(n,0)}function sn(n){return p(function(t,e){n(function(){t.apply(null,e)})})}function pn(){this.head=this.tail=null,this.length=0}function hn(n,t){n.length=1,n.head=n.tail=t}function yn(n,t,e){function r(n,t,e){if(null!=e&&"function"!=typeof e)throw new Error("task callback must be a function");if(c.started=!0,zt(n)||(n=[n]),0===n.length&&c.idle())return We(function(){c.drain()});for(var r=0,u=n.length;r<u;r++){var o={data:n[r],callback:e||d};t?c._tasks.unshift(o):c._tasks.push(o)}We(c.process)}function u(n){return p(function(t){o-=1;for(var e=0,r=n.length;e<r;e++){var u=n[e],f=G(i,u,0);f>=0&&i.splice(f),u.callback.apply(u,t),null!=t[0]&&c.error(t[0],u.data)}o<=c.concurrency-c.buffer&&c.unsaturated(),c.idle()&&c.drain(),c.process()})}if(null==t)t=1;else if(0===t)throw new Error("Concurrency must not be zero");var o=0,i=[],c={_tasks:new pn,concurrency:t,payload:e,saturated:d,unsaturated:d,buffer:t/4,empty:d,drain:d,error:d,started:!1,paused:!1,push:function(n,t){r(n,!1,t)},kill:function(){c.drain=d,c._tasks.empty()},unshift:function(n,t){r(n,!0,t)},process:function(){for(;!c.paused&&o<c.concurrency&&c._tasks.length;){var t=[],e=[],r=c._tasks.length;c.payload&&(r=Math.min(r,c.payload));for(var f=0;f<r;f++){var a=c._tasks.shift();t.push(a),e.push(a.data)}0===c._tasks.length&&c.empty(),o+=1,i.push(t[0]),o===c.concurrency&&c.saturated();var l=I(u(t));n(e,l)}},length:function(){return c._tasks.length},running:function(){return o},workersList:function(){return i},idle:function(){return c._tasks.length+o===0},pause:function(){c.paused=!0},resume:function(){if(!1!==c.paused){c.paused=!1;for(var n=Math.min(c.concurrency,c._tasks.length),t=1;t<=n;t++)We(c.process)}}};return c}function vn(n,t){return yn(n,1,t)}function dn(n,t,e,r){r=m(r||d),Ge(n,function(n,r,u){e(t,n,function(n,e){t=e,u(n)})},function(n){r(n,t)})}function mn(n,t,e,r){var u=[];n(t,function(n,t,r){e(n,function(n,t){u=u.concat(t||[]),r(n)})},function(n){r(n,u)})}function gn(n,t,e){return function(r,u,o,i){function c(){i&&i(null,e(!1))}function f(n,r,u){if(!i)return u();o(n,function(r,c){i&&(r||t(c))?(r?i(r):i(r,e(!0,n)),i=o=!1,u(r,ae)):u()})}arguments.length>3?(i=i||d,n(r,u,f,c)):(i=o,i=i||d,o=u,n(r,f,c))}}function bn(n,t){return t}function jn(n){return p(function(t,e){t.apply(null,e.concat([p(function(t,e){"object"==typeof console&&(t?console.error&&console.error(t):console[n]&&D(e,function(t){console[n](t)}))})]))})}function Sn(n,t,e){function r(t,r){return t?e(t):r?void n(u):e(null)}e=I(e||d);var u=p(function(n,u){if(n)return e(n);u.push(r),t.apply(this,u)});r(null,!0)}function kn(n,t,e){e=I(e||d);var r=p(function(u,o){return u?e(u):t.apply(this,o)?n(r):void e.apply(null,[null].concat(o))});n(r)}function On(n,t,e){kn(n,function(){return!t.apply(this,arguments)},e)}function wn(n,t,e){function r(t){if(t)return e(t);n(u)}function u(n,u){return n?e(n):u?void t(r):e(null)}e=I(e||d),n(u)}function xn(n){return function(t,e,r){return n(t,r)}}function En(n,t,e){se(n,xn(t),e)}function Ln(n,t,e,r){B(t)(n,xn(e),r)}function An(n){return Et(function(t,e){var r=!0;t.push(function(){var n=arguments;r?We(function(){e.apply(null,n)}):e.apply(null,n)}),n.apply(this,t),r=!1})}function _n(n){return!n}function Tn(n){return function(t){return null==t?void 0:t[n]}}function Fn(n,t,e,r){r=m(r||d);var u=[];n(t,function(n,t,r){e(n,function(e,o){e?r(e):(o&&u.push({index:t,value:n}),r())})},function(n){n?r(n):r(null,N(u.sort(function(n,t){return n.index-t.index}),Tn("value")))})}function In(n,t){function e(n){if(n)return r(n);u(e)}var r=I(t||d),u=An(n);e()}function Bn(n,t,e,r){r=m(r||d);var u={};$(n,t,function(n,t,r){e(n,t,function(n,e){if(n)return r(n);u[t]=e,r()})},function(n){r(n,u)})}function $n(n,t){return t in n}function Mn(n,e){var r=Object.create(null),u=Object.create(null);e=e||t;var o=Et(function(t,o){var i=e.apply(null,t);$n(r,i)?We(function(){o.apply(null,r[i])}):$n(u,i)?u[i].push(o):(u[i]=[o],n.apply(null,t.concat([p(function(n){r[i]=n;var t=u[i];delete u[i];for(var e=0,o=t.length;e<o;e++)t[e].apply(null,n)})])))});return o.memo=r,o.unmemoized=n,o}function Pn(n,t,e){e=e||d;var r=v(t)?[]:{};n(t,function(n,t,e){n(p(function(n,u){u.length<=1&&(u=u[0]),r[t]=u,e(n)}))},function(n){e(n,r)})}function zn(n,t){Pn(se,n,t)}function Rn(n,t,e){Pn(B(t),n,e)}function Un(n,t){if(t=m(t||d),!zt(n))return t(new TypeError("First argument to race must be an array of functions"));if(!n.length)return t();for(var e=0,r=n.length;e<r;e++)n[e](t)}function Vn(n,t,e,r){dn(vr.call(n).reverse(),t,e,r)}function Dn(n){return Et(function(t,e){return t.push(p(function(n,t){if(n)e(null,{error:n});else{var r=null;1===t.length?r=t[0]:t.length>1&&(r=t),e(null,{value:r})}})),n.apply(this,t)})}function qn(n,t,e,r){Fn(n,t,function(n,t){e(n,function(n,e){n?t(n):t(null,!e)})},r)}function Cn(n){var t;return zt(n)?t=N(n,Dn):(t={},q(n,function(n,e){t[e]=Dn.call(this,n)})),t}function Wn(n,t,e){function r(){t(function(n){n&&f++<c.times&&("function"!=typeof c.errorFilter||c.errorFilter(n))?setTimeout(r,c.intervalFunc(f)):e.apply(null,arguments)})}var o=5,i=0,c={times:o,intervalFunc:u(i)};if(arguments.length<3&&"function"==typeof n?(e=t||d,t=n):(!function(n,t){if("object"==typeof t)n.times=+t.times||o,n.intervalFunc="function"==typeof t.interval?t.interval:u(+t.interval||i),n.errorFilter=t.errorFilter;else{if("number"!=typeof t&&"string"!=typeof t)throw new Error("Invalid arguments for async.retry");n.times=+t||o}}(c,n),e=e||d),"function"!=typeof t)throw new Error("Invalid arguments for async.retry");var f=1;r()}function Qn(n,t){Pn(Ge,n,t)}function Gn(n,t,e){function r(n,t){var e=n.criteria,r=t.criteria;return e<r?-1:e>r?1:0}pe(n,function(n,e){t(n,function(t,r){if(t)return e(t);e(null,{value:n,criteria:r})})},function(n,t){if(n)return e(n);e(null,N(t.sort(r),Tn("value")))})}function Nn(n,t,e){function r(){c||(o.apply(null,arguments),clearTimeout(i))}function u(){var t=n.name||"anonymous",r=new Error('Callback function "'+t+'" timed out.');r.code="ETIMEDOUT",e&&(r.info=e),c=!0,o(r)}var o,i,c=!1;return Et(function(e,c){o=c,i=setTimeout(u,t),n.apply(null,e.concat(r))})}function Hn(n,t,e,r){for(var u=-1,o=wr(Or((t-n)/(e||1)),0),i=Array(o);o--;)i[r?o:++u]=n,n+=e;return i}function Jn(n,t,e,r){ye(Hn(0,n,1),t,e,r)}function Kn(n,t,e,r){3===arguments.length&&(r=e,e=t,t=zt(n)?[]:{}),r=m(r||d),se(n,function(n,r,u){e(t,n,r,u)},function(n){r(n,t)})}function Xn(n){return function(){return(n.unmemoized||n).apply(null,arguments)}}function Yn(n,t,e){if(e=I(e||d),!n())return e(null);var r=p(function(u,o){return u?e(u):n()?t(r):void e.apply(null,[null].concat(o))});t(r)}function Zn(n,t,e){Yn(function(){return!n.apply(this,arguments)},t,e)}var nt=Math.max,tt="[object Function]",et="[object GeneratorFunction]",rt="[object Proxy]",ut=Object.prototype,ot=ut.toString,it="object"==typeof global&&global&&global.Object===Object&&global,ct="object"==typeof self&&self&&self.Object===Object&&self,ft=it||ct||Function("return this")(),at=ft["__core-js_shared__"],lt=function(){var n=/[^.]+$/.exec(at&&at.keys&&at.keys.IE_PROTO||"");return n?"Symbol(src)_1."+n:""}(),st=Function.prototype,pt=st.toString,ht=/[\\^$.*+?()[\]{}|]/g,yt=/^\[object .+?Constructor\]$/,vt=Function.prototype,dt=Object.prototype,mt=vt.toString,gt=dt.hasOwnProperty,bt=RegExp("^"+mt.call(gt).replace(ht,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),jt=function(){try{var n=s(Object,"defineProperty");return n({},"",{}),n}catch(n){}}(),St=jt?function(n,t){return jt(n,"toString",{configurable:!0,enumerable:!1,value:u(t),writable:!0})}:t,kt=500,Ot=16,wt=Date.now,xt=function(n){var t=0,e=0;return function(){var r=wt(),u=Ot-(r-e);if(e=r,u>0){if(++t>=kt)return arguments[0]}else t=0;return n.apply(void 0,arguments)}}(St),Et=function(n){return p(function(t){var e=t.pop();n.call(this,t,e)})},Lt=9007199254740991,At="function"==typeof Symbol&&Symbol.iterator,_t=function(n){return At&&n[At]&&n[At]()},Tt="[object Arguments]",Ft=Object.prototype,It=Ft.toString,Bt=Object.prototype,$t=Bt.hasOwnProperty,Mt=Bt.propertyIsEnumerable,Pt=j(function(){return arguments}())?j:function(n){return b(n)&&$t.call(n,"callee")&&!Mt.call(n,"callee")},zt=Array.isArray,Rt="object"==typeof n&&n&&!n.nodeType&&n,Ut=Rt&&"object"==typeof module&&module&&!module.nodeType&&module,Vt=Ut&&Ut.exports===Rt,Dt=Vt?ft.Buffer:void 0,qt=Dt?Dt.isBuffer:void 0,Ct=qt||S,Wt=9007199254740991,Qt=/^(?:0|[1-9]\d*)$/,Gt={};Gt["[object Float32Array]"]=Gt["[object Float64Array]"]=Gt["[object Int8Array]"]=Gt["[object Int16Array]"]=Gt["[object Int32Array]"]=Gt["[object Uint8Array]"]=Gt["[object Uint8ClampedArray]"]=Gt["[object Uint16Array]"]=Gt["[object Uint32Array]"]=!0,Gt["[object Arguments]"]=Gt["[object Array]"]=Gt["[object ArrayBuffer]"]=Gt["[object Boolean]"]=Gt["[object DataView]"]=Gt["[object Date]"]=Gt["[object Error]"]=Gt["[object Function]"]=Gt["[object Map]"]=Gt["[object Number]"]=Gt["[object Object]"]=Gt["[object RegExp]"]=Gt["[object Set]"]=Gt["[object String]"]=Gt["[object WeakMap]"]=!1;var Nt,Ht=Object.prototype,Jt=Ht.toString,Kt="object"==typeof n&&n&&!n.nodeType&&n,Xt=Kt&&"object"==typeof module&&module&&!module.nodeType&&module,Yt=Xt&&Xt.exports===Kt,Zt=Yt&&it.process,ne=function(){try{return Zt&&Zt.binding("util")}catch(n){}}(),te=ne&&ne.isTypedArray,ee=te?function(n){return function(t){return n(t)}}(te):O,re=Object.prototype,ue=re.hasOwnProperty,oe=Object.prototype,ie=function(n,t){return function(e){return n(t(e))}}(Object.keys,Object),ce=Object.prototype,fe=ce.hasOwnProperty,ae={},le=M($,1/0),se=function(n,t,e){(v(n)?P:le)(n,t,e)},pe=z(R),he=h(pe),ye=U(R),ve=M(ye,1),de=h(ve),me=p(function(n,t){return p(function(e){return n.apply(null,t.concat(e))})}),ge=function(n){return function(t,e,r){for(var u=-1,o=Object(t),i=r(t),c=i.length;c--;){var f=i[n?c:++u];if(!1===e(o[f],f,o))break}return t}}(),be=function(n,t,e){function r(n,t){g.push(function(){c(n,t)})}function u(){if(0===g.length&&0===h)return e(null,s);for(;g.length&&h<t;){g.shift()()}}function o(n,t){var e=v[n];e||(e=v[n]=[]),e.push(t)}function i(n){D(v[n]||[],function(n){n()}),u()}function c(n,t){if(!y){var r=I(p(function(t,r){if(h--,r.length<=1&&(r=r[0]),t){var u={};q(s,function(n,t){u[t]=n}),u[n]=r,y=!0,v=[],e(t,u)}else s[n]=r,i(n)}));h++;var u=t[t.length-1];t.length>1?u(s,r):u(r)}}function f(t){var e=[];return q(n,function(n,r){zt(n)&&G(n,t,0)>=0&&e.push(r)}),e}"function"==typeof t&&(e=t,t=null),e=m(e||d);var a=L(n),l=a.length;if(!l)return e(null);t||(t=l);var s={},h=0,y=!1,v={},g=[],b=[],j={};q(n,function(t,e){if(!zt(t))return r(e,[t]),void b.push(e);var u=t.slice(0,t.length-1),i=u.length;if(0===i)return r(e,t),void b.push(e);j[e]=i,D(u,function(c){if(!n[c])throw new Error("async.auto task `"+e+"` has a non-existent dependency in "+u.join(", "));o(c,function(){0===--i&&r(e,t)})})}),function(){for(var n,t=0;b.length;)n=b.pop(),t++,D(f(n),function(n){0==--j[n]&&b.push(n)});if(t!==l)throw new Error("async.auto cannot execute tasks due to a recursive dependency")}(),u()},je=ft.Symbol,Se="[object Symbol]",ke=Object.prototype,Oe=ke.toString,we=1/0,xe=je?je.prototype:void 0,Ee=xe?xe.toString:void 0,Le=RegExp("[\\u200d\\ud800-\\udfff\\u0300-\\u036f\\ufe20-\\ufe23\\u20d0-\\u20f0\\ufe0e\\ufe0f]"),Ae="[\\u0300-\\u036f\\ufe20-\\ufe23\\u20d0-\\u20f0]",_e="\\ud83c[\\udffb-\\udfff]",Te="(?:\\ud83c[\\udde6-\\uddff]){2}",Fe="[\\ud800-\\udbff][\\udc00-\\udfff]",Ie="(?:[\\u0300-\\u036f\\ufe20-\\ufe23\\u20d0-\\u20f0]|\\ud83c[\\udffb-\\udfff])?",Be="(?:\\u200d(?:"+["[^\\ud800-\\udfff]",Te,Fe].join("|")+")[\\ufe0e\\ufe0f]?"+Ie+")*",$e="[\\ufe0e\\ufe0f]?"+Ie+Be,Me="(?:"+["[^\\ud800-\\udfff]"+Ae+"?",Ae,Te,Fe,"[\\ud800-\\udfff]"].join("|")+")",Pe=RegExp(_e+"(?="+_e+")|"+Me+$e,"g"),ze=/^\s+|\s+$/g,Re=/^(function)?\s*[^\(]*\(\s*([^\)]*)\)/m,Ue=/,/,Ve=/(=.+)?(\s*)$/,De=/((\/\/.*$)|(\/\*[\s\S]*?\*\/))/gm,qe="function"==typeof setImmediate&&setImmediate,Ce="object"==typeof process&&"function"==typeof process.nextTick;Nt=qe?setImmediate:Ce?process.nextTick:ln;var We=sn(Nt);pn.prototype.removeLink=function(n){return n.prev?n.prev.next=n.next:this.head=n.next,n.next?n.next.prev=n.prev:this.tail=n.prev,n.prev=n.next=null,this.length-=1,n},pn.prototype.empty=pn,pn.prototype.insertAfter=function(n,t){t.prev=n,t.next=n.next,n.next?n.next.prev=t:this.tail=t,n.next=t,this.length+=1},pn.prototype.insertBefore=function(n,t){t.prev=n.prev,t.next=n,n.prev?n.prev.next=t:this.head=t,n.prev=t,this.length+=1},pn.prototype.unshift=function(n){this.head?this.insertBefore(this.head,n):hn(this,n)},pn.prototype.push=function(n){this.tail?this.insertAfter(this.tail,n):hn(this,n)},pn.prototype.shift=function(){return this.head&&this.removeLink(this.head)},pn.prototype.pop=function(){return this.tail&&this.removeLink(this.tail)};var Qe,Ge=M($,1),Ne=p(function(n){return p(function(t){var e=this,r=t[t.length-1];"function"==typeof r?t.pop():r=d,dn(n,t,function(n,t,r){t.apply(e,n.concat([p(function(n,t){r(n,t)})]))},function(n,t){r.apply(e,[n].concat(t))})})}),He=p(function(n){return Ne.apply(null,n.reverse())}),Je=z(mn),Ke=function(n){return function(t,e,r){return n(Ge,t,e,r)}}(mn),Xe=p(function(n){var t=[null].concat(n);return Et(function(n,e){return e.apply(this,t)})}),Ye=gn(se,t,bn),Ze=gn($,t,bn),nr=gn(Ge,t,bn),tr=jn("dir"),er=M(Ln,1),rr=gn(se,_n,_n),ur=gn($,_n,_n),or=M(ur,1),ir=z(Fn),cr=U(Fn),fr=M(cr,1),ar=jn("log"),lr=M(Bn,1/0),sr=M(Bn,1);Qe=Ce?process.nextTick:qe?setImmediate:ln;var pr=sn(Qe),hr=function(n,t){return yn(function(t,e){n(t[0],e)},t,1)},yr=function(n,t){var e=hr(n,t);return e.push=function(n,t,r){if(null==r&&(r=d),"function"!=typeof r)throw new Error("task callback must be a function");if(e.started=!0,zt(n)||(n=[n]),0===n.length)return We(function(){e.drain()});t=t||0;for(var u=e._tasks.head;u&&t>=u.priority;)u=u.next;for(var o=0,i=n.length;o<i;o++){var c={data:n[o],priority:t,callback:r};u?e._tasks.insertBefore(u,c):e._tasks.push(c)}We(e.process)},delete e.unshift,e},vr=Array.prototype.slice,dr=z(qn),mr=U(qn),gr=M(mr,1),br=function(n,t){return t||(t=n,n=null),Et(function(e,r){function u(n){t.apply(null,e.concat([n]))}n?Wn(n,u,r):Wn(u,r)})},jr=gn(se,Boolean,t),Sr=gn($,Boolean,t),kr=M(Sr,1),Or=Math.ceil,wr=Math.max,xr=M(Jn,1/0),Er=M(Jn,1),Lr=function(n,t){function e(u){if(r===n.length)return t.apply(null,[null].concat(u));var o=I(p(function(n,r){if(n)return t.apply(null,[n].concat(r));e(r)}));u.push(o),n[r++].apply(null,u)}if(t=m(t||d),!zt(n))return t(new Error("First argument to waterfall must be an array of functions"));if(!n.length)return t();var r=0;e([])},Ar={applyEach:he,applyEachSeries:de,apply:me,asyncify:V,auto:be,autoInject:an,cargo:vn,compose:He,concat:Je,concatSeries:Ke,constant:Xe,detect:Ye,detectLimit:Ze,detectSeries:nr,dir:tr,doDuring:Sn,doUntil:On,doWhilst:kn,during:wn,each:En,eachLimit:Ln,eachOf:se,eachOfLimit:$,eachOfSeries:Ge,eachSeries:er,ensureAsync:An,every:rr,everyLimit:ur,everySeries:or,filter:ir,filterLimit:cr,filterSeries:fr,forever:In,log:ar,map:pe,mapLimit:ye,mapSeries:ve,mapValues:lr,mapValuesLimit:Bn,mapValuesSeries:sr,memoize:Mn,nextTick:pr,parallel:zn,parallelLimit:Rn,priorityQueue:yr,queue:hr,race:Un,reduce:dn,reduceRight:Vn,reflect:Dn,reflectAll:Cn,reject:dr,rejectLimit:mr,rejectSeries:gr,retry:Wn,retryable:br,seq:Ne,series:Qn,setImmediate:We,some:jr,someLimit:Sr,someSeries:kr,sortBy:Gn,timeout:Nn,times:xr,timesLimit:Jn,timesSeries:Er,transform:Kn,unmemoize:Xn,until:Zn,waterfall:Lr,whilst:Yn,all:rr,any:jr,forEach:En,forEachSeries:er,forEachLimit:Ln,forEachOf:se,forEachOfSeries:Ge,forEachOfLimit:$,inject:dn,foldl:dn,foldr:Vn,select:ir,selectLimit:cr,selectSeries:fr,wrapSync:V};n.default=Ar,n.applyEach=he,n.applyEachSeries=de,n.apply=me,n.asyncify=V,n.auto=be,n.autoInject=an,n.cargo=vn,n.compose=He,n.concat=Je,n.concatSeries=Ke,n.constant=Xe,n.detect=Ye,n.detectLimit=Ze,n.detectSeries=nr,n.dir=tr,n.doDuring=Sn,n.doUntil=On,n.doWhilst=kn,n.during=wn,n.each=En,n.eachLimit=Ln,n.eachOf=se,n.eachOfLimit=$,n.eachOfSeries=Ge,n.eachSeries=er,n.ensureAsync=An,n.every=rr,n.everyLimit=ur,n.everySeries=or,n.filter=ir,n.filterLimit=cr,n.filterSeries=fr,n.forever=In,n.log=ar,n.map=pe,n.mapLimit=ye,n.mapSeries=ve,n.mapValues=lr,n.mapValuesLimit=Bn,n.mapValuesSeries=sr,n.memoize=Mn,n.nextTick=pr,n.parallel=zn,n.parallelLimit=Rn,n.priorityQueue=yr,n.queue=hr,n.race=Un,n.reduce=dn,n.reduceRight=Vn,n.reflect=Dn,n.reflectAll=Cn,n.reject=dr,n.rejectLimit=mr,n.rejectSeries=gr,n.retry=Wn,n.retryable=br,n.seq=Ne,n.series=Qn,n.setImmediate=We,n.some=jr,n.someLimit=Sr,n.someSeries=kr,n.sortBy=Gn,n.timeout=Nn,n.times=xr,n.timesLimit=Jn,n.timesSeries=Er,n.transform=Kn,n.unmemoize=Xn,n.until=Zn,n.waterfall=Lr,n.whilst=Yn,n.all=rr,n.allLimit=ur,n.allSeries=or,n.any=jr,n.anyLimit=Sr,n.anySeries=kr,n.find=Ye,n.findLimit=Ze,n.findSeries=nr,n.forEach=En,n.forEachSeries=er,n.forEachLimit=Ln,n.forEachOf=se,n.forEachOfSeries=Ge,n.forEachOfLimit=$,n.inject=dn,n.foldl=dn,n.foldr=Vn,n.select=ir,n.selectLimit=cr,n.selectSeries=fr,n.wrapSync=V,Object.defineProperty(n,"__esModule",{value:!0})});
}).call(this,require('_process'),typeof global !== "undefined" ? global : typeof self !== "undefined" ? self : typeof window !== "undefined" ? window : {})
},{"_process":1}],"/wrapper/src/libs/external/base64.js":[function(require,module,exports){
!function(t,e){"function"==typeof define&&define.amd?define([],function(){e(t)}):e(t)}("undefined"!=typeof exports?exports:this,function(t){if(t.atob)try{t.atob(" ")}catch(e){t.atob=function(t){var e=function(e){return t(String(e).replace(/[\t\n\f\r ]+/g,""))};return e.original=t,e}(t.atob)}else{var e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",r=/^(?:[A-Za-z\d+\/]{4})*?(?:[A-Za-z\d+\/]{2}(?:==)?|[A-Za-z\d+\/]{3}=?)?$/;t.btoa=function(t){t=String(t);for(var r,n,o,a,i="",c=0,d=t.length%3;c<t.length;){if((n=t.charCodeAt(c++))>255||(o=t.charCodeAt(c++))>255||(a=t.charCodeAt(c++))>255)throw new TypeError("Failed to execute 'btoa' on 'Window': The string to be encoded contains characters outside of the Latin1 range.");r=n<<16|o<<8|a,i+=e.charAt(r>>18&63)+e.charAt(r>>12&63)+e.charAt(r>>6&63)+e.charAt(63&r)}return d?i.slice(0,d-3)+"===".substring(d):i},t.atob=function(t){if(t=String(t).replace(/[\t\n\f\r ]+/g,""),!r.test(t))throw new TypeError("Failed to execute 'atob' on 'Window': The string to be decoded is not correctly encoded.");t+="==".slice(2-(3&t.length));for(var n,o,a,i="",c=0;c<t.length;)n=e.indexOf(t.charAt(c++))<<18|e.indexOf(t.charAt(c++))<<12|(o=e.indexOf(t.charAt(c++)))<<6|(a=e.indexOf(t.charAt(c++))),i+=64===o?String.fromCharCode(n>>16&255):64===a?String.fromCharCode(n>>16&255,n>>8&255):String.fromCharCode(n>>16&255,n>>8&255,255&n);return i}}});
},{}],"/wrapper/src/libs/external/device.js":[function(require,module,exports){
"use strict";var device,find,userAgent;device={},userAgent=window.navigator.userAgent.toLowerCase(),device.ios=function(){return device.iphone()||device.ipod()||device.ipad()},device.iphone=function(){return!device.windows()&&find("iphone")},device.ipod=function(){return find("ipod")},device.ipad=function(){return find("ipad")},device.android=function(){return!device.windows()&&find("android")},device.androidPhone=function(){return device.android()&&find("mobile")},device.androidTablet=function(){return device.android()&&!find("mobile")},device.blackberry=function(){return find("blackberry")||find("bb10")||find("rim")},device.blackberryPhone=function(){return device.blackberry()&&!find("tablet")},device.blackberryTablet=function(){return device.blackberry()&&find("tablet")},device.windows=function(){return find("windows")},device.windowsPhone=function(){return device.windows()&&find("phone")},device.windowsTablet=function(){return device.windows()&&find("touch")&&!device.windowsPhone()},device.fxos=function(){return(find("(mobile;")||find("(tablet;"))&&find("; rv:")},device.fxosPhone=function(){return device.fxos()&&find("mobile")},device.fxosTablet=function(){return device.fxos()&&find("tablet")},device.meego=function(){return find("meego")},device.mobile=function(){return device.androidPhone()||device.iphone()||device.ipod()||device.windowsPhone()||device.blackberryPhone()||device.fxosPhone()||device.meego()},device.tablet=function(){return device.ipad()||device.androidTablet()||device.blackberryTablet()||device.windowsTablet()||device.fxosTablet()},device.desktop=function(){return!device.tablet()&&!device.mobile()},find=function(e){return-1!==userAgent.indexOf(e)},module.exports=device;
},{}],"/wrapper/src/libs/external/jsonpatch-reduced.js":[function(require,module,exports){
"use strict";!function(t,e){"object"==typeof exports?e(module.exports):"function"==typeof define&&define.amd?define(["exports"],e):(t.jsonpatch={},t.returnExports=e(t.jsonpatch))}(this,function(t){function e(t){Error.call(this,t),this.message=t}function r(t){Error.call(this,t),this.message=t}function n(t){var e,r;if(h(t))return t.slice();if(null===t)return t;if("object"==typeof t){e={};for(r in t)Object.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e}return t}function o(t,e){var r;if(t===e)return!0;if(typeof t!=typeof e)return!1;if("object"!=typeof t)return!1;var n=h(t);if(n!==h(e))return!1;if(!n){for(r in t)if(Object.hasOwnProperty(t,r)&&(!Object.hasOwnProperty(e,r)||!o(t[r],e[r])))return!1;for(r in e)if(Object.hasOwnProperty(e,r)&&!Object.hasOwnProperty(t,r))return!1;return!0}if(t.length!=e.length)return!1;for(var i=0;i<t.length;i++)return o(t[i],e[i])}function i(t){var r,n;if(!t.op)throw new e("");if(!a.hasOwnProperty(t.op))throw new e("");if(!("path"in t))throw new e("");for(n=a[t.op],r=0;r<n.length;r++)if(!(n[r]in t))throw new e("")}function c(t,n){i(t);var c=t.op,f=new p(t.path),a=t.value,h=t.from?new p(t.from):null;switch(c){case"add":return function(t){return f.add(t,a,n)};case"remove":return function(t){return f.remove(t,n)};case"replace":return function(t){return f.replace(t,a,n)};case"move":if(f.subsetOf(h))throw new e("");return function(t){var e=h.get(t),r=h.remove(t,n);return f.add(r,e,n)};case"copy":return function(t){var e=h.get(t);return f.add(t,e,n)};case"test":return function(t){if(!o(f.get(t),a))throw new r("");return t}}}var f,p,a,h;h=Array.isArray||function(t){return"[object Array]"==Object.prototype.toString.call(t)},t.applyPatch=function(t,e){return new f(e).apply(t)},t.InvalidPatch=e,e.prototype=new Error,t.PatchApplyError=r,r.prototype=new Error,t.JSONPointer=p=function(t){var r,n,o=[];if(n=t.split("/"),""!==n[0])throw new e("");for(r=1;r<n.length;r++)o[r-1]=n[r].replace(/~1/g,"/").replace(/~0/g,"~");this.path=o,this.length=o.length},p.prototype._get_segment=function(t,e){var n=this.path[t];if(h(e))if("-"===n)n=e.length;else{if(!n.match(/^0|[1-9][0-9]*$/))throw new r("");n=parseInt(n,10)}return n},p.prototype._action=function(t,e,o){function i(t,f){var p,a;if(o||(t=n(t)),p=c._get_segment(f,t),f==c.path.length-1)t=e(t,p);else{if(h(t)){if(t.length<=p)throw new r("")}else{if("object"!=typeof t)throw new r("");if(!Object.hasOwnProperty.call(t,p))throw new r("")}a=i(t[p],f+1),o||(t[p]=a)}return t}var c=this;return i(t,0)},p.prototype.add=function(t,e,n){return 0===this.length?e:this._action(t,function(t,n){if(h(t)){if(n>t.length)throw new r("");t.splice(n,0,e)}else t[n]=e;return t},n)},p.prototype.remove=function(t,e){if(0!==this.length)return this._action(t,function(t,e){if(!Object.hasOwnProperty.call(t,e))throw new r("");return h(t)?t.splice(e,1):delete t[e],t},e)},p.prototype.replace=function(t,e,n){return 0===this.length?e:this._action(t,function(t,n){if(!Object.hasOwnProperty.call(t,n))throw new r("");return h(t)?t.splice(n,1,e):t[n]=e,t},n)},p.prototype.get=function(t){var e;return 0===this.length?t:(this._action(t,function(t,n){if(!Object.hasOwnProperty.call(t,n))throw new r("");return e=t[n],t},!0),e)},p.prototype.subsetOf=function(t){if(this.length<=t.length)return!1;for(var e=0;e<t.length;e++)if(t.path[e]!==this.path[e])return!1;return!0},a={add:["value"],replace:["value"],test:["value"],remove:[],move:["from"],copy:["from"]},t.JSONPatch=f=function(t,e){this._compile(t,e)},f.prototype._compile=function(t,r){var n,o=this;if(this.compiledOps=[],"string"==typeof t&&(t=JSON.parse(t)),!h(t))throw new e("");for(n=0;n<t.length;n++){var i=c(t[n],r);o.compiledOps.push(i)}},t.JSONPatch.prototype.apply=function(t){var e;for(e=0;e<this.compiledOps.length;e++)t=this.compiledOps[e](t);return t}});
},{}],"/wrapper/src/libs/external/prms.js":[function(require,module,exports){
function noop(){}function Promise(e){if("object"!=typeof this)throw new TypeError("Promises must be constructed via new");if("function"!=typeof e)throw new TypeError("not a function");this._state=0,this._handled=!1,this._value=void 0,this._deferreds=[],doResolve(e,this)}function handle(e,t){for(;3===e._state;)e=e._value;if(0===e._state)return void e._deferreds.push(t);e._handled=!0;var n=1===e._state?t.onFulfilled:t.onRejected;if(null===n)return void(1===e._state?resolve:reject)(t.promise,e._value);var o;try{o=n(e._value)}catch(e){return void reject(t.promise,e)}resolve(t.promise,o)}function resolve(e,t){try{if(t===e)throw new TypeError("A promise cannot be resolved with itself.");if(t&&("object"==typeof t||"function"==typeof t)){var n=t.then;if(t instanceof Promise)return e._state=3,e._value=t,void finale(e);if("function"==typeof n)return void doResolve(bind(n,t),e)}e._state=1,e._value=t,finale(e)}catch(t){reject(e,t)}}function reject(e,t){e._state=2,e._value=t,finale(e)}function finale(e){for(var t=0,n=e._deferreds.length;t<n;t++)handle(e,e._deferreds[t]);e._deferreds=null}function Handler(e,t,n){this.onFulfilled="function"==typeof e?e:null,this.onRejected="function"==typeof t?t:null,this.promise=n}function doResolve(e,t){var n=!1;try{e(function(e){n||(n=!0,resolve(t,e))},function(e){n||(n=!0,reject(t,e))})}catch(e){if(n)return;n=!0,reject(t,e)}}Promise.prototype.catch=function(e){return this.then(null,e)},Promise.prototype.then=function(e,t){var n=new this.constructor(noop);return handle(this,new Handler(e,t,n)),n},Promise.all=function(e){var t=Array.prototype.slice.call(e);return new Promise(function(e,n){function o(i,f){try{if(f&&("object"==typeof f||"function"==typeof f)){var s=f.then;if("function"==typeof s)return void s.call(f,function(e){o(i,e)},n)}t[i]=f,0==--r&&e(t)}catch(e){n(e)}}if(0===t.length)return e([]);for(var r=t.length,i=0;i<t.length;i++)o(i,t[i])})},Promise.resolve=function(e){return e&&"object"==typeof e&&e.constructor===Promise?e:new Promise(function(t){t(e)})},Promise.reject=function(e){return new Promise(function(t,n){n(e)})},Promise.defer=function(){var e={};return e.promise=new Promise(function(t,n){e.resolve=t,e.reject=n}),e},module.exports=Promise;
},{}],"/wrapper/src/libs/external/schema-inspector.js":[function(require,module,exports){
!function(){function t(t,e){if(!e||"object"!=typeof e)return t;for(var n=Object.keys(e),r=n.length;r--;)t[n[r]]=e[n[r]];return t}function e(){var t={},e=Array.prototype.slice.call(arguments),n=null,r=null;return e.forEach(function(e){if(e&&e.constructor===Object)for(n=Object.keys(e),r=n.length;r--;)t[n[r]]=e[n[r]]}),t}function n(){this.custom={},this.extend=function(e){return t(this.custom,e)},this.reset=function(){this.custom={}},this.remove=function(t){h.array(t)||(t=[t]),t.forEach(function(t){delete this.custom[t]},this)}}function r(t,e){var n=["@"];if(this._schema=t,this._custom={},null!=e)for(var r in e)e.hasOwnProperty(r)&&(this._custom["$"+r]=e[r]);this._getDepth=function(){return n.length},this._dumpStack=function(){return n.map(function(t){return t.replace(/^\[/g,"")}).join(".").replace(/\.\u001b\u001c\u001d\u001e/g,"[")},this._deeperObject=function(t){return n.push(/^[a-z$_][a-z0-9$_]*$/i.test(t)?t:'["'+t+'"]'),this},this._deeperArray=function(t){return n.push("["+t+"]"),this},this._back=function(){return n.pop(),this}}function i(t,e){return"function"==typeof t?e instanceof t:(t=t in h?t:"any",h[t](e))}function u(t){for(var e in h)if(i(e,t))return"any"!==e?e:"an instance of "+t.constructor.name}function o(t,e){for(var n=[],r=t.indexOf(e);-1!==r;)n.push(r),r=t.indexOf(e,r+1);return n}function a(t,n){r.prototype.constructor.call(this,t,e(a.custom,n));var i=[];this._basicFields=Object.keys(y),this._customFields=Object.keys(this._custom),this.origin=null,this.report=function(t,e,n){var r={code:e||this.userCode||null,reason:n||"unknown",message:this.userError||t||"is invalid",property:this.userAlias?this.userAlias+" ("+this._dumpStack()+")":this._dumpStack()};return i.push(r),this},this.result=function(){return{error:i,valid:0===i.length,format:function(){return!0===this.valid?"Candidate is valid":this.error.map(function(t){return"Property "+t.property+": "+t.message}).join("\n")}}}}function s(t,n){r.prototype.constructor.call(this,t,e(s.custom,n));var i=[];this._basicFields=Object.keys(b),this._customFields=Object.keys(this._custom),this.origin=null,this.report=function(t){var e={message:t||"was sanitized",property:this.userAlias?this.userAlias+" ("+this._dumpStack()+")":this._dumpStack()};i.some(function(t){return t.property===e.property})||i.push(e)},this.result=function(t){return{data:t,reporting:i,format:function(){return this.reporting.map(function(t){return"Property "+t.property+" "+t.message}).join("\n")}}}}function c(t){var e=_,n=D;return null!=t.gte?e=t.gte:null!=t.gt&&(e=t.gt+1),null!=t.lte?n=t.lte:null!=t.lt&&(n=t.lt-1),{min:e,max:n}}function f(){}var l={};if(l.async="function"==typeof require?require("./async.js"):window.async,"object"!=typeof l.async)throw new Error("Module async is required (https://github.com/caolan/async)");var p=l.async,h={function:function(t){return"function"==typeof t},string:function(t){return"string"==typeof t},number:function(t){return"number"==typeof t&&!isNaN(t)},integer:function(t){return"number"==typeof t&&t%1==0},NaN:function(t){return"number"==typeof t&&isNaN(t)},boolean:function(t){return"boolean"==typeof t},null:function(t){return null===t},date:function(t){return null!=t&&t instanceof Date},object:function(t){return null!=t&&t.constructor===Object},array:function(t){return null!=t&&t.constructor===Array},any:function(t){return!0}},F={void:/^$/,url:/^(https?|ftp):\/\/(((([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:)*@)?(((\d|[1-9]\d|1\d\d|2[0-4]\d|25[0-5])\.(\d|[1-9]\d|1\d\d|2[0-4]\d|25[0-5])\.(\d|[1-9]\d|1\d\d|2[0-4]\d|25[0-5])\.(\d|[1-9]\d|1\d\d|2[0-4]\d|25[0-5]))|((([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))\.)?(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))\.?)(:\d*)?)(\/((([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:|@)+(\/(([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:|@)*)*)?)?(\?((([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:|@)|[\uE000-\uF8FF]|\/|\?)*)?(\#((([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:|@)|\/|\?)*)?$/i,"date-time":/^\d{4}-\d{2}-\d{2}T\d{2}:\d{2}:\d{2}(\.\d{3})?(Z?|(-|\+)\d{2}:\d{2})$/,date:/^\d{4}-\d{2}-\d{2}$/,coolDateTime:/^\d{4}(-|\/)\d{2}(-|\/)\d{2}(T| )\d{2}:\d{2}:\d{2}(\.\d{3})?Z?$/,time:/^\d{2}\:\d{2}\:\d{2}$/,color:/^#([0-9a-f])+$/i,email:/^((([a-z]|\d|[!#\$%&'\*\+\-\/=\?\^_`{\|}~]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])+(\.([a-z]|\d|[!#\$%&'\*\+\-\/=\?\^_`{\|}~]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])+)*)|((\x22)((((\x20|\x09)*(\x0d\x0a))?(\x20|\x09)+)?(([\x01-\x08\x0b\x0c\x0e-\x1f\x7f]|\x21|[\x23-\x5b]|[\x5d-\x7e]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(\\([\x01-\x09\x0b\x0c\x0d-\x7f]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF]))))*(((\x20|\x09)*(\x0d\x0a))?(\x20|\x09)+)?(\x22)))@((([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))\.)+(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))\.?$/i,numeric:/^[0-9]+$/,integer:/^\-?[0-9]+$/,decimal:/^\-?[0-9]*\.?[0-9]+$/,alpha:/^[a-z]+$/i,alphaNumeric:/^[a-z0-9]+$/i,alphaDash:/^[a-z0-9_-]+$/i,javascript:/^[a-z_\$][a-z0-9_\$]*$/i,upperString:/^[A-Z ]*$/,lowerString:/^[a-z ]*$/},y={optional:function(t,e){!0!==("boolean"==typeof t.optional?t.optional:"true"===t.optional)&&void 0===e&&this.report("is missing and not optional",null,"optional")},type:function(t,e){if(void 0!==e&&("string"==typeof t.type||t.type instanceof Array||"function"==typeof t.type)){var n=h.array(t.type)?t.type:[t.type];n.some(function(t){return i(t,e)})||(n=n.map(function(t){return"function"==typeof t?"and instance of "+t.name:t}),this.report("must be "+n.join(" or ")+", but is "+u(e),null,"type"))}},uniqueness:function(t,e){if("string"==typeof t.uniqueness&&(t.uniqueness="true"===t.uniqueness),"boolean"==typeof t.uniqueness&&!1!==t.uniqueness&&(h.array(e)||"string"==typeof e))for(var n=[],r=0;r<e.length;r++)if(!(n.indexOf(e[r])>=0)){var i=o(e,e[r]);i.length>1&&(n.push(e[r]),this.report("has value ["+e[r]+"] more than once at indexes ["+i.join(", ")+"]",null,"uniqueness"))}},pattern:function(t,e){var n=this,r=t.pattern;if("string"==typeof e){var i=!1;h.array(r)||(r=[r]),r.forEach(function(t){"string"==typeof t&&t in F&&(t=F[t]),t instanceof RegExp&&t.test(e)&&(i=!0)}),i||n.report("must match ["+r.join(" or ")+'], but is equal to "'+e+'"',null,"pattern")}},validDate:function(t,e){"true"===String(t.validDate)&&e instanceof Date&&isNaN(e.getTime())&&this.report("must be a valid date",null,"validDate")},minLength:function(t,e){if("string"==typeof e||h.array(e)){var n=Number(t.minLength);isNaN(n)||e.length<n&&this.report("must be longer than "+n+" elements, but it has "+e.length,null,"minLength")}},maxLength:function(t,e){if("string"==typeof e||h.array(e)){var n=Number(t.maxLength);isNaN(n)||e.length>n&&this.report("must be shorter than "+n+" elements, but it has "+e.length,null,"maxLength")}},exactLength:function(t,e){if("string"==typeof e||h.array(e)){var n=Number(t.exactLength);isNaN(n)||e.length!==n&&this.report("must have exactly "+n+" elements, but it have "+e.length,null,"exactLength")}},lt:function(t,e){var n=Number(t.lt);"number"!=typeof e||isNaN(n)||e>=n&&this.report("must be less than "+n+', but is equal to "'+e+'"',null,"lt")},lte:function(t,e){var n=Number(t.lte);"number"!=typeof e||isNaN(n)||e>n&&this.report("must be less than or equal to "+n+', but is equal to "'+e+'"',null,"lte")},gt:function(t,e){var n=Number(t.gt);"number"!=typeof e||isNaN(n)||e<=n&&this.report("must be greater than "+n+', but is equal to "'+e+'"',null,"gt")},gte:function(t,e){var n=Number(t.gte);"number"!=typeof e||isNaN(n)||e<n&&this.report("must be greater than or equal to "+n+', but is equal to "'+e+'"',null,"gte")},eq:function(t,e){if("number"==typeof e||"string"==typeof e||"boolean"==typeof e){var n=t.eq;if("number"==typeof n||"string"==typeof n||"boolean"==typeof n||h.array(n))if(h.array(n)){for(var r=0;r<n.length;r++)if(e===n[r])return;this.report("must be equal to ["+n.map(function(t){return'"'+t+'"'}).join(" or ")+'], but is equal to "'+e+'"',null,"eq")}else e!==n&&this.report('must be equal to "'+n+'", but is equal to "'+e+'"',null,"eq")}},ne:function(t,e){if("number"==typeof e||"string"==typeof e){var n=t.ne;if("number"==typeof n||"string"==typeof n||h.array(n))if(h.array(n)){for(var r=0;r<n.length;r++)if(e===n[r])return void this.report('must not be equal to "'+n[r]+'"',null,"ne")}else e===n&&this.report('must not be equal to "'+n+'"',null,"ne")}},someKeys:function(t,e){var n=t.someKeys;if(h.object(e)){n.some(function(t){return t in e})||this.report("must have at least key "+n.map(function(t){return'"'+t+'"'}).join(" or "),null,"someKeys")}},strict:function(t,e){if("string"==typeof t.strict&&(t.strict="true"===t.strict),!0===t.strict&&h.object(e)&&h.object(t.properties)){var n=this;if(void 0===t.properties["*"]){var r=Object.keys(e).filter(function(e){return void 0===t.properties[e]});if(r.length>0){var i="should not contains "+(r.length>1?"properties":"property")+" ["+r.map(function(t){return'"'+t+'"'}).join(", ")+"]";n.report(i,null,"strict")}}}},exec:function(t,e,n){var r=this;if("function"==typeof n)return this.asyncExec(t,e,n);(h.array(t.exec)?t.exec:[t.exec]).forEach(function(n){"function"==typeof n&&n.call(r,t,e)})},properties:function(t,e,n){if("function"==typeof n)return this.asyncProperties(t,e,n);if(t.properties instanceof Object&&e instanceof Object){var r,i=t.properties;if(null!=i["*"])for(r in e)r in i||(this._deeperObject(r),this._validate(i["*"],e[r]),this._back());for(r in i)"*"!==r&&(this._deeperObject(r),this._validate(i[r],e[r]),this._back())}},items:function(t,e,n){if("function"==typeof n)return this.asyncItems(t,e,n);if(t.items instanceof Object&&e instanceof Object){var r,i,u=t.items;if(h.array(u)&&h.array(e))for(r=0,i=u.length;r<i;r++)this._deeperArray(r),this._validate(u[r],e[r]),this._back();else for(var o in e)e.hasOwnProperty(o)&&(this._deeperArray(o),this._validate(u,e[o]),this._back())}}},m={asyncExec:function(t,e,n){var r=this;p.eachSeries(h.array(t.exec)?t.exec:[t.exec],function(n,i){if("function"==typeof n){if(n.length>2)return n.call(r,t,e,i);n.call(r,t,e)}p.nextTick(i)},n)},asyncProperties:function(t,e,n){if(!(t.properties instanceof Object&&h.object(e)))return n();var r=this,i=t.properties;p.series([function(t){if(null==i["*"])return t();p.eachSeries(Object.keys(e),function(t,n){if(t in i)return p.nextTick(n);r._deeperObject(t),r._asyncValidate(i["*"],e[t],function(t){r._back(),n(t)})},t)},function(t){p.eachSeries(Object.keys(i),function(t,n){if("*"===t)return p.nextTick(n);r._deeperObject(t),r._asyncValidate(i[t],e[t],function(t){r._back(),n(t)})},t)}],n)},asyncItems:function(t,e,n){if(!(t.items instanceof Object&&e instanceof Object))return n();var r=this,i=t.items;h.array(i)&&h.array(e)?p.timesSeries(i.length,function(t,n){r._deeperArray(t),r._asyncValidate(i[t],e[t],function(t,e){r._back(),n(t,e)}),r._back()},n):p.eachSeries(Object.keys(e),function(t,n){r._deeperArray(t),r._asyncValidate(i,e[t],function(t,e){r._back(),n(t,e)})},n)}};t(a.prototype,y),t(a.prototype,m),t(a,new n),a.prototype.validate=function(t,e){if(this.origin=t,"function"==typeof e){var n=this;return p.nextTick(function(){n._asyncValidate(n._schema,t,function(t){n.origin=null,e(t,n.result())})})}return this._validate(this._schema,t).result()},a.prototype._validate=function(t,e,n){return this.userCode=t.code||null,this.userError=t.error||null,this.userAlias=t.alias||null,this._basicFields.forEach(function(n){(n in t||"optional"===n)&&"function"==typeof this[n]&&this[n](t,e)},this),this._customFields.forEach(function(n){n in t&&"function"==typeof this._custom[n]&&this._custom[n].call(this,t,e)},this),this},a.prototype._asyncValidate=function(t,e,n){var r=this;this.userCode=t.code||null,this.userError=t.error||null,this.userAlias=t.alias||null,p.series([function(n){p.eachSeries(Object.keys(y),function(n,i){p.nextTick(function(){if((n in t||"optional"===n)&&"function"==typeof r[n]){if(r[n].length>2)return r[n](t,e,i);r[n](t,e)}i()})},n)},function(n){p.eachSeries(Object.keys(r._custom),function(n,i){p.nextTick(function(){if(n in t&&"function"==typeof r._custom[n]){if(r._custom[n].length>2)return r._custom[n].call(r,t,e,i);r._custom[n].call(r,t,e)}i()})},n)}],n)};var d={number:function(t,e){var n;if("number"==typeof t)return t;if(""===t)return void 0!==e.def?e.def:null;if("string"==typeof t){if("number"==typeof(n=parseFloat(t.replace(/,/g,".").replace(/ /g,""))))return n}else if(t instanceof Date)return+t;return null},integer:function(t,e){var n;if("number"==typeof t&&t%1==0)return t;if(""===t)return void 0!==e.def?e.def:null;if("string"==typeof t){if("number"==typeof(n=parseInt(t.replace(/ /g,""),10)))return n}else{if("number"==typeof t)return parseInt(t,10);if("boolean"==typeof t)return t?1:0;if(t instanceof Date)return+t}return null},string:function(t,e){return"boolean"==typeof t||"number"==typeof t||t instanceof Date?t.toString():h.array(t)?e.items||e.properties?t:t.join(String(e.joinWith||",")):t instanceof Object?e.items||e.properties?t:JSON.stringify(t):"string"==typeof t&&t.length?t:null},date:function(t,e){if(t instanceof Date)return t;var n=new Date(t);return isNaN(n.getTime())?null:n},boolean:function(t,e){return void 0===t?null:("string"!=typeof t||"false"!==t.toLowerCase())&&!!t},object:function(t,e){if("string"!=typeof t||h.object(t))return t;try{return JSON.parse(t)}catch(t){return null}},array:function(t,e){if(h.array(t))return t;if(void 0===t)return null;if("string"==typeof t){if("["===t.substring(0,1)&&"]"===t.slice(-1))try{return JSON.parse(t)}catch(t){return null}return t.split(String(e.splitWith||","))}return h.array(t)?null:[t]}},g={upper:function(t){return t.toUpperCase()},lower:function(t){return t.toLowerCase()},title:function(t){return t.replace(/\S*/g,function(t){return t.charAt(0).toUpperCase()+t.substr(1).toLowerCase()})},capitalize:function(t){return t.charAt(0).toUpperCase()+t.substr(1).toLowerCase()},ucfirst:function(t){return t.charAt(0).toUpperCase()+t.substr(1)},trim:function(t){return t.trim()}},b={strict:function(t,e){if("string"==typeof t.strict&&(t.strict="true"===t.strict),!0!==t.strict)return e;if(!h.object(t.properties))return e;if(!h.object(e))return e;return Object.keys(e).forEach(function(n){n in t.properties||delete e[n]}),e},optional:function(t,e){return!0===("boolean"==typeof t.optional?t.optional:"false"!==t.optional)?e:void 0!==e?e:(this.report(),t.def===Date?new Date:t.def)},type:function(t,e){if("string"!=typeof t.type||"function"!=typeof d[t.type])return e;var n,r="boolean"!=typeof t.optional||t.optional;return"function"==typeof d[t.type]?(null===(n=d[t.type](e,t))&&!r||!n&&isNaN(n)||null===n&&"string"===t.type)&&(n=t.def):r||(n=t.def),(null!=n||void 0!==t.def&&t.def===n)&&n!==e?(this.report(),n):e},rules:function(t,e){var n=t.rules;if("string"!=typeof e||"string"!=typeof n&&!h.array(n))return e;var r=!1;return(h.array(n)?n:[n]).forEach(function(t){"function"==typeof g[t]&&(e=g[t](e),r=!0)}),r&&this.report(),e},min:function(t,e){var n=Number(e);if(isNaN(n))return e;var r=Number(t.min);return isNaN(r)?e:n<r?(this.report(),r):e},max:function(t,e){var n=Number(e);if(isNaN(n))return e;var r=Number(t.max);return isNaN(r)?e:n>r?(this.report(),r):e},minLength:function(t,e){var n=Number(t.minLength);if("string"!=typeof e||isNaN(n)||n<0)return e;var r="",i=n-e.length;if(i>0){for(var u=0;u<i;u++)r+="-";return this.report(),e+r}return e},maxLength:function(t,e){var n=Number(t.maxLength);return"string"!=typeof e||isNaN(n)||n<0?e:e.length>n?(this.report(),e.slice(0,n)):e},properties:function(t,e,n){if("function"==typeof n)return this.asyncProperties(t,e,n);if(!e||"object"!=typeof e)return e;var r,i,u=t.properties;if(void 0!==u["*"])for(i in e)i in u||(this._deeperObject(i),r=this._sanitize(t.properties["*"],e[i]),void 0!==r&&(e[i]=r),this._back());for(i in t.properties)"*"!==i&&(this._deeperObject(i),r=this._sanitize(t.properties[i],e[i]),void 0!==r&&(e[i]=r),this._back());return e},items:function(t,e,n){if("function"==typeof n)return this.asyncItems(t,e,n);if(!(t.items instanceof Object&&e instanceof Object))return e;var r;if(h.array(t.items)&&h.array(e)){var i=t.items.length<e.length?t.items.length:e.length;for(r=0;r<i;r++)this._deeperArray(r),e[r]=this._sanitize(t.items[r],e[r]),this._back()}else for(r in e)e.hasOwnProperty(r)&&(this._deeperArray(r),e[r]=this._sanitize(t.items,e[r]),this._back());return e},exec:function(t,e,n){return"function"==typeof n?this.asyncExec(t,e,n):((h.array(t.exec)?t.exec:[t.exec]).forEach(function(n){"function"==typeof n&&(e=n.call(this,t,e))},this),e)}},v={asyncExec:function(t,e,n){var r=this,i=h.array(t.exec)?t.exec:[t.exec];p.eachSeries(i,function(n,i){if("function"==typeof n){if(n.length>2)return n.call(r,t,e,function(t,n){if(t)return i(t);e=n,i()});e=n.call(r,t,e)}i()},function(t){n(t,e)})},asyncProperties:function(t,e,n){if(!e||"object"!=typeof e)return n(null,e);var r=this,i=t.properties;p.series([function(t){if(null==i["*"])return t();var n=i["*"];p.eachSeries(Object.keys(e),function(t,u){if(t in i)return u();r._deeperObject(t),r._asyncSanitize(n,e[t],function(n,i){void 0!==i&&(e[t]=i),r._back(),u()})},t)},function(t){p.eachSeries(Object.keys(i),function(t,n){if("*"===t)return n();r._deeperObject(t),r._asyncSanitize(i[t],e[t],function(i,u){if(i)return n(i);void 0!==u&&(e[t]=u),r._back(),n()})},t)}],function(t){return n(t,e)})},asyncItems:function(t,e,n){if(!(t.items instanceof Object&&e instanceof Object))return n(null,e);var r=this,i=t.items;if(h.array(i)&&h.array(e)){var u=i.length<e.length?i.length:e.length;p.timesSeries(u,function(t,n){r._deeperArray(t),r._asyncSanitize(i[t],e[t],function(i,u){if(i)return n(i);e[t]=u,r._back(),n()})},function(t){n(t,e)})}else p.eachSeries(Object.keys(e),function(t,n){r._deeperArray(t),r._asyncSanitize(i,e[t],function(i,u){if(i)return n();e[t]=u,r._back(),n()})},function(t){n(t,e)});return e}};t(s.prototype,b),t(s.prototype,v),t(s,new n),s.prototype.sanitize=function(t,e){if(this.origin=t,"function"==typeof e){var n=this;return this._asyncSanitize(this._schema,t,function(t,r){n.origin=null,e(t,n.result(r))})}var r=this._sanitize(this._schema,t);return this.origin=null,this.result(r)},s.prototype._sanitize=function(t,e){return this.userAlias=t.alias||null,this._basicFields.forEach(function(n){(n in t||"optional"===n)&&"function"==typeof this[n]&&(e=this[n](t,e))},this),this._customFields.forEach(function(n){n in t&&"function"==typeof this._custom[n]&&(e=this._custom[n].call(this,t,e))},this),e},s.prototype._asyncSanitize=function(t,e,n){var r=this;this.userAlias=t.alias||null,p.waterfall([function(n){p.reduce(r._basicFields,e,function(e,n,i){p.nextTick(function(){if((n in t||"optional"===n)&&"function"==typeof r[n]){if(r[n].length>2)return r[n](t,e,i);e=r[n](t,e)}i(null,e)})},n)},function(e,n){p.reduce(r._customFields,e,function(e,n,i){p.nextTick(function(){if(n in t&&"function"==typeof r._custom[n]){if(r._custom[n].length>2)return r._custom[n].call(r,t,e,i);e=r._custom[n].call(r,t,e)}i(null,e)})},n)}],n)};var _=-2147483648,D=2147483647,x={int:function(t,e){return t+(0|Math.random()*(e-t+1))},float:function(t,e){return Math.random()*(e-t)+t},bool:function(){return Math.random()>.5},char:function(t,e){return String.fromCharCode(this.int(t,e))},fromList:function(t){return t[this.int(0,t.length-1)]}},j={"date-time":function(){return(new Date).toISOString()},date:function(){return(new Date).toISOString().replace(/T.*$/,"")},time:function(){return(new Date).toLocaleTimeString({},{hour12:!1})},color:function(t,e){var n="#";t<1&&(t=1);for(var r=0,i=x.int(t,e);r<i;r++)n+=x.fromList("0123456789abcdefABCDEF");return n},numeric:function(){return""+x.int(0,D)},integer:function(){return!0===x.bool()?"-"+this.numeric():this.numeric()},decimal:function(){return this.integer()+"."+this.numeric()},alpha:function(t,e){var n="";t<1&&(t=1);for(var r=0,i=x.int(t,e);r<i;r++)n+=x.fromList("abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ");return n},alphaNumeric:function(t,e){var n="";t<1&&(t=1);for(var r=0,i=x.int(t,e);r<i;r++)n+=x.fromList("abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789");return n},alphaDash:function(t,e){var n="";t<1&&(t=1);for(var r=0,i=x.int(t,e);r<i;r++)n+=x.fromList("_-abcdefghijklmnopqrstuvwxyz_-ABCDEFGHIJKLMNOPQRSTUVWXYZ_-0123456789_-");return n},javascript:function(t,e){for(var n=x.fromList("_$abcdefghijklmnopqrstuvwxyz_$ABCDEFGHIJKLMNOPQRSTUVWXYZ_$"),r=0,i=x.int(t,e-1);r<i;r++)n+=x.fromList("_$abcdefghijklmnopqrstuvwxyz_$ABCDEFGHIJKLMNOPQRSTUVWXYZ_$0123456789_$");return n}},N={string:function(t){if(null!=t.eq)return t.eq;var e="",n=null!=t.minLength?t.minLength:0,r=null!=t.maxLength?t.maxLength:32;if("string"==typeof t.pattern&&"function"==typeof j[t.pattern])return j[t.pattern](n,r);for(var i=null!=t.exactLength?t.exactLength:x.int(n,r),u=0;u<i;u++)e+=x.char(32,126);return e},number:function(t){if(null!=t.eq)return t.eq;var e=c(t),n=x.float(e.min,e.max);if(null!=t.ne)for(var r=h.array(t.ne)?t.ne:[t.ne];-1!==r.indexOf(n);)n=x.float(e.min,e.max);return n},integer:function(t){if(null!=t.eq)return t.eq;var e=c(t),n=x.int(e.min,e.max);if(null!=t.ne)for(var r=h.array(t.ne)?t.ne:[t.ne];-1!==r.indexOf(n);)n=x.int(e.min,e.max);return n},boolean:function(t){return null!=t.eq?t.eq:x.bool()},null:function(t){return null},date:function(t){return null!=t.eq?t.eq:new Date},object:function(t){var e={},n=t.properties||{};for(var r in n)if(n.hasOwnProperty(r)){if(!0===n[r].optional&&!0===x.bool())continue;if("*"!==r)e[r]=this.generate(n[r]);else for(var i="__random_key_",u=i+0,o=x.int(1,9),a=1;a<=o;a++)u in n||(e[u]=this.generate(n[r])),u=i+a}return e},array:function(t){var e,n,r,i,u=this,o=t.items||{},a=null!=t.minLength?t.minLength:0,s=null!=t.maxLength?t.maxLength:16;if(h.array(o))for(r=o.length,null!=t.exactLength?r=t.exactLength:r<a?r=a:r>s&&(r=s),n=new Array(r),e=null,i=0;i<r;i++)e=o[i].type||"any",h.array(e)&&(e=e[x.int(0,e.length-1)]),n[i]=u[e](o[i]);else for(r=null!=t.exactLength?t.exactLength:x.int(a,s),n=new Array(r),e=o.type||"any",h.array(e)&&(e=e[x.int(0,e.length-1)]),i=0;i<r;i++)n[i]=u[e](o);return n},any:function(t){var e=Object.keys(N);return this[e[x.int(0,e.length-2)]](t)}};t(f.prototype,N);var O=null;f.instance=function(){return O instanceof f||(O=new f),O},f.prototype.generate=function(t){var e=t.type||"any";return h.array(e)&&(e=e[x.int(0,e.length-1)]),this[e](t)};var A={};"undefined"!=typeof module&&module.exports?module.exports=A:window.SchemaInspector=A,A.newSanitization=function(t,e){return new s(t,e)},A.newValidation=function(t,e){return new a(t,e)},A.Validation=a,A.Sanitization=s,A.sanitize=function(t,e,n,r){return 3===arguments.length&&"function"==typeof n&&(r=n,n=null),new s(t,n).sanitize(e,r)},A.validate=function(t,e,n,r){return 3===arguments.length&&"function"==typeof n&&(r=n,n=null),new a(t,n).validate(e,r)},A.generate=function(t,e){if("number"==typeof e){for(var n=new Array(e),r=0;r<e;r++)n[r]=f.instance().generate(t);return n}return f.instance().generate(t)}}();
},{"./async.js":"/wrapper/src/libs/external/async.js"}],"/wrapper/src/libs/external/user-agent-matcher.js":[function(require,module,exports){
"use strict";function uaMatch(e){e=e.toLowerCase();var r=/(edge)\/([\w.]+)/.exec(e)||/(opr)[\/]([\w.]+)/.exec(e)||/(chrome)[ \/]([\w.]+)/.exec(e)||/(iemobile)[\/]([\w.]+)/.exec(e)||/(version)(applewebkit)[ \/]([\w.]+).*(safari)[ \/]([\w.]+)/.exec(e)||/(webkit)[ \/]([\w.]+).*(version)[ \/]([\w.]+).*(safari)[ \/]([\w.]+)/.exec(e)||/(webkit)[ \/]([\w.]+)/.exec(e)||/(opera)(?:.*version|)[ \/]([\w.]+)/.exec(e)||/(msie) ([\w.]+)/.exec(e)||e.indexOf("trident")>=0&&/(rv)(?::| )([\w.]+)/.exec(e)||e.indexOf("compatible")<0&&/(mozilla)(?:.*? rv:([\w.]+)|)/.exec(e)||[],i={},o={browser:r[5]||r[3]||r[1]||"",version:r[2]||r[4]||"0",versionNumber:r[4]||r[2]||"0"};if(o.browser&&(i[o.browser]=!0,i.version=o.version,i.versionNumber=parseInt(o.versionNumber,10)),i.rv||i.iemobile){o.browser="msie",i.msie=!0}if(i.edge){delete i.edge;o.browser="msedge",i.msedge=!0}if(i.opr){o.browser="opera",i.opera=!0}if(i.safari&&i.android){o.browser="android",i.android=!0}if(i.safari&&i.kindle){o.browser="kindle",i.kindle=!0}if(i.safari&&i.silk){o.browser="silk",i.silk=!0}return i.name=o.browser,i}module.exports=uaMatch(window.navigator.userAgent);
},{}],"/wrapper/src/libs/gpt-helper.js":[function(require,module,exports){
"use strict";function GptHelper(){function t(t,e){(e=e||window.googletag)&&e.cmd&&e.cmd.push(t)}function e(t){return t=t||window,t.googletag?t.googletag:(t.googletag=t.googletag||{},t.googletag.cmd=t.googletag.cmd||[],Network.jsonp({async:!0,url:Browser.getProtocol()+"//www.googletagservices.com/tag/js/gpt.js",windowScope:t}),t.googletag)}function o(t){return void 0===t?Browser.getNearestEntity("googletag"):Browser.traverseContextTree(function(t){return t.hasOwnProperty("googletag")?t.googletag:null},null,t,t)}function i(t){return Utilities.isObject(t)&&Utilities.isFunction(t.getSlotElementId)&&Utilities.isFunction(t.setTargeting)&&Utilities.isFunction(t.getTargeting)&&Utilities.isFunction(t.clearTargeting)}function r(){return googletag.pubads().getSlots().slice()}function g(t){for(var e=r(),o=0;o<e.length;o++)if(e[o].getSlotElementId()===t)return e[o];return null}return{run:t,loadGpt:e,getGpt:o,isGSlot:i,getGSlots:r,getGSlotByDivId:g}}var Browser=require("browser.js"),Network=require("network.js"),Utilities=require("utilities.js"),Whoopsie=require("whoopsie.js");module.exports=GptHelper();
},{"browser.js":"/wrapper/src/libs/browser.js","network.js":"/wrapper/src/libs/network.js","utilities.js":"/wrapper/src/libs/utilities.js","whoopsie.js":"/wrapper/src/libs/whoopsie.js"}],"/wrapper/src/libs/header-tag-slot.js":[function(require,module,exports){
"use strict";function HeaderTagSlot(e,n){function r(e,n){return Number(e)-Number(n)}function t(){return c}function i(){return d}function o(){return f}function a(){return l}function u(e,n){var t,i,o,a,u=[];t=Object.keys(h).sort(r);for(var p=t.length-1;p>=0;p--)if(o=t[p],!(Number(o)>e)){i=Object.keys(h[o]).sort(r);for(var s=i.length-1;s>=0;s--)if(a=i[s],!(Number(a)>n)){u=h[o][a];break}if(u.length>0)break}return u}function p(){return v}function s(){return y}function g(){return P}var c,d,f,l,h,v,y,P;return function(){if(c=e,d=n.id,f=null,l=null,h=null,v=null,y=null,P=null,n.hasOwnProperty("divId")&&(f=RegExp(n.divId)),n.hasOwnProperty("adUnitPath")&&(l=RegExp(n.adUnitPath)),n.hasOwnProperty("sizeMapping")){var r,t,i,o=/^(\d+)x(\d+)$/;h={};for(var a in n.sizeMapping)n.sizeMapping.hasOwnProperty(a)&&(r=o.exec(a),t=r[1],i=r[2],h.hasOwnProperty(t)||(h[t]={}),h[t][i]=n.sizeMapping[a])}n.hasOwnProperty("targeting")&&(v=n.targeting),n.hasOwnProperty("deviceType")&&(y=n.deviceType),n.hasOwnProperty("position")&&(P=n.position),n=void 0}(),{getName:t,getId:i,getDivId:o,getAdUnitPath:a,getSizes:u,getTargeting:p,getDeviceType:s,getPosition:g,__numericSortComparison:r,__sizeMapping:h}}var Whoopsie=require("whoopsie.js");module.exports=HeaderTagSlot;
},{"whoopsie.js":"/wrapper/src/libs/whoopsie.js"}],"/wrapper/src/libs/ht-slot-mapper.js":[function(require,module,exports){
"use strict";function HtSlotMapper(r){function e(r,e){for(var t=0;t<r.length;t++){var i,n;"!"===r[t].charAt(0)?(i=r[t].slice(1),n=!0):(i=r[t],n=!1);for(var a=!1,s=0;s<e.length;s++)if(i===e[s]){a=!0;break}if(n===a)return!1}return!0}function t(r,t){for(var i in r)if(r.hasOwnProperty(i)){if(!t.hasOwnProperty(i))return!1;if(!e(r[i],t[i]))return!1}return!0}function i(r,e){for(var t=0;t<o.length;t++)if(0===o[t](r,e))return!1;return!0}function n(r,e,t){for(var i=0;i<t.length;i++){if(t[i](r,e)<=0)return!1}return!0}function a(r,e){if(Utilities.isEmpty(o))return r.slice();for(var t=[],n=0;n<r.length;n++)for(var a=0;a<e.length;a++)if(i(e[a],r[n])){t.push(r[n]);break}return t}function s(r,e){if(Utilities.isEmpty(r)||Utilities.isEmpty(e))return[];for(var t=[],i=r.slice(),a=e.slice(),s=0;s<f.length;s++){for(var o=f[s],l=[],u=a.length-1;u>=0;u--){for(var h=[],c=-1,p=0;p<i.length;p++)if(n(a[u],i[p],o)){for(var g=[],v=0;v<o.length;v++){var y=o[v](a[u],i[p]);g.push(y)}for(var d=0;d<o.length;d++){if(!h[d]||g[d]>h[d]){h=g,c=p;break}if(g[d]<h[d])break}}if(c>=0){var _={};l[c]=!0,_.htSlot=i[c],a[u].firstPartyData&&(_.firstPartyData=a[u].firstPartyData),a[u].reference&&(_.ref=a[u].reference),t.push(_),a.splice(u,1)}}for(var w=i.length-1;w>=0;w--)l[w]&&i.splice(w,1)}return t}var f=[],o=[],l={divId:function(r,e){var t=e.getDivId();return t?t.test(r.divId)?1:0:-1},targeting:function(r,e){var i=e.getTargeting(),n=r.targeting;if(!i)return-1;for(var a=!1,s=0,f=0;f<i.length;f++)if(i[f])if(Utilities.isEmpty(i[f]))a=!0;else if(t(i[f],n)){var o=0;for(var l in i[f])i[f].hasOwnProperty(l)&&(o+=i[f][l].length);s=Math.max(s,o)}return a||s>0?s+1:0},size:function(r,e){var t=e.getSizes(Browser.getViewportWidth(),Browser.getViewportHeight());if(!t)return-1;for(var i=0,n=0;n<t.length;n++){for(var a=0,s=0;s<r.sizes.length;s++)if(t[n][0]===r.sizes[s][0]&&t[n][1]===r.sizes[s][1]){a++;break}if(0===a)return 0;i+=a}return 0===i?0:Math.ceil(100*i/r.sizes.length)},deviceType:function(r,e){var t=e.getDeviceType();return t?t===SpaceCamp.DeviceTypeChecker.getDeviceType()?1:0:-1},adUnitPath:function(r,e){var t=e.getAdUnitPath();return t?t.test(r.adUnitPath)?1:0:-1}};return function(){for(var e=0;e<r.filters.length;e++){if(!l.hasOwnProperty(r.filters[e]))throw Whoopsie("INVALID_CONFIG","Cannot find function "+r.filters[e]+" in HtSlotMapper");o.push(l[r.filters[e]])}for(var t=0;t<r.selectors.length;t++){var i=[],n=r.selectors[t];if(Utilities.isString(n))i.push(l[n]);else for(var a=0;a<n.length;a++)i.push(l[n[a]]);f.push(i)}}(),{__selectors:f,__filters:o,__matcherFunctions:l,select:s,filter:a,__doesTargetArrayMatch:e,__doesTargetingMapMatch:t,__doAllFiltersPass:i}}var Browser=require("browser.js"),SpaceCamp=require("space-camp.js"),Utilities=require("utilities.js"),Whoopsie=require("whoopsie.js");module.exports=HtSlotMapper;
},{"browser.js":"/wrapper/src/libs/browser.js","space-camp.js":"/wrapper/src/space-camp.js","utilities.js":"/wrapper/src/libs/utilities.js","whoopsie.js":"/wrapper/src/libs/whoopsie.js"}],"/wrapper/src/libs/network.js":[function(require,module,exports){
"use strict";function Network(){function e(){return a}function t(e){var t="";for(var r in e)if(e.hasOwnProperty(r))if(Utilities.isObject(e[r]))for(var n in e[r])e[r].hasOwnProperty(n)&&(t+=r+"%5B"+n+"%5D="+encodeURIComponent(e[r][n])+"&");else if(Utilities.isArray(e[r]))for(var i=0;i<e[r].length;i++)t+=r+"%5B%5D="+encodeURIComponent(e[r][i])+"&";else t+=r+"="+encodeURIComponent(e[r])+"&";return t.slice(0,-1)}function r(e,r,n){return"/"!==e[e.length-1]&&r&&(e+="/"),r=r||[],Utilities.isObject(n)&&(n=t(n)),n=n?"?"+n:"",e+r.join("/")+n}function n(e){var n,i=null,o=e.scope||window;if(e.useImgTag)n=o.document.createElement("img");else{n=o.document.createElement("script"),n.type="text/javascript";var a=!0;e.hasOwnProperty("async")&&(a=e.async),n.async=a}var s=e.url;if(e.data){var u;u=Utilities.isString(e.data)?e.data:t(e.data),s=r(e.url,null,u)}var c,l=!1,d=function(){try{if(l)return;l=!0,e.onTimeout&&e.onTimeout(),e.useImgTag||e.continueAfterTimeout||n.parentNode.removeChild(n)}catch(e){}};e.globalTimeout&&SpaceCamp.services.TimerService.addTimerCallback(e.sessionId,d),e.timeout&&(c=setTimeout(d,e.timeout));var m=function(){try{if(l){if(!e.continueAfterTimeout)return}else clearTimeout(c);e.onSuccess&&e.onSuccess(null,System.now(),l),l=!0,e.useImgTag||n.parentNode.removeChild(n)}catch(e){}};null===n.onload?n.onload=m:n.onreadystatechange=function(){"loaded"!==n.readyState&&"complete"!==n.readyState||(n.onreadystatechange=null,m())};var p=function(){try{if(l){if(!e.continueAfterTimeout)return}else clearTimeout(c),l=!0;e.onFailure&&e.onFailure(),e.useImgTag||n.parentNode.removeChild(n)}catch(e){}};if(n.onerror=p,i=System.now(),n.src=s,!e.useImgTag){var f=o.document.getElementsByTagName("script")[0];f?f.parentNode.insertBefore(n,f):UserAgentMatcher.msie||UserAgentMatcher.msedge||UserAgentMatcher.mozilla?o.onload=function(){o.document.body.appendChild(n)}:o.document.body.appendChild(n)}return i}function i(i){if(!e()){if(i.jsonp&&"GET"===i.method)return n(i);throw Whoopsie("INTERNAL_ERROR","XHR is not supported in this browser.")}var o=null,a=i.scope||window,s=new a.XMLHttpRequest,u=i.url,c=null;if(i.data)if("GET"===i.method){var l;l=Utilities.isString(i.data)?i.data:t(i.data),u=r(i.url,null,l)}else"POST"===i.method&&(c=Utilities.isString(i.data)?i.data:JSON.stringify(i.data));var d=!0;i.hasOwnProperty("async")&&(d=i.async),s.open(i.method,u,d);var m="application/x-www-form-urlencoded; charset=UTF-8";if(void 0!==i.contentType&&(m=i.contentType),m&&s.setRequestHeader("Content-Type",m),i.headers){i.headers.hasOwnProperty("X-Request-With")||s.setRequestHeader("X-Request-With","XMLHttpRequest");for(var p in i.headers)i.headers.hasOwnProperty(p)&&s.setRequestHeader(p,i.headers[p])}i.withCredentials&&(s.withCredentials=!0);var f,h=!1,y=function(){try{if(h)return;h=!0,i.onTimeout&&i.onTimeout()}catch(e){}};return i.globalTimeout&&SpaceCamp.services.TimerService.addTimerCallback(i.sessionId,y),i.timeout&&(i.continueAfterTimeout?f=setTimeout(y,i.timeout):(s.timeout=i.timeout,s.ontimeout=y)),(i.onSuccess||i.onFailure)&&(s.onreadystatechange=function(){if(4===s.readyState){if(h){if(!i.continueAfterTimeout)return}else clearTimeout(f),s.ontimeout=null;if(200===s.status){if(i.onSuccess)try{i.onSuccess(s.responseText,System.now(),h)}catch(e){}}else if(i.onFailure)try{i.onFailure(s.status)}catch(e){}h=!0}}),o=System.now(),s.send(c),o}function o(e){return e.useImgTag=!0,n(e)}var a;return function(){a=window.XMLHttpRequest&&"string"==typeof(new XMLHttpRequest).responseType}(),{ajax:i,jsonp:n,img:o,buildUrl:r,objToQueryString:t,isXhrSupported:e}}var SpaceCamp=require("space-camp.js"),System=require("system.js"),Utilities=require("utilities.js"),Whoopsie=require("whoopsie.js"),UserAgentMatcher=require("user-agent-matcher.js");module.exports=Network();
},{"space-camp.js":"/wrapper/src/space-camp.js","system.js":"/wrapper/src/libs/system.js","user-agent-matcher.js":"/wrapper/src/libs/external/user-agent-matcher.js","utilities.js":"/wrapper/src/libs/utilities.js","whoopsie.js":"/wrapper/src/libs/whoopsie.js"}],"/wrapper/src/libs/openrtb.js":[function(require,module,exports){
"use strict";function OpenRtb(){function e(){if(!(this instanceof e))return new e;this.__bidRequest={id:Number(System.generateUniqueId(8,"NUM")),site:{page:""},imp:[]},this.__impCount=0}function t(e){if(!(this instanceof t))return new t(e);try{this.__bidResponse=e}catch(e){throw Whoopsie("INTERNAL_ERROR","cannot parse `bidResponse`")}}return e.prototype.setPage=function(e){this.__bidRequest.site.page=e},e.prototype.setRef=function(e){this.__bidRequest.site.ref=e},e.prototype.getId=function(){return this.__bidRequest.id},e.prototype.addImp=function(e,t,s,i){var r=String(++this.__impCount);return this.__bidRequest.imp.push({banner:e,ext:t,id:r,bidfloor:s,bidfloorcur:i}),r},e.prototype.addUserEid=function(e){this.__bidRequest.user=this.__bidRequest.user||{},this.__bidRequest.user.eids=this.__bidRequest.user.eids||[],this.__bidRequest.user.eids.push(e)},e.prototype.setGdprConsent=function(e,t){this.__bidRequest.regs=this.__bidRequest.regs||{},this.__bidRequest.regs.ext=this.__bidRequest.regs.ext||{},this.__bidRequest.regs.ext.gdpr=e?1:0,this.__bidRequest.user=this.__bidRequest.user||{},this.__bidRequest.user.ext=this.__bidRequest.user.ext||{},this.__bidRequest.user.ext.consent=t||""},e.prototype.setExt=function(e){this.__bidRequest.ext=e},e.prototype.stringify=function(){return JSON.stringify(this.__bidRequest)},t.prototype.__parseBid=function(e,t){var s={};e.hasOwnProperty("impid")&&(s.impid=e.impid),e.hasOwnProperty("price")&&(s.price=e.price),e.hasOwnProperty("adm")&&(s.adm=e.adm),e.hasOwnProperty("ext")&&(s.ext=e.ext),e.hasOwnProperty("dealid")&&(s.dealid=e.dealid),e.hasOwnProperty("nurl")&&(s.nurl=e.nurl),e.hasOwnProperty("nbr")&&(s.nbr=e.nbr),e.hasOwnProperty("w")&&(s.w=e.w),e.hasOwnProperty("h")&&(s.h=e.h),t.push(s)},t.prototype.getId=function(){return this.__bidResponse.id},t.prototype.getCur=function(){return this.__bidResponse.cur||"USD"},t.prototype.getExt=function(){return this.__bidResponse.ext},t.prototype.getBids=function(){var e,t,s=[];if(!this.__bidResponse.hasOwnProperty("seatbid"))return s;t=this.__bidResponse.seatbid;for(var i=0;i<t.length;i++)if(t[i].hasOwnProperty("bid")){e=t[i].bid;for(var r=0;r<e.length;r++)this.__parseBid(e[r],s)}return s},{BidRequest:e,BidResponse:t}}var Constants=require("constants.js"),System=require("system.js"),Whoopsie=require("whoopsie.js");module.exports=OpenRtb();
},{"constants.js":"/wrapper/src/libs/constants.js","system.js":"/wrapper/src/libs/system.js","whoopsie.js":"/wrapper/src/libs/whoopsie.js"}],"/wrapper/src/libs/openrtb2_5.js":[function(require,module,exports){
"use strict";function OpenRtb(){function e(){if(!(this instanceof e))return new e;this.__bidRequest={id:System.generateUniqueId(8,"NUM"),site:{page:""},imp:[]},this.__impCount=0}function t(e){if(!(this instanceof t))return new t(e);this.__bidResponse=e}return e.prototype.setPage=function(e){this.__bidRequest.site.page=e},e.prototype.setRef=function(e){this.__bidRequest.site.ref=e},e.prototype.setSiteId=function(e){this.__bidRequest.site.id=e},e.prototype.setPublisher=function(e){this.__bidRequest.site.publisher=e},e.prototype.setSiteExt=function(e){this.__bidRequest.site.ext=e},e.prototype.deviceTypeMapping={desktop:2,mobile:4,tablet:5},e.prototype.setDeviceType=function(e){this.__bidRequest.device=this.__bidRequest.device||{},this.__bidRequest.device.devicetype=this.deviceTypeMapping[e]?this.deviceTypeMapping[e]:e},e.prototype.setSource=function(e){this.__bidRequest.source=e},e.prototype.setTmax=function(e){this.__bidRequest.tmax=e},e.prototype.setAuctionType=function(e){this.__bidRequest.at=e},e.prototype.setExt=function(e){this.__bidRequest.ext=e},e.prototype.setTest=function(){this.__bidRequest.test=1},e.prototype.getId=function(){return this.__bidRequest.id},e.prototype.addImp=function(e){return e.id||(e.id=String(++this.__impCount)),this.__bidRequest.imp.push(e),e.id},e.prototype.setImps=function(e){this.__bidRequest.imp=e},e.prototype.setGdprConsent=function(e,t){this.__bidRequest.regs=this.__bidRequest.regs||{},this.__bidRequest.regs.ext=this.__bidRequest.regs.ext||{},this.__bidRequest.regs.ext.gdpr=e?1:0,this.__bidRequest.user=this.__bidRequest.user||{},this.__bidRequest.user.ext=this.__bidRequest.user.ext||{},this.__bidRequest.user.ext.consent=t||""},e.prototype.stringify=function(){return JSON.stringify(this.__bidRequest)},t.prototype.__parseBid=function(e,t){var i={};e.hasOwnProperty("impid")&&(i.impid=e.impid),e.hasOwnProperty("price")&&(i.price=e.price),e.hasOwnProperty("adm")&&(i.adm=e.adm),e.hasOwnProperty("ext")&&(i.ext=e.ext),e.hasOwnProperty("dealid")&&(i.dealid=e.dealid),e.hasOwnProperty("nurl")&&(i.nurl=e.nurl),e.hasOwnProperty("nbr")&&(i.nbr=e.nbr),e.hasOwnProperty("w")&&(i.w=e.w),e.hasOwnProperty("h")&&(i.h=e.h),t.push(i)},t.prototype.getId=function(){return this.__bidResponse.id},t.prototype.getCur=function(){return this.__bidResponse.cur||"USD"},t.prototype.getBids=function(){var e,t,i=[];if(!this.__bidResponse.hasOwnProperty("seatbid"))return i;t=this.__bidResponse.seatbid;for(var s=0;s<t.length;s++)if(t[s].hasOwnProperty("bid")){e=t[s].bid;for(var r=0;r<e.length;r++)this.__parseBid(e[r],i)}return i},{BidRequest:e,BidResponse:t}}var Constants=require("constants.js"),System=require("system.js"),Whoopsie=require("whoopsie.js");module.exports=OpenRtb();
},{"constants.js":"/wrapper/src/libs/constants.js","system.js":"/wrapper/src/libs/system.js","whoopsie.js":"/wrapper/src/libs/whoopsie.js"}],"/wrapper/src/libs/scribe.js":[function(require,module,exports){
"use strict";function Scribe(){function e(){for(var e,o="unknown",n=/at\s(.+)/g,i=Error().stack,r=0;null!==(e=n.exec(i));){if(2===r){o=e[1];break}r++}return(p?p+" | ":"")+o+":"}function o(e){g=Scribe.LoggingLevels[e]}function n(e){p=e}function i(){window.console=__dummyConsole}function r(){window.console=console}function c(){if(!(g<Scribe.LoggingLevels.ERROR)){var o=Array.prototype.slice.call(arguments);o.unshift(e()),console.error.apply(console,o)}}function l(){if(!(g<Scribe.LoggingLevels.WARN)){var o=Array.prototype.slice.call(arguments);o.unshift(e()),console.warn.apply(console,o)}}function s(){if(!(g<Scribe.LoggingLevels.INFO)){var o=Array.prototype.slice.call(arguments);o.unshift(e()),console.info.apply(console,o)}}function t(){g<Scribe.LoggingLevels.INFO||(console.info.apply(console,[e()]),console.table.apply(console,arguments))}function a(){if(!(g<Scribe.LoggingLevels.DEBUG)){var o=Array.prototype.slice.call(arguments);o.unshift(e()),console.debug.apply(console,o)}}var g,p;return function(){g=Scribe.LoggingLevels.DEBUG,p=SpaceCamp.NAMESPACE+"_"+System.generateUniqueId(4)}(),{__type__:"Scribe",__getPrefix:e,disableNativeLogging:i,enableNativeLogging:r,setLevel:o,setHeader:n,error:c,warn:l,info:s,table:t,debug:a}}var SpaceCamp=require("space-camp.js"),System=require("system.js"),Whoopsie=require("whoopsie.js");Scribe.LoggingLevels={SILENT:0,ERROR:1,WARN:2,INFO:3,DEBUG:4},module.exports=Scribe();
},{"space-camp.js":"/wrapper/src/space-camp.js","system.js":"/wrapper/src/libs/system.js","whoopsie.js":"/wrapper/src/libs/whoopsie.js"}],"/wrapper/src/libs/size.js":[function(require,module,exports){
"use strict";function Size(){function r(r){return u[r]}function i(r){return!(!Utilities.isArray(r,"number")||2!==r.length)}function e(r){if(i(r))return!0;if(!Utilities.isArray(r,"array"))return!1;for(var e=0;e<r.length;e++)if(!i(r[e]))return!1;return!0}function t(i,e,t){e=e||",",t=t||"x";var n="";if(Utilities.isArray(i,"array"))for(var u=0;u<i.length;u++)n+=r(i[u])?i[u]:i[u][0]+t+i[u][1]+e;else r(i)?n+=i+e:n+=i[0]+t+i[1]+e;return n.slice(0,-1)}function n(i,e,t){e=e||",",t=t||"x";for(var n=[],u=i.split(e),s=0;s<u.length;s++)if(r(u[s]))n.push(u[s]);else{var a=u[s].split(t);n.push([Number(a[0]),Number(a[1])])}return n}var u={native:!0,fullwidth:!0};return{arrayToString:t,stringToArray:n,isSpecialSize:r,isSize:i,isSizes:e}}var Utilities=require("utilities.js");module.exports=Size();
},{"utilities.js":"/wrapper/src/libs/utilities.js"}],"/wrapper/src/libs/system.js":[function(require,module,exports){
"use strict";function System(){function t(t,e){t.open("text/html","replace"),t.write(e),t.close()}function e(t,e){t=t||Constants.DEFAULT_UID_LENGTH,e=e||Constants.DEFAULT_UID_CHARSET;for(var n="",r=0;r<t;r++)n+=s[e].charAt(Math.floor(Math.random()*s[e].length));return n}function n(){return e(8,"HEX")+"-"+e(4,"HEX")+"-4"+e(3,"HEX")+"-"+"89ab".charAt(Math.floor(4*Math.random()))+e(3,"HEX")+"-"+e(8,"HEX")}function r(){return(new Date).getTime()}function o(){return i.getTimezoneOffset()}function a(){}var i,s={ALPHANUM:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",ALPHA:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz",ALPHA_UPPER:"ABCDEFGHIJKLMNOPQRSTUVWXYZ",ALPHA_LOWER:"abcdefghijklmnopqrstuvwxyz",HEX:"0123456789abcdef",NUM:"0123456789"};return function(){i=new Date}(),{UidCharacterSets:s,generateUniqueId:e,generateUuid:n,now:r,getTimezoneOffset:o,documentWrite:t,noOp:a}}var Constants=require("constants.js"),Whoopsie=require("whoopsie.js");module.exports=System();
},{"constants.js":"/wrapper/src/libs/constants.js","whoopsie.js":"/wrapper/src/libs/whoopsie.js"}],"/wrapper/src/libs/utilities.js":[function(require,module,exports){
"use strict";function Utilities(){function r(r){return void 0===r?"undefined":{}.toString.call(r).match(E)[1].toLowerCase()}function n(n){return"string"===r(n)}function t(n){return"number"===r(n)&&!isNaN(n)}function e(n){return"number"===r(n)||"string"===r(n)&&!isNaN(Number(n))}function i(r){return t(r)&&r%1==0}function o(n){return"function"===r(n)}function u(n){return"boolean"===r(n)}function a(n){return"object"===r(n)}function l(n){return"regexp"===r(n)}function c(r,n){var t=r.indexOf(n);t>-1&&r.splice(t,1)}function f(t,e,i){if("array"!==r(t))return!1;if(void 0!==e){if(!n(e))throw Whoopsie("INVALID_TYPE","`type` must be a string");if("class"===e){if(!n(i))throw Whoopsie("INVALID_TYPE","`className` must be a string");for(var o=0;o<t.length;o++)if("object"!=typeof t[o]||t[o].__type__!==i)return!1}else for(var u=0;u<t.length;u++)if(r(t[u])!==e)return!1}return!0}function s(r){return r.length?r.splice(Math.floor(Math.random()*r.length),1)[0]:null}function g(r){return JSON.parse(JSON.stringify(r))}function h(){for(var r=Array.prototype.slice.call(arguments),n={},t=0;t<r.length;t++)for(var e in r[t])r[t].hasOwnProperty(e)&&(n[e]=r[t][e]);return n}function p(){for(var r=Array.prototype.slice.call(arguments),n=[],t=0;t<r.length;t++)for(var e=0;e<r[t].length;e++)n.push(r[t][e]);return n}function y(r){if(n(r)){if(""!==r)return!1}else if(a(r)){for(var t in r)if(r.hasOwnProperty(t))return!1}else{if(!f(r))throw Whoopsie("INVALID_TYPE","`entity` must be either a string, object, or an array");if(r.length)return!1}return!0}function v(r,n,t){void 0===t&&(t=j);for(var e=0;e<r.length;e++){for(var i=!1,o=0;o<n.length&&!(i=t(r[e],n[o]));o++);if(!i)return!1}return!0}function m(r,n,t,e){return n=n||[],e=e||null,t=t||"Error occurred while calling function.",function(){try{r.apply(e,n)}catch(r){}}}function b(r,n){var t=""+r;if(n=+n,n!=n&&(n=0),n<0)throw new RangeError("repeat count must be non-negative");if(n==1/0)throw new RangeError("repeat count must be less than infinity");if(n=Math.floor(n),0==t.length||0==n)return"";if(t.length*n>=1<<28)throw new RangeError("repeat count must not overflow maximum string size");for(var e="",i=0;i<n;i++)e+=t;return e}function d(r,n,t){return n>>=0,t=String(t||" "),r.length>n?String(r):(n-=r.length,n>t.length&&(t+=b(t,n/t.length)),t.slice(0,n)+String(r))}function w(r,n,t){return n>>=0,t=String(t||" "),r.length>n?String(r):(n-=r.length,n>t.length&&(t+=b(t,n/t.length)),String(r)+t.slice(0,n))}function S(r,n){n=n||null;try{return eval.call(n,r)}catch(r){}return null}function N(r,n,t){t=t||null;try{return eval.call(t,r+"("+n.join()+")")}catch(r){}return null}function A(){for(var r=Array.prototype.slice.call(arguments),n=r[0],t=1;t<r.length;t++)Array.prototype.push.apply(n,r[t]);return n}var E=/\s([a-zA-Z]+)/,j=function(r,n){return r===n};return{randomSplice:s,deepCopy:g,mergeObjects:h,mergeArrays:p,isArray:f,isEmpty:y,isInteger:i,isString:n,isNumeric:e,isRegex:l,isNumber:t,isBoolean:u,isFunction:o,isObject:a,isArraySubset:v,getType:r,tryCatchWrapper:m,arrayDelete:c,repeatString:b,padStart:d,padEnd:w,evalVariable:S,evalFunction:N,appendToArray:A}}var Whoopsie=require("whoopsie.js");module.exports=Utilities();
},{"whoopsie.js":"/wrapper/src/libs/whoopsie.js"}],"/wrapper/src/libs/whoopsie.js":[function(require,module,exports){
"use strict";function Whoopsie(I,E){return new Error(I+": "+E)}Whoopsie.ErrorTokens={MISSING_ARGUMENT:1,INVALID_TYPE:2,INVALID_VALUE:3,MISSING_PROPERTY:4,NUMBER_OUT_OF_RANGE:5,EMPTY_ENTITY:6,INTERNAL_ERROR:7,DUPLICATE_ENTITY:8,INVALID_ARGUMENT:9,INVALID_CONFIG:10},module.exports=Whoopsie;
},{}],"/wrapper/src/loader.js":[function(require,module,exports){
"use strict";function Loader(e){function r(){return __directInterface}var __directInterface;return function(){SpaceCamp.DeviceTypeChecker=DeviceTypeChecker(e.DeviceTypeChecker);for(var r in e.htSlots)if(e.htSlots.hasOwnProperty(r)){var t=HeaderTagSlot(r,e.htSlots[r]);SpaceCamp.htSlots.push(t),SpaceCamp.htSlotsMap[r]=t}__directInterface={Services:{},Layers:{}};for(var c=0;c<ServiceConstructors.length;c++){var s=ServiceConstructors[c].name,i=ServiceConstructors[c].constructor(e.Services[s]);i&&(SpaceCamp.services[s]=i,i.getDirectInterface&&i.getDirectInterface()&&(__directInterface.Services=Utilities.mergeObjects(__directInterface.Services,i.getDirectInterface())))}for(var a,o=e.Layers.length-1;o>=0;o--){var n=e.Layers[o].layerId,u=LayerConstructors[n](e.Layers[o].configs);u.getDirectInterface()&&(__directInterface.Layers=Utilities.mergeObjects(__directInterface.Layers,u.getDirectInterface())),a&&u.setNext(a.execute),a=u}}(),{getDirectInterface:r}}var DeviceTypeChecker=require("device-type-checker.js"),HeaderTagSlot=require("header-tag-slot.js"),SpaceCamp=require("space-camp.js"),Utilities=require("utilities.js"),Whoopsie=require("whoopsie.js"),ServiceConstructors=[{name:"EventsService",constructor:require("events-service.js")},{name:"HeaderStatsService",constructor:require("header-stats-service.js")},{name:"TimerService",constructor:require("timer-service.js")},{name:"ComplianceService",constructor:require("compliance-service.js")},{name:"RenderService",constructor:require("render-service.js")}],LayerConstructors={GptLayer:require("gpt-layer.js"),MediationLayer:require("mediation-layer.js"),PartnersLayer:require("partners-layer.js"),IdentityLayer:require("identity-layer.js")};module.exports=Loader;
},{"compliance-service.js":"/wrapper/src/services/compliance-service.js","device-type-checker.js":"/wrapper/src/libs/device-type-checker.js","events-service.js":"/wrapper/src/services/events-service.js","gpt-layer.js":"/wrapper/src/layers/gpt-layer.js","header-stats-service.js":"/wrapper/src/services/header-stats-service.js","header-tag-slot.js":"/wrapper/src/libs/header-tag-slot.js","identity-layer.js":"/wrapper/src/layers/identity-layer.js","mediation-layer.js":"/wrapper/src/layers/mediation-layer.js","partners-layer.js":"/wrapper/src/layers/partners-layer.js","render-service.js":"/wrapper/src/services/render-service.js","space-camp.js":"/wrapper/src/space-camp.js","timer-service.js":"/wrapper/src/services/timer-service.js","utilities.js":"/wrapper/src/libs/utilities.js","whoopsie.js":"/wrapper/src/libs/whoopsie.js"}],"/wrapper/src/modules/gpt-layer/gpt-clear-targeting.js":[function(require,module,exports){
"use strict";function GptClearTargeting(e,r){function t(e){var t;t=r.pageDemandHistory;for(var a in t)t.hasOwnProperty(a)&&(window.googletag.pubads().clearTargeting(a),delete t[a]);t=r.gSlotDemandHistory;for(var o=0;o<e.length;o++)if(e[o].ref){var n=e[o].ref,i=n.getSlotElementId();if(t.hasOwnProperty(i)){for(var g in t[i])t[i].hasOwnProperty(g)&&n.clearTargeting(g);delete t[i]}}}return function(){r.gSlotDemandHistory=r.gSlotDemandHistory||{},r.pageDemandHistory=r.pageDemandHistory||{}}(),{clearTargeting:t}}var GptHelper=require("gpt-helper.js"),Whoopsie=require("whoopsie.js");module.exports=GptClearTargeting;
},{"gpt-helper.js":"/wrapper/src/libs/gpt-helper.js","whoopsie.js":"/wrapper/src/libs/whoopsie.js"}],"/wrapper/src/modules/gpt-layer/gpt-destroy-slots.js":[function(require,module,exports){
"use strict";function GptDestroySlots(e,t){function o(e){return s?s(e):window.googletag.destroySlots(e)}function r(e){for(var r=e||GptHelper.getGSlots(),s=0;s<r.length;s++)t.gSlotDisplayHistory.hasOwnProperty(r[s].getSlotElementId())&&delete t.gSlotDisplayHistory[r[s].getSlotElementId()];return o(e)}var s;return function(){t.hasOwnProperty("gSlotDisplayHistory")||(t.gSlotDisplayHistory={});var o=function(){e.override&&e.override.destroySlots&&(s=SpaceCamp.LastLineGoogletag.destroySlots)};SpaceCamp.initQueue.push(o)}(),{destroySlots:r}}var SpaceCamp=require("space-camp.js"),GptHelper=require("gpt-helper.js"),Whoopsie=require("whoopsie.js");module.exports=GptDestroySlots;
},{"gpt-helper.js":"/wrapper/src/libs/gpt-helper.js","space-camp.js":"/wrapper/src/space-camp.js","whoopsie.js":"/wrapper/src/libs/whoopsie.js"}],"/wrapper/src/modules/gpt-layer/gpt-display.js":[function(require,module,exports){
"use strict";function GptDisplay(e,t,s){function r(e){return c?c(e):window.googletag.display(e)}function i(e){if(t.requestArchitecture===Constants.RequestArchitectures.SRA)for(;p.length;){if(!p[0].done)return;var s=p.shift();s.outParcels&&!Utilities.isEmpty(s.outParcels)&&o(s.outParcels),s.parcels&&!Utilities.isEmpty(s.parcels)&&l(s.sessionId,s.parcels),r(s.divId)}else e.outParcels&&!Utilities.isEmpty(e.outParcels)&&o(e.outParcels),e.parcels&&!Utilities.isEmpty(e.parcels)&&l(e.sessionId,e.parcels),r(e.divId)}function a(e){var r={done:!1,divId:e,outParcels:null,parcels:null,sessionId:""};t.requestArchitecture===Constants.RequestArchitectures.SRA&&p.push(r);var a=GptHelper.getGSlotByDivId(e);if(!a)return r.done=!0,i(r),Prms.resolve();var o=[];o=t.requestArchitecture===Constants.RequestArchitectures.SRA?GptHelper.getGSlots():a?[a]:[];for(var l=o.length-1;l>=0;l--)t.gSlotDisplayHistory.hasOwnProperty(o[l].getSlotElementId())&&o.splice(l,1);if(!o.length)return r.done=!0,i(r),Prms.resolve();for(var c=[],u=0;u<o.length;u++)c.push({slot:o[u]}),t.gSlotDisplayHistory[o[u].getSlotElementId()]=!0;if(t.initialLoadState===Constants.InitialLoadStates.DISABLED)return r.done=!0,i(r),Prms.resolve();var d=n(c);if(r.outParcels=d,!d.length)return EventsService.emit("warning","No valid Header Tag slots found in call to display."),r.done=!0,i(r),Prms.resolve();var v=TimerService.createTimer(t.globalTimeout,!0);return TimerService.addTimerCallback(v,function(){EventsService.emit("global_timeout_reached",{sessionId:v})}),r.sessionId=v,EventsService.emit("hs_session_start",{sessionId:v}),s(v,d).then(function(e){r.parcels=e,r.done=!0,i(r),EventsService.emit("hs_session_end",{sessionId:v})})}var n,o,l,c,p;return function(){EventsService=SpaceCamp.services.EventsService,TimerService=SpaceCamp.services.TimerService,t.hasOwnProperty("gSlotDisplayHistory")||(t.gSlotDisplayHistory={}),t.hasOwnProperty("requestArchitecture")||(t.requestArchitecture=Constants.RequestArchitectures.MRA),t.hasOwnProperty("initialLoadState")||(t.initialLoadState=Constants.InitialLoadStates.ENABLED);var s=function(){e.override&&e.override.display&&(c=SpaceCamp.LastLineGoogletag.display)};SpaceCamp.initQueue.push(s),n=GptMapSlots(e,t).mapHtSlots,o=GptClearTargeting(e,t).clearTargeting,l=GptSetTargeting(e,t).setTargeting,p=[]}(),{display:a}}var GptHelper=require("gpt-helper.js"),Prms=require("prms.js"),Constants=require("constants.js"),SpaceCamp=require("space-camp.js"),Whoopsie=require("whoopsie.js"),Utilities=require("utilities.js"),GptMapSlots=require("gpt-map-slots.js"),GptClearTargeting=require("gpt-clear-targeting.js"),GptSetTargeting=require("gpt-set-targeting.js"),TimerService,EventsService;module.exports=GptDisplay;
},{"constants.js":"/wrapper/src/libs/constants.js","gpt-clear-targeting.js":"/wrapper/src/modules/gpt-layer/gpt-clear-targeting.js","gpt-helper.js":"/wrapper/src/libs/gpt-helper.js","gpt-map-slots.js":"/wrapper/src/modules/gpt-layer/gpt-map-slots.js","gpt-set-targeting.js":"/wrapper/src/modules/gpt-layer/gpt-set-targeting.js","prms.js":"/wrapper/src/libs/external/prms.js","space-camp.js":"/wrapper/src/space-camp.js","utilities.js":"/wrapper/src/libs/utilities.js","whoopsie.js":"/wrapper/src/libs/whoopsie.js"}],"/wrapper/src/modules/gpt-layer/gpt-map-slots.js":[function(require,module,exports){
"use strict";function GptMapSlots(t,e){function r(t){for(var e=[],r=0;r<t.length;r++){var i=t[r].slot,a={reference:i};t[r].firstPartyData&&(a.firstPartyData=t[r].firstPartyData),a.divId=i.getSlotElementId();var p=[],o=i.getSizes(Browser.getViewportWidth(),Browser.getViewportHeight())||i.getSizes();if(o){for(var g=0;g<o.length;g++)Utilities.isString(o[g])||p.push([o[g].getWidth(),o[g].getHeight()]);for(var n={},l=i.getTargetingKeys(),u=0;u<l.length;u++)n[l[u]]=i.getTargeting(l[u]).map(function(t){return String(t)});a.sizes=p,a.targeting=n,a.adUnitPath=i.getAdUnitPath(),e.push(a)}}var h=SpaceCamp.htSlots,f=s.filter(h,e);return s.select(f,e)}var i,s;return function(){i=e,s=HtSlotMapper(t.slotMapping)}(),{mapHtSlots:r}}var Browser=require("browser.js"),GptHelper=require("gpt-helper.js"),HtSlotMapper=require("ht-slot-mapper.js"),SpaceCamp=require("space-camp.js"),Utilities=require("utilities.js"),Whoopsie=require("whoopsie.js");module.exports=GptMapSlots;
},{"browser.js":"/wrapper/src/libs/browser.js","gpt-helper.js":"/wrapper/src/libs/gpt-helper.js","ht-slot-mapper.js":"/wrapper/src/libs/ht-slot-mapper.js","space-camp.js":"/wrapper/src/space-camp.js","utilities.js":"/wrapper/src/libs/utilities.js","whoopsie.js":"/wrapper/src/libs/whoopsie.js"}],"/wrapper/src/modules/gpt-layer/gpt-options.js":[function(require,module,exports){
"use strict";function GptOptions(e,t){function a(){return o?o():window.googletag.pubads().enableSingleRequest()}function n(){return r?r():window.googletag.pubads().disableInitialLoad()}function i(){return t.requestArchitecture=Constants.RequestArchitectures.SRA,a()}function s(){return t.initialLoadState=Constants.InitialLoadStates.DISABLED,n()}var o,r;return function(){t.requestArchitecture=e.enableSingleRequest?Constants.RequestArchitectures.SRA:Constants.RequestArchitectures.MRA,t.initialLoadState=e.disableInitialLoad?Constants.InitialLoadStates.DISABLED:Constants.InitialLoadStates.ENABLED;var a=function(){e.override&&(e.override.enableSingleRequest&&(o=SpaceCamp.LastLineGoogletag.enableSingleRequest),e.override.disableInitialLoad&&(r=SpaceCamp.LastLineGoogletag.disableInitialLoad))};SpaceCamp.initQueue.push(a)}(),{enableSingleRequest:i,disableInitialLoad:s}}var SpaceCamp=require("space-camp.js"),Whoopsie=require("whoopsie.js"),Constants=require("constants.js");module.exports=GptOptions;
},{"constants.js":"/wrapper/src/libs/constants.js","space-camp.js":"/wrapper/src/space-camp.js","whoopsie.js":"/wrapper/src/libs/whoopsie.js"}],"/wrapper/src/modules/gpt-layer/gpt-refresh.js":[function(require,module,exports){
"use strict";function GptRefresh(e,t,r){function s(e,t){return l?l(e,t):window.googletag.pubads().refresh(e,t)}function i(e,i){e||(e=GptHelper.getGSlots());for(var l=e.slice(),p=e.length-1;p>=0;p--)GptHelper.isGSlot(e[p])||e.splice(p,1);if(t.requestArchitecture===Constants.RequestArchitectures.MRA)for(var c=e.length-1;c>=0;c--)t.gSlotDisplayHistory.hasOwnProperty(e[c].getSlotElementId())||e.splice(c,1);if(!e.length)return s(l,i),Prms.resolve();for(var g=[],u=0;u<e.length;u++)g.push({slot:e[u]}),t.gSlotDisplayHistory[e[u].getSlotElementId()]=!0;var v=a(g);if(!v.length)return EventsService.emit("warning","No valid Header Tag slots found in call to refresh."),s(l,i),Prms.resolve();var S=TimerService.createTimer(t.globalTimeout,!0);return TimerService.addTimerCallback(S,function(){EventsService.emit("global_timeout_reached",{sessionId:S})}),EventsService.emit("hs_session_start",{sessionId:S}),r(S,v).then(function(e){n(v),o(S,e),EventsService.emit("hs_session_end",{sessionId:S}),s(l,i)})}var a,n,o,l;return function(){EventsService=SpaceCamp.services.EventsService,TimerService=SpaceCamp.services.TimerService,t.hasOwnProperty("gSlotDisplayHistory")||(t.gSlotDisplayHistory={}),t.hasOwnProperty("requestArchitecture")||(t.requestArchitecture=Constants.RequestArchitectures.MRA),t.hasOwnProperty("initialLoadState")||(t.initialLoadState=Constants.InitialLoadStates.ENABLED);var r=function(){e.override&&e.override.refresh&&(l=SpaceCamp.LastLineGoogletag.refresh)};SpaceCamp.initQueue.push(r),a=GptMapSlots(e,t).mapHtSlots,n=GptClearTargeting(e,t).clearTargeting,o=GptSetTargeting(e,t).setTargeting}(),{refresh:i}}var GptHelper=require("gpt-helper.js"),SpaceCamp=require("space-camp.js"),Whoopsie=require("whoopsie.js"),GptMapSlots=require("gpt-map-slots.js"),GptClearTargeting=require("gpt-clear-targeting.js"),GptSetTargeting=require("gpt-set-targeting.js"),Constants=require("constants.js"),Prms=require("prms.js"),TimerService,EventsService;module.exports=GptRefresh;
},{"constants.js":"/wrapper/src/libs/constants.js","gpt-clear-targeting.js":"/wrapper/src/modules/gpt-layer/gpt-clear-targeting.js","gpt-helper.js":"/wrapper/src/libs/gpt-helper.js","gpt-map-slots.js":"/wrapper/src/modules/gpt-layer/gpt-map-slots.js","gpt-set-targeting.js":"/wrapper/src/modules/gpt-layer/gpt-set-targeting.js","prms.js":"/wrapper/src/libs/external/prms.js","space-camp.js":"/wrapper/src/space-camp.js","whoopsie.js":"/wrapper/src/libs/whoopsie.js"}],"/wrapper/src/modules/gpt-layer/gpt-retrieve-and-set-targeting.js":[function(require,module,exports){
"use strict";function GptRetrieveAndSetTargeting(e,r,t){function i(e){var i=s.mapHtSlots(e);if(0===i.length)return EventsService.emit("warning","no valid header tag slots found in call to retrieveDemand"),Prms.resolve();var c=TimerService.createTimer(r.globalTimeout,!0);return TimerService.addTimerCallback(c,function(){EventsService.emit("global_timeout_reached",{sessionId:c})}),EventsService.emit("hs_session_start",{sessionId:c}),t(c,i).then(function(e){n.clearTargeting(i),a.setTargeting(c,e),EventsService.emit("hs_session_end",{sessionId:c})})}var s,n,a;return function(){EventsService=SpaceCamp.services.EventsService,TimerService=SpaceCamp.services.TimerService,s=GptMapSlots(e,r),n=GptClearTargeting(e,r),a=GptSetTargeting(e,r)}(),{retrieveAndSetTargeting:i}}var GptHelper=require("gpt-helper.js"),Prms=require("prms.js"),SpaceCamp=require("space-camp.js"),Whoopsie=require("whoopsie.js"),GptMapSlots=require("gpt-map-slots.js"),GptClearTargeting=require("gpt-clear-targeting.js"),GptSetTargeting=require("gpt-set-targeting.js"),TimerService,EventsService;module.exports=GptRetrieveAndSetTargeting;
},{"gpt-clear-targeting.js":"/wrapper/src/modules/gpt-layer/gpt-clear-targeting.js","gpt-helper.js":"/wrapper/src/libs/gpt-helper.js","gpt-map-slots.js":"/wrapper/src/modules/gpt-layer/gpt-map-slots.js","gpt-set-targeting.js":"/wrapper/src/modules/gpt-layer/gpt-set-targeting.js","prms.js":"/wrapper/src/libs/external/prms.js","space-camp.js":"/wrapper/src/space-camp.js","whoopsie.js":"/wrapper/src/libs/whoopsie.js"}],"/wrapper/src/modules/gpt-layer/gpt-set-targeting.js":[function(require,module,exports){
"use strict";function GptSetTargeting(e,t){function r(e,r){for(var i=0;i<r.length;i++)if(!r[i].pass&&r[i].targeting&&!Utilities.isEmpty(r[i].targeting)){"slot"===r[i].targetingType&&EventsService.emit("hs_slot_kv_pushed",{sessionId:e,statsId:r[i].partnerStatsId,htSlotId:r[i].htSlot.getId(),requestId:r[i].requestId,xSlotNames:[r[i].xSlotName]});var s,a=r[i].targeting;for(var g in a)if(a.hasOwnProperty(g))if("page"===r[i].targetingType)s=t.pageDemandHistory,s[g]=s[g]||{},s[g]=!0,window.googletag.pubads().setTargeting(g,a[g]);else{var n=r[i].ref,o=n.getSlotElementId();s=t.gSlotDemandHistory,s[o]=s[o]||{},s[o][g]=!0,n.setTargeting(g,n.getTargeting(g).concat(a[g]))}}}return function(){EventsService=SpaceCamp.services.EventsService,t.gSlotDemandHistory=t.gSlotDemandHistory||{},t.pageDemandHistory=t.pageDemandHistory||{}}(),{setTargeting:r}}var GptHelper=require("gpt-helper.js"),SpaceCamp=require("space-camp.js"),Utilities=require("utilities.js"),Whoopsie=require("whoopsie.js"),EventsService;module.exports=GptSetTargeting;
},{"gpt-helper.js":"/wrapper/src/libs/gpt-helper.js","space-camp.js":"/wrapper/src/space-camp.js","utilities.js":"/wrapper/src/libs/utilities.js","whoopsie.js":"/wrapper/src/libs/whoopsie.js"}],"/wrapper/src/modules/identity-layer/adserver-org-ip/adserver-org-ip-validator.js":[function(require,module,exports){
"use strict";var Inspector=require("../../../libs/external/schema-inspector.js"),partnerValidator=function(r){var e=Inspector.validate({type:"object",strict:!0,properties:{publisherId:{type:"number"}}},r);return e.valid?null:e.format()};module.exports=partnerValidator;
},{"../../../libs/external/schema-inspector.js":"/wrapper/src/libs/external/schema-inspector.js"}],"/wrapper/src/modules/identity-layer/adserver-org-ip/adserver-org-ip.js":[function(require,module,exports){
"use strict";function AdserverOrgIp(e){function t(e){c={source:d,uids:[]};for(var t in e)e.hasOwnProperty(t)&&c.uids.push({id:e[t],ext:{rtiPartner:t}})}function r(){return i.statsId}function s(){return c}function a(){return new Prms(function(e){var r=Cache.getData(u);if(r){EventsService.emit("hs_identity_cached",{statsId:i.statsId});var s;return"match"===r.response?(s="hs_identity_response",t(r.data)):s="pass"===r.response?"hs_identity_pass":"hs_identity_error",EventsService.emit(s,{statsId:i.statsId}),void e()}EventsService.emit("hs_identity_request",{statsId:i.statsId}),Network.ajax({url:n,data:{ttd_pid:"casale",fmt:"json",p:o},method:"GET",withCredentials:!0,onSuccess:function(r){var s;try{s=JSON.parse(r)}catch(t){return EventsService.emit("hs_identity_error",{statsId:i.statsId}),Cache.setData(u,{response:"error"},i.features.identityDataExpiry.error),void e()}if(!s.hasOwnProperty("TDID"))return EventsService.emit("hs_identity_error",{statsId:i.statsId}),Cache.setData(u,{response:"error"},i.features.identityDataExpiry.error),void e();EventsService.emit("hs_identity_response",{statsId:i.statsId}),t(s),Cache.setData(u,{response:"match",data:s},i.features.identityDataExpiry.match),e()},onFailure:function(t){EventsService.emit("hs_identity_error",{statsId:i.statsId}),Cache.setData(u,{response:"error"},i.features.identityDataExpiry.error),e()}})})}if(!Network.isXhrSupported())return null;var i,n,o,d,c,u;return function(){EventsService=SpaceCamp.services.EventsService,i={partnerId:"AdserverOrgIp",statsId:"ADSORG",version:"1.0.0",features:{identityDataExpiry:{match:6048e5,pass:864e5,error:864e5}}},n=Browser.getProtocol()+"//match.adsrvr.org/track/rid",o=e.publisherId,d="adserver.org",u="AdserverOrgIp",c=null}(),{__profile:i,__baseUrl:n,__identityStore:c,__setIdentityData:t,getStatsId:r,getResults:s,retrieve:a}}var Browser=require("browser.js"),Cache=require("cache.js"),Network=require("network.js"),Prms=require("prms.js"),SpaceCamp=require("space-camp.js"),Whoopsie=require("whoopsie.js"),EventsService;module.exports=AdserverOrgIp;
},{"browser.js":"/wrapper/src/libs/browser.js","cache.js":"/wrapper/src/libs/cache.js","network.js":"/wrapper/src/libs/network.js","prms.js":"/wrapper/src/libs/external/prms.js","space-camp.js":"/wrapper/src/space-camp.js","whoopsie.js":"/wrapper/src/libs/whoopsie.js"}],"/wrapper/src/modules/partners-layer/dynamic-partner-loader/dynamic-partner-loader.js":[function(require,module,exports){
"use strict";function DynamicPartnerLoader(e){function r(e){return-1!==e.indexOf("validator.js")?System.noOp:c[e]}function s(){var e=window.adapter.configs,s={exports:{}};window.adapter.bidder(r,s,s.exports),n=s.exports(e)}function t(e,r){return n.retrieve(e,r)}var i,a,n,c={"browser.js":require("browser.js"),"cache.js":require("cache.js"),"classify.js":require("classify.js"),"command-queue.js":require("command-queue.js"),"config-validators.js":require("config-validators.js"),"constants.js":require("constants.js"),"device-type-checker.js":require("device-type-checker.js"),"network.js":require("network.js"),"openrtb.js":require("openrtb.js"),"openrtb2_5.js":require("openrtb2_5.js"),"partner.js":require("partner.js"),"scribe.js":require("scribe.js"),"size.js":require("size.js"),"space-camp.js":require("space-camp.js"),"system.js":require("system.js"),"utilities.js":require("utilities.js"),"whoopsie.js":require("whoopsie.js")};!function(){i={partnerId:"DynamicPartnerLoader",namespace:"DynamicPartnerLoader",statsId:"DYNLDR",version:"1.0.0",targetingType:"slot",enabledAnalytics:{requestTime:!0},features:{demandExpiry:{enabled:!1,value:0},rateLimiting:{enabled:!1,value:0}},targetingKeys:{id:"ix_dyn_id",om:"ix_dyn_cpm",pm:"ix_dyn_cpm",pmid:"ix_dyn_dealid"},bidUnitInCents:1,lineItemType:Constants.LineItemTypes.ID_AND_SIZE,callbackType:Partner.CallbackTypes.ID,architecture:Partner.Architectures.SRA,requestType:Partner.RequestTypes.ANY},s();var r=n.getPartnerId();i.namespace=r,a=Partner(i,e,null,{retriever:t});var c=n.getDirectInterface();if(c.hasOwnProperty(r))for(var o in c[r])c[r].hasOwnProperty(o)&&a._addToDirectInterface(o,c[r][o])}();var o={__baseClass:a,profile:i};return Classify.derive(a,o)}var Classify=require("classify.js"),Constants=require("constants.js"),Partner=require("partner.js"),System=require("system");module.exports=DynamicPartnerLoader;
},{"browser.js":"/wrapper/src/libs/browser.js","cache.js":"/wrapper/src/libs/cache.js","classify.js":"/wrapper/src/libs/classify.js","command-queue.js":"/wrapper/src/libs/command-queue.js","config-validators.js":"/wrapper/src/libs/config-validators.js","constants.js":"/wrapper/src/libs/constants.js","device-type-checker.js":"/wrapper/src/libs/device-type-checker.js","network.js":"/wrapper/src/libs/network.js","openrtb.js":"/wrapper/src/libs/openrtb.js","openrtb2_5.js":"/wrapper/src/libs/openrtb2_5.js","partner.js":"/wrapper/src/modules/partners-layer/partner.js","scribe.js":"/wrapper/src/libs/scribe.js","size.js":"/wrapper/src/libs/size.js","space-camp.js":"/wrapper/src/space-camp.js","system":"/wrapper/src/libs/system.js","system.js":"/wrapper/src/libs/system.js","utilities.js":"/wrapper/src/libs/utilities.js","whoopsie.js":"/wrapper/src/libs/whoopsie.js"}],"/wrapper/src/modules/partners-layer/partner.js":[function(require,module,exports){
"use strict";function Partner(e,t,r,n){function a(e){return function(t){C[e]=t,delete k[e]}}function i(e,t,r){for(var n in r)if(r.hasOwnProperty(n))for(var a in r[n])r[n].hasOwnProperty(a)&&r[n][a].length&&EventsService.emit(t,{sessionId:e,statsId:y.statsId,htSlotId:n,requestId:a,xSlotNames:r[n][a]})}function s(e,r){var n={};return"price"===e&&(n={outputCentsDivisor:1,outputPrecision:0,roundingType:"NONE"}),Utilities.mergeObjects(O[e],{bidUnitInCents:y.bidUnitInCents},r||{},t.bidTransformer||{},n)}function o(e){var t=[];y.architecture===Partner.Architectures.FSRA&&t.push([]);for(var r={},n=0;n<e.length;n++){var a=e[n].htSlot.getName();if(_.mapping.hasOwnProperty(a))for(var i="_"+System.generateUniqueId(),s=0;s<_.mapping[a].length;s++){var o={},u=_.mapping[a][s];o.partnerId=y.partnerId,o.partnerStatsId=y.statsId,o.htSlot=e[n].htSlot,o.ref=e[n].ref,o.xSlotRef=_.xSlots[u],o.xSlotName=u,o.requestId=i,e[n].firstPartyData&&(o.firstPartyData=e[n].firstPartyData),e[n].identityData&&(o.identityData=e[n].identityData),y.architecture===Partner.Architectures.MRA?t.push([o]):y.architecture===Partner.Architectures.FSRA?t[0].push(o):(r.hasOwnProperty(u)||(r[u]=0),t.length<r[u]+1&&t.push([]),t[r[u]].push(o),r[u]++)}}return t}function u(e,t){if(0===t.length)return Prms.resolve([]);var r=b(t,e);y.callbackType===Partner.CallbackTypes.CALLBACK_NAME&&(k[r.callbackId]=a(r.callbackId));var n={};if(y.enabledAnalytics.requestTime){for(var s=0;s<t.length;s++){var o=t[s],u=o.htSlot.getId(),p=o.requestId;n.hasOwnProperty(u)||(n[u]={}),n[u].hasOwnProperty(p)||(n[u][p]=[]),n[u][p].push(o.xSlotName)}i(e,"hs_slot_request",n)}return new Prms(function(a){EventsService.emit("partner_request_sent",{partner:y.partnerId});var s,o,u={url:r.url,data:r.data,method:"GET",timeout:_.timeout,withCredentials:!0,jsonp:!0,sessionId:e,globalTimeout:!0,continueAfterTimeout:!0,onSuccess:function(o,u,p){var c,l="success";try{y.callbackType===Partner.CallbackTypes.NONE?c=JSON.parse(o):(o&&eval.call(null,o),c=C[r.callbackId],delete C[r.callbackId]),p&&!y.parseAfterTimeout||T(e,c,t,n,s,u,p)}catch(t){EventsService.emit("internal_error",y.partnerId+" error parsing demand: "+t,t.stack),l="error",y.enabledAnalytics.requestTime&&!p&&i(e,"hs_slot_error",n)}EventsService.emit("partner_request_complete",{partner:y.partnerId,status:l}),a(t)},onTimeout:function(){EventsService.emit("partner_request_complete",{partner:y.partnerId,status:"timeout"}),y.enabledAnalytics.requestTime&&i(e,"hs_slot_timeout",n),a(t)},onFailure:function(){EventsService.emit("partner_request_complete",{partner:y.partnerId,status:"error"}),y.enabledAnalytics.requestTime&&i(e,"hs_slot_error",n),a(t)}};o=r.networkParamOverrides?Utilities.mergeObjects(u,r.networkParamOverrides):u,y.callbackType!==Partner.CallbackTypes.NONE&&y.requestType!==Partner.RequestTypes.AJAX||(o.jsonp=!1),s=y.requestType===Partner.RequestTypes.JSONP?Network.jsonp(o):Network.ajax(o)})}function p(e){q.push(e)}function c(){return h}function l(e){__directInterface={},__directInterface[y.namespace]=e}function m(e,t){__directInterface[y.namespace][e]=t}function d(){return y.partnerId}function v(){return __directInterface}function g(){return y.features.prefetchDisabled&&y.features.prefetchDisabled.enabled}function f(e,t){if(t=t.slice(),_.rateLimiting.enabled){var r=System.now();if("page"===y.targetingType){if(r<=P)return[];P=r+_.rateLimiting.value}else for(var n=t.length-1;n>=0;n--){var a=t[n].htSlot.getName();I.hasOwnProperty(a)&&r<=I[a]?t.splice(n,1):I[a]=r+_.rateLimiting.value}}if(!t.length)return[];if(S)return S(e,t);for(var i=o(t),s=[],p=0;p<i.length;p++)s.push(u(e,i[p]));return s}var y,h,P,I,__directInterface,S,b,T,O,_,q,C,A,w,k;return function(){if(EventsService=SpaceCamp.services.EventsService,RenderService=SpaceCamp.services.RenderService,O={targeting:{bidUnitInCents:1,outputCentsDivisor:1,outputPrecision:0,roundingType:"FLOOR",floor:0,buckets:[{max:2e3,step:5},{max:5e3,step:100}]},price:{bidUnitInCents:1}},y=e,P=0,I={},q=[],k={},C={},_={timeout:0,lineItemType:e.lineItemType,targetingKeys:e.targetingKeys,rateLimiting:e.features.rateLimiting},t.hasOwnProperty("timeout")&&t.timeout>0&&(_.timeout=t.timeout,EventsService.emit("hs_define_partner_timeout",{timeout:_.timeout,statsId:y.statsId})),t.hasOwnProperty("targetingKeyOverride"))for(var a in t.targetingKeyOverride)t.targetingKeyOverride.hasOwnProperty(a)&&_.targetingKeys.hasOwnProperty(a)&&(_.targetingKeys[a]=t.targetingKeyOverride[a]);if(t.hasOwnProperty("rateLimiting")&&(t.rateLimiting.hasOwnProperty("enabled")&&(_.rateLimiting.enabled=t.rateLimiting.enabled),t.rateLimiting.value&&(_.rateLimiting.value=t.rateLimiting.value)),t.hasOwnProperty("lineItemType")&&(_.lineItemType=Constants.LineItemTypes[t.lineItemType]),_.xSlots=t.xSlots,_.mapping=t.mapping,h=!1,r){Utilities.isArray(r)||(r=[r]);var i=[];r.map(function(e){var t=Prms.defer();i.push(t.promise),Network.jsonp({url:e,onSuccess:function(){t.resolve()}})}),Prms.all(i).then(function(){h=!0,EventsService.emit("partner_instantiated",{partner:y.partnerId}),q=CommandQueue(q)})}else EventsService.emit("partner_instantiated",{partner:y.partnerId}),h=!0;RenderService.registerPartner(y.partnerId,_.lineItemType,_.targetingKeys.id),A={},e.hasOwnProperty("bidUnitInCents")&&(A.targeting=BidTransformer(s("targeting")),A.price=BidTransformer(s("price"))),n.retriever?S=n.retriever:(T=n.parseResponse,b=n.generateRequestObj,w=n.adResponseCallback),__directInterface={},__directInterface.hasOwnProperty(y.namespace)||(__directInterface[y.namespace]={}),y.callbackType===Partner.CallbackTypes.ID?__directInterface[y.namespace].adResponseCallback=w:__directInterface[y.namespace].adResponseCallbacks=k}(),{_configs:_,_adResponseStore:C,_bidTransformers:A,_setDirectInterface:l,_addToDirectInterface:m,_generateReturnParcels:o,_emitStatsEvent:i,_pushToCommandQueue:p,_generateBidTransformerConfig:s,getPartnerId:d,getDirectInterface:v,getPrefetchDisabled:g,isReady:c,retrieve:f}}var BidTransformer=require("bid-transformer.js"),CommandQueue=require("command-queue.js"),Constants=require("constants.js"),Network=require("network.js"),Prms=require("prms.js"),SpaceCamp=require("space-camp.js"),System=require("system.js"),Utilities=require("utilities.js"),Whoopsie=require("whoopsie.js"),EventsService,RenderService;Partner.Architectures={MRA:0,SRA:1,FSRA:2},Partner.CallbackTypes={ID:0,CALLBACK_NAME:1,NONE:2},Partner.RequestTypes={ANY:0,AJAX:1,JSONP:2},module.exports=Partner;
},{"bid-transformer.js":"/wrapper/src/libs/bid-transformer.js","command-queue.js":"/wrapper/src/libs/command-queue.js","constants.js":"/wrapper/src/libs/constants.js","network.js":"/wrapper/src/libs/network.js","prms.js":"/wrapper/src/libs/external/prms.js","space-camp.js":"/wrapper/src/space-camp.js","system.js":"/wrapper/src/libs/system.js","utilities.js":"/wrapper/src/libs/utilities.js","whoopsie.js":"/wrapper/src/libs/whoopsie.js"}],"/wrapper/src/modules/partners-layer/prefetch.js":[function(require,module,exports){
"use strict";function Prefetch(e,t){function r(e){h||(h=HtSlotMapper({selectors:["divId"],filters:["deviceType"]}));for(var t=[],r=0;r<e.length;r++)SpaceCamp.htSlotsMap.hasOwnProperty(e[r])&&t.push(SpaceCamp.htSlotsMap[e[r]]);return h.filter(t,[{}]).map(function(e){return e.getName()})}function i(){if(!g||!d)return null;var e=Utilities.evalVariable(u);if(void 0===e||null===e)return null;if(!Utilities.isArray(e,"object")||Utilities.isEmpty(e))return EventsService.emit("error","`"+u+"` must be a non-empty array"),[];for(var t=[],r=", ignoring this p-slot",i=0;i<e.length;i++){var s=e[i];if(Utilities.isEmpty(s))EventsService.emit("error","`"+u+"["+i+"]` must be a non-empty object"+r);else if(s.hasOwnProperty("adUnitPath")&&Utilities.isString(s.adUnitPath)&&!Utilities.isEmpty(s.adUnitPath))if(!s.hasOwnProperty("divId")||Utilities.isString(s.divId)&&!Utilities.isEmpty(s.divId))if(!s.hasOwnProperty("sizes")||Size.isSizes(s.sizes)){if(s.hasOwnProperty("targeting")){if(!Utilities.isArray(s.targeting,"object")){EventsService.emit("error","`"+u+"["+i+"].targeting` must be an array of objects"+r);continue}for(var n=!1,a=0;a<s.targeting.length;a++){var o=s.targeting[a];for(var p in o)o.hasOwnProperty(p)&&(Utilities.isArray(o[p],"string")||(n=!0,EventsService.emit("error","`"+u+"["+i+"].targeting["+a+"]."+p+"` must be an array of strings")))}if(n)continue}!s.hasOwnProperty("deviceType")||DeviceTypeChecker.isValidDeviceType(s.deviceType)?t.push(s):EventsService.emit("error","`"+u+"["+i+"].deviceType` must be a valid device type string"+r)}else EventsService.emit("error","`"+u+"["+i+"].sizes` must be a sizes array"+r);else EventsService.emit("error","`"+u+"["+i+"].divId` must be a non-empty string"+r);else EventsService.emit("error","`"+u+"["+i+"].adUnitPath` is required and must be a non-empty string"+r)}if(!t.length)return[];h||(h=HtSlotMapper(g));var l=h.filter(SpaceCamp.htSlots,t);if("ALL"===d)return h.select(l,t).map(function(e){return e.htSlot.getName()});for(var c=[],v=0;v<t.length;v++)c=Utilities.appendToArray(c,h.select(l,[t[v]]).map(function(e){return e.htSlot.getName()}));return c}function s(){if(!y)return null;var e=Utilities.evalVariable(S);return void 0===e||null===e?null:!Utilities.isString(e)||Utilities.isEmpty(e)?(EventsService.emit("error","`"+S+"` must be a non-empty string"),[]):y.hasOwnProperty(e)?r(y[e]):(EventsService.emit("error",'Unrecognized page type "'+e+'"'),[])}function n(){return _?r(_):null}function a(){for(var e=[i,s,n],t=0;t<e.length;t++){var r=e[t]();if(r)return r}return[]}function o(e,t,r,i){t.drd.promise.then(function(t){for(var s=0;s<t.length;s++)EventsService.emit("hs_slot_prefetch",{sessionId:e,statsId:t[s].partnerStatsId,htSlotId:t[s].htSlot.getId(),requestId:t[s].requestId,xSlotNames:[t[s].xSlotName]}),t[s].ref=r.ref;i.resolve(t)})}function p(e,t,r,i){for(var s=[],n=0;n<i.length;){var a=i[n].htSlot.getName();if(!i[n].prefetch&&f.hasOwnProperty(a)&&f[a].hasOwnProperty(t))for(var p=f[a][t];p.length;){var l=p.shift();if(!(l.timeOfExpiry<System.now())){TimerService.startTimer(l.sessionId);var c=Prms.defer();o(e,l,i[n],c),s.push(c),i.splice(n,1),n--;break}}n++}return s}function l(e,t,r,i,s){var n={};i.map(function(t){n[t.ref]={sessionId:e,timeOfExpiry:1/0,drd:Prms.defer()}}),i.map(function(e){if(!r.getPrefetchDisabled()){var i=n[e.ref],a=i.drd;Prms.all(s).then(function(t){i.timeOfExpiry=System.now()+P;for(var r=[],s=0;s<t.length;s++)for(var n=t[s],o=0;o<n.length;o++){var p=n[o];p.ref===e.ref&&r.push(p)}a.resolve(r)}).catch(function(e){a.resolve([])});var o=e.htSlot.getName();f.hasOwnProperty(o)||(f[o]={}),f[o].hasOwnProperty(t)||(f[o][t]=[]),f[o][t].push(i)}})}function c(e,r){if(e.length){for(var i=[],s=0;s<e.length;s++){var n=e[s];if(SpaceCamp.htSlotsMap.hasOwnProperty(n)){var a={htSlot:SpaceCamp.htSlotsMap[n],prefetch:!0,ref:System.generateUuid()};r&&(a.identityData=r),i.push(a)}else EventsService.emit("error","Unrecognized htSlotName "+n)}if(i.length){var o=TimerService.createTimer(SpaceCamp.globalTimeout,!1);EventsService.emit("hs_session_start",{sessionId:o});var p=t.__invokeAllPartners(o,i,!0);TimerService.addTimerCallback(o,function(){for(var e=0;e<p.defers.length;e++)p.defers[e].resolve([])}),Prms.all(p.promises).then(function(){EventsService.emit("hs_session_end",{sessionId:o})})}}}function v(e){if(m){var t=a();t.length&&c(t,e)}}var f,m,h,u,d,g,S,y,_,P=55e3;return function(){if(EventsService=SpaceCamp.services.EventsService,TimerService=SpaceCamp.services.TimerService,f={},m=!1,u="window.headertag.publisher.prefetchSlots",S="window.headertag.pagetype",e.prefetchOnLoad&&(e.prefetchOnLoad.enabled&&(m=!0),e.prefetchOnLoad.configs)){var t=e.prefetchOnLoad.configs.dynamic;t&&(t.var&&(u=t.var),t.slotMapping&&(t.slotMapping.style&&(d=t.slotMapping.style),t.slotMapping.selectors&&t.slotMapping.filters&&(g={selectors:t.slotMapping.selectors,filters:t.slotMapping.filters})));var r=e.prefetchOnLoad.configs.pageType;r&&(r.var&&(S=r.var),r.mapping&&(y=r.mapping));var i=e.prefetchOnLoad.configs.fixed;i&&i.htSlotNames&&(_=i.htSlotNames)}}(),{__storage:f,__prefetchOnLoad:m,__dynamicVar:u,__dynamicSlotMappingConfigs:g,__htSlotMapper:h,__pageTypeVar:S,__pageTypeMapping:y,__fixedList:_,__getHtSlotsByDynamic:i,__getHtSlotsByPageType:s,__getHtSlotsByFixed:n,__copyOverRef:o,prefetch:c,prefetchOnLoad:v,fulfilDemand:p,storeDemand:l}}var DeviceTypeChecker=require("device-type-checker.js"),HtSlotMapper=require("ht-slot-mapper.js"),Prms=require("prms.js"),Size=require("size.js"),SpaceCamp=require("space-camp.js"),System=require("system.js"),Utilities=require("utilities.js"),EventsService,TimerService;module.exports=Prefetch;
},{"device-type-checker.js":"/wrapper/src/libs/device-type-checker.js","ht-slot-mapper.js":"/wrapper/src/libs/ht-slot-mapper.js","prms.js":"/wrapper/src/libs/external/prms.js","size.js":"/wrapper/src/libs/size.js","space-camp.js":"/wrapper/src/space-camp.js","system.js":"/wrapper/src/libs/system.js","utilities.js":"/wrapper/src/libs/utilities.js"}],"/wrapper/src/services/compliance-service.js":[function(require,module,exports){
"use strict";function ComplianceService(e){function t(e){e.hasOwnProperty("gdprApplies")&&"boolean"===Utilities.getType(e.gdprApplies)?m=e.gdprApplies:e.hasOwnProperty("isUserInEu")&&"boolean"===Utilities.getType(e.isUserInEu)&&(m=e.isUserInEu),e.hasOwnProperty("consentData")&&"string"===Utilities.getType(e.consentData)&&(_=e.consentData)}function r(e){if(!w){var r=Utilities.getType(e);"undefined"!==r&&(w=!0,"string"===r?_=e:"object"===r&&t(e),g.resolve())}}function i(e,t){return function(){if(e)try{window.__cmp("getConsentData",null,r)}catch(e){}if(t)try{y(r)}catch(e){}}}function n(e){try{var t;if(t="string"===Utilities.getType(e.data)?JSON.parse(e.data):e.data,!t.hasOwnProperty("__cmpReturn")||"object"!==Utilities.getType(t.__cmpReturn))return;var i=t.__cmpReturn;i.callId===C&&(r(i.returnValue,i.success),window.removeEventListener("message",n,!1))}catch(e){}}function s(e){m=e}function a(){return{applies:m,consentString:_}}function c(){return!0}function o(e){return function(){v!==T.COMPLETE&&S&&TimerService.startTimer(S);var t=arguments;f.push(function(){e.apply(null,t)})}}function u(){if(v===T.NOT_STARTED){g=Prms.defer(),v=T.IN_PROGRESS,g.promise.then(function(){f=CommandQueue(f),v=T.COMPLETE});var e=!1,t=!1,r=!1;if(window.__cmp&&"function"===Utilities.getType(window.__cmp)&&(t=!0),y&&(r=!0),t||r){e=!0;var s=i(t,r);if(s(),d>0){var a=window.setInterval(s,l);g.promise.then(function(){window.clearInterval(a)})}}else{var c=Browser.traverseContextTree(function(e){return e.__cmpLocator?e:null});if(c){e=!0,C=System.generateUniqueId();var o={__cmpCall:{command:"getConsentData",parameter:null,callId:C}};window.addEventListener("message",n,!1),c.postMessage(JSON.stringify(o),"*"),c.postMessage(o,"*")}}if(!e)return void g.resolve();0===d?g.resolve():S||(S=TimerService.createTimer(d,!1,function(){g.resolve()}))}}function p(){return v===T.NOT_STARTED&&u(),v!==T.COMPLETE&&S&&TimerService.startTimer(S),g.promise}var l=250,m,_,f,v,T={NOT_STARTED:0,IN_PROGRESS:1,COMPLETE:2},d,g,S,y,w,C=0;return function t(){if(TimerService=SpaceCamp.services.TimerService,m=e.gdprAppliesDefault,_="",f=[],d=e.timeout,v=T.NOT_STARTED,w=!1,e.customFn)try{y=eval(e.customFn),"function"!==Utilities.getType(y)&&(y=null)}catch(e){y=null}else y=null;u()}(),{gdpr:{getConsent:a,setApplies:s},isPrivacyEnabled:c,delay:o,wait:p,__gdprApplies:m,__gdprConsentString:_,__retrieve:u,__interpretCmpResultObject:t,__cmpCallback:r,__makeCmpCaller:i,__messageListener:n}}var Browser=require("browser.js"),CommandQueue=require("command-queue.js"),Prms=require("prms.js"),SpaceCamp=require("space-camp.js"),System=require("system.js"),Utilities=require("utilities.js"),TimerService;module.exports=ComplianceService;
},{"browser.js":"/wrapper/src/libs/browser.js","command-queue.js":"/wrapper/src/libs/command-queue.js","prms.js":"/wrapper/src/libs/external/prms.js","space-camp.js":"/wrapper/src/space-camp.js","system.js":"/wrapper/src/libs/system.js","utilities.js":"/wrapper/src/libs/utilities.js"}],"/wrapper/src/services/events-service.js":[function(require,module,exports){
"use strict";function EventsService(){function e(e,r,n){i.hasOwnProperty(e)||(i[e]=[]);var t=System.generateUniqueId();return i[e].push({id:t,fn:n,once:r}),t}function r(r,n){return e(r,!1,n)}function n(r,n){return e(r,!0,n)}function t(e){for(var r in i)if(i.hasOwnProperty(r))for(var n=i[r].length-1;n>=0;n--)if(i[r][n].id===e)return void i[r].splice(n,1)}function o(){var e=Array.prototype.slice.call(arguments),r=e.shift();if(r&&i.hasOwnProperty(r))for(var n=i[r].length-1;n>=0;n--){try{i[r][n].fn.apply(null,e)}catch(e){}i[r][n].once&&i[r].splice(n,1)}}var i;return function(){i={}}(),{__eventsMap:i,__on:e,on:r,once:n,off:t,emit:o}}var System=require("system.js"),Whoopsie=require("whoopsie.js");module.exports=EventsService;
},{"system.js":"/wrapper/src/libs/system.js","whoopsie.js":"/wrapper/src/libs/whoopsie.js"}],"/wrapper/src/services/header-stats-service.js":[function(require,module,exports){
"use strict";function HeaderStats(e){function t(){if(Utilities.isEmpty(w))return[];var e={s:"identity",t:O,e:[]};for(var t in w)if(w.hasOwnProperty(t)){for(var s=0;s<w[t].length;s++){var i=w[t][s];"bid_requests"!==i.n&&"res_latency"!==i.n||(i.v=String(i.v)),e.e.push(i)}E.hasOwnProperty(t)&&!1!==E[t]||(e.e.push({n:"partner_timeout",b:t,v:b,x:"before"}),E[t]=!0)}return w={},[e]}function s(e,t){Utilities.isEmpty(w)&&(O=System.now());var s=t.statsId;w[s]=w[s]||[];var i={b:s,x:g?"after":"before"};"hs_identity_request"===e?(i.n="bid_requests",i.v=1,P[s]=System.now()):"hs_identity_cached"===e?(i.n="bid_requests",i.v=0):"hs_identity_response"===e?(i.n="bid_responses",i.v=1):"hs_identity_error"===e?(i.n="bid_errors",i.v=1):"hs_identity_pass"===e?(i.n="bid_passes",i.v=1):"hs_identity_timeout"===e?(i.n="bid_timeouts",i.v=1):"hs_identity_bid_latency"===e&&(i.n="res_latency",i.v=System.now()-P[s]),w[s].push(i)}function i(e,t){var s=[];for(var i in t)if(t.hasOwnProperty(i)){var n=t[i],r={s:n.s,t:n.t,e:[]};for(var o in n.events)if(n.events.hasOwnProperty(o)){var _={},a={};for(var v in n.events[o])if(n.events[o].hasOwnProperty(v))for(var u in n.events[o][v])if(n.events[o][v].hasOwnProperty(u)){_[u]={n:"auction_cycle",b:o,x:u,v:y[e]},m[o]&&!a.hasOwnProperty(u)&&(a[u]={n:"partner_timeout",b:o,x:u,v:m[o]});var h=n.events[o][v][u];"res_latency"===h.n&&(h.v=String(h.v)),r.e.push(h)}if(d.auctionCycle)for(var c in _)_.hasOwnProperty(c)&&r.e.push(_[c]);for(var p in a)a.hasOwnProperty(p)&&r.e.push(a[p])}s.push(r)}return s}function n(e){if(l.hasOwnProperty(e)&&l[e]!==q.IPR&&l[e]!==q.SENT){p[e].push({n:"global_timeout",v:String(SpaceCamp.globalTimeout)});var s={p:"display",d:SpaceCamp.DeviceTypeChecker.getDeviceType(),c:a,s:e,w:v,t:System.now(),pg:{t:u,e:p[e]}};s.sl=Utilities.mergeArrays(i(e,f[e]),t()),delete p[e],delete f[e];var n=Network.buildUrl(o,null,{s:_,u:Browser.getPageUrl(),v:2});Network.ajax({method:"POST",url:n,data:s}),l[e]=q.SENT}}function r(e,t){var s=t.sessionId,i=t.htSlotId,n=t.statsId,r=t.xSlotNames,o=t.requestId||"";if(l.hasOwnProperty(s)&&l[s]!==q.DONE&&l[s]!==q.SENT){f[s].hasOwnProperty(i)||(f[s][i]={s:i,t:System.now(),events:{}}),f[s][i].events.hasOwnProperty(n)||(f[s][i].events[n]={}),f[s][i].events[n].hasOwnProperty(e)||(f[s][i].events[n][e]={});for(var _=f[s][i].events[n][e],a=0;a<r.length;a++){var d=r[a],v=s+n+i+d+o;if(!S[v]){"bid_timeouts"===e&&(S[v]=!0),_.hasOwnProperty(d)||(_[d]={n:e,v:0,b:n,x:d});var u=_[d];if("res_latency"===e){var c=System.now()-h[v];delete h[v],(!u.v||u.v>c)&&(u.v=c)}else"prefetch"===e?u.v=1:u.v++;"bid_requests"===e?h[v]=System.now():"bid_responses"===e&&EventsService.emit("hs_slot_valid_bid_latency",t)}}}}if(!Network.isXhrSupported())return null;var o,_,a,d,v,u,h,c,y,p,f,l,m,S,w,b,P,O,g,E,q={IPR:0,DONE:1,SENT:2},I={hs_session_start:function(e){var t=e.sessionId;l.hasOwnProperty(t)||(l[t]=q.IPR,c[t]=System.now(),p[t]=[],f[t]={})},hs_session_end:function(e){var t=e.sessionId;l.hasOwnProperty(t)&&l[t]!==q.DONE&&(y[t]=String(System.now()-c[t]),delete c[t],setTimeout(function(){l[t]=q.DONE,n(t)},0))},hs_slot_request:function(e){r("bid_requests",e)},hs_slot_bid:function(e){r("bid_responses",e)},hs_slot_pass:function(e){r("bid_passes",e)},hs_slot_timeout:function(e){r("bid_timeouts",e)},hs_slot_error:function(e){r("bid_errors",e)},hs_slot_highest_bid:function(e){r("top_bid",e)},hs_slot_valid_bid_latency:function(e){r("res_latency",e)},hs_slot_kv_pushed:function(e){r("dfp_kv_pushed",e)},hs_slot_prefetch:function(e){r("prefetch",e)},hs_define_partner_timeout:function(e){m[e.statsId]=String(e.timeout)},hs_identity_request:function(e){s("hs_identity_request",e)},hs_identity_cached:function(e){s("hs_identity_cached",e)},hs_identity_response:function(e){s("hs_identity_response",e),EventsService.emit("hs_identity_bid_latency",e)},hs_identity_error:function(e){s("hs_identity_error",e),EventsService.emit("hs_identity_bid_latency",e)},hs_identity_pass:function(e){s("hs_identity_pass",e),EventsService.emit("hs_identity_bid_latency",e)},hs_identity_bid_latency:function(e){Utilities.isNumber(P[e.statsId])&&s("hs_identity_bid_latency",e)},hs_identity_timeout:function(e){s("hs_identity_timeout",e),g=!0},hs_define_identity_timeout:function(e){b=String(e.timeout)}};return function(){EventsService=SpaceCamp.services.EventsService,u=System.now(),o=Browser.getProtocol("http://as","https://as-sec")+".casalemedia.com/headerstats",_=e.siteId,a=e.configId,d=e.options,v=_+System.now(),v+=System.generateUniqueId(32-v.length),SpaceCamp.instanceId=v,l={},p={},f={},h={},c={},y={},m={},S={},w={},P={},g=!1,E={};for(var t in I)I.hasOwnProperty(t)&&SpaceCamp.services.EventsService.on(t,I[t])}(),{__pageEvents:p,__slotStats:f,__requestStartTimes:h,__sessionStates:l,__identityEvents:w,__recordIdentityEvent:s,__transformIdentityStats:t}}var Browser=require("browser.js"),Network=require("network.js"),SpaceCamp=require("space-camp.js"),System=require("system.js"),Utilities=require("utilities.js"),Whoopsie=require("whoopsie.js"),EventsService;module.exports=HeaderStats;
},{"browser.js":"/wrapper/src/libs/browser.js","network.js":"/wrapper/src/libs/network.js","space-camp.js":"/wrapper/src/space-camp.js","system.js":"/wrapper/src/libs/system.js","utilities.js":"/wrapper/src/libs/utilities.js","whoopsie.js":"/wrapper/src/libs/whoopsie.js"}],"/wrapper/src/services/render-service.js":[function(require,module,exports){
"use strict";function RenderService(e){function r(e,r,i,t){if(e.hasOwnProperty(r)&&e[r].hasOwnProperty(i)){for(var n=null,a=0;a<t.length;a++){var s=t[a];e[r][i].hasOwnProperty(s)&&(n=e[r][i][s])}return n}}function i(e){return!!p.hasOwnProperty(e)&&(l[e]=!0,delete p[e],!0)}function t(){var e=System.now();for(var r in p)p.hasOwnProperty(r)&&p[r].timeOfExpiry&&e>p[r].timeOfExpiry&&i(r)}function n(e){var r;do{r=System.generateUniqueId(Constants.PUBKIT_AD_ID_LENGTH,"ALPHANUM")}while(p.hasOwnProperty[r]);return p[r]=e,r}function a(e){if(p.hasOwnProperty(e)&&p[e].timeOfExpiry&&System.now()>p[e].timeOfExpiry&&i(e),l[e])return EventsService.emit("internal_info","Attempted to render expired ad "+e),null;if(!p.hasOwnProperty(e))throw Whoopsie("INVALID_VALUE","`pubKitAdId` does not match any registered ad");var r=p[e];return i(e),r}function s(e){if(e.auxFn)try{e.auxFn.apply(null,e.auxArgs)}catch(e){EventsService.emit("internal_error","Error occurred running ad aux function.",e.stack)}}function o(e,r){var i=a(r);if(!i)return!1;s(i);try{System.documentWrite(e,i.adm)}catch(e){return EventsService.emit("internal_error",'Error occurred while rendering ad "'+r+'".',e.stack),!1}return!0}function d(e){var r=n(e);if(e.price||e.dealId){var i=e.partnerId,t=e.requestId;if(h.hasOwnProperty(i)){var a;a=Utilities.isString(e.size)?e.size:Size.arrayToString(e.size),Size.isSpecialSize(a)&&(_[t]=a),y[i]||(y[i]={}),y[i][a]||(y[i][a]={}),y[i][a][t]||(y[i][a][t]=[]),y[i][a][t].push(r);var s=e.price;s&&(g[i]||(g[i]={}),g[i][s]||(g[i][s]={}),g[i][s][t]||(g[i][s][t]=[]),g[i][s][t].push(r));var o=e.dealId;return o&&(S[i]||(S[i]={}),S[i][o]||(S[i][o]={}),S[i][o][t]||(S[i][o][t]=[]),S[i][o][t].push(r)),r}}}function v(e,r,i,t,n){try{if(!y.hasOwnProperty(e))return void EventsService.emit("internal_error","Partner "+e+" missing from ad ID map.");if(!Utilities.isObject(i))return void EventsService.emit("internal_error","invalid targeting map");if(!i.hasOwnProperty(h[e].idKey))return void EventsService.emit("internal_error","targeting map missing key "+h[e].idKey);var a=i[h[e].idKey];if(!Utilities.isArray(a))return void EventsService.emit("internal_error","invalid targeting map");if(!Utilities.isNumeric(t))return void EventsService.emit("internal_error","invalid width");if(!Utilities.isNumeric(n))return void EventsService.emit("internal_error","invalid height");var s=t+"x"+n;if(m&&m.hasOwnProperty(s)){var d=m[s];s=d[0]+"x"+d[1]}for(var v=0;v<a.length;v++){var c=a[v],u=_[c]||s;if(!y[e].hasOwnProperty(u))return void EventsService.emit("internal_error","Size key "+u+" missing from ad ID map for partner "+e);if(y[e][u].hasOwnProperty(c)){var p=y[e][u][c];if(p.length){o(r,Utilities.randomSplice(p));break}}}}catch(r){EventsService.emit("internal_error",'Error occurred while rendering ad for "'+e+'".',r.stack)}}function c(e,i){if(void 0!==e.partner&&void 0!==e.id&&void 0!==e.targeting&&(void 0!==e.size||void 0!==e.price)){var t=e.partner,n=e.price,o=e.id,d=e.targeting,v=e.size;if(h[t]){if(!d.hasOwnProperty(h[t].idKey))return void EventsService.emit("internal_error","targeting map missing key "+h[t].idKey);var c=d[h[t].idKey],u=null;if(void 0!==n)for(var p=[S,g],l=0;l<p.length&&!(u=r(p[l],t,n,c));l++);else{if(!Size.isSize(v))return;var f=Size.arrayToString(v);if(m&&m.hasOwnProperty(f)){var _=m[f];f=Size.arrayToString(_)}u=r(y,t,f,c)}if(u){var E=Utilities.randomSplice(u),w=a(E);if(!w)return void EventsService.emit("internal_error","No ad found for ad ID "+E);s(w);for(var O,P=w.size,x=w.adm,I=document.getElementsByTagName("iframe"),z=0;z<I.length;z++)if(I[z].contentWindow===i){O=I[z];break}O&&(O.width=String(P[0]),O.height=String(P[1]),O.parentElement.style.width=P[0]+"px",O.parentElement.style.height=P[1]+"px"),i.postMessage("ix_ht_render_adm:"+JSON.stringify({adm:x,id:o,size:P}),"*")}}}}function u(e,r,i){h.hasOwnProperty(e)||(h[e]={}),h[e].lineItemType=r,h[e].idKey=i}var p,l,f,m,h={},y={},g={},S={},_={};return function(){p={},l={},m=e.sizeRetargeting||null,f=setInterval(t,Constants.RENDER_SERVICE_EXPIRY_SWEEP_TIMER),EventsService=SpaceCamp.services.EventsService,window.addEventListener("message",function(e){try{if(!Utilities.isString(e.data)||"ix_ht_render:"!==e.data.substr(0,"ix_ht_render:".length))return;c(JSON.parse(e.data.substr("ix_ht_render:".length)),e.source,e.origin)}catch(e){EventsService.emit("internal_error","Error occurred while rendering ad.",e.stack)}},!1)}(),{__adStorage:p,__expiredAdStorage:l,__expirySweepIntervalId:f,__findAdIdsFromMap:r,registerAd:d,render:o,registerPartner:u,renderDfpAd:v,__expireAd:i,__removeExpiredAds:t}}var Constants=require("constants.js"),Size=require("size.js"),SpaceCamp=require("space-camp.js"),System=require("system.js"),Utilities=require("utilities.js"),Whoopsie=require("whoopsie.js"),EventsService;module.exports=RenderService;
},{"constants.js":"/wrapper/src/libs/constants.js","size.js":"/wrapper/src/libs/size.js","space-camp.js":"/wrapper/src/space-camp.js","system.js":"/wrapper/src/libs/system.js","utilities.js":"/wrapper/src/libs/utilities.js","whoopsie.js":"/wrapper/src/libs/whoopsie.js"}],"/wrapper/src/services/stubs/compliance-service.stub.js":[function(require,module,exports){
"use strict";function ComplianceServiceStub(){function e(){return{applies:!0,consentString:""}}function n(){return!1}function r(e){return e}function t(){return Prms.resolve()}return{gdpr:{getConsent:e,setApplies:function(){}},isPrivacyEnabled:n,delay:r,wait:t}}var Prms=require("prms.js");module.exports=ComplianceServiceStub;
},{"prms.js":"/wrapper/src/libs/external/prms.js"}],"/wrapper/src/services/stubs/events-service.stub.js":[function(require,module,exports){
"use strict";var System=require("system.js");module.exports=function(){return{on:System.noOp,emit:System.noOp}};
},{"system.js":"/wrapper/src/libs/system.js"}],"/wrapper/src/services/timer-service.js":[function(require,module,exports){
"use strict";function TimerService(){function e(e){return function(){a[e].state=o.TERMINATED;for(var t=0;t<a[e].cbs.length;t++)try{a[e].cbs[t]()}catch(e){}delete a[e].cbs,delete a[e].timer}}function t(t,r,s){var i=System.generateUniqueId(Constants.SESSION_ID_LENGTH);return r=!!r,s=s?[s]:[],a[i]={state:o.NEW,cbs:s,timeout:t},r&&(a[i].state=o.RUNNABLE,a[i].timer=setTimeout(e(i),t)),i}function r(t){a.hasOwnProperty(t)&&a[t].state===o.NEW&&(a[t].state=o.RUNNABLE,a[t].timer=setTimeout(e(t),a[t].timeout))}function s(e,t){a.hasOwnProperty(e)&&a[e].state!==o.TERMINATED&&a[e].cbs.unshift(t)}function i(e){return a.hasOwnProperty(e)?a[e].state:null}function n(e){a.hasOwnProperty(e)&&a[e].state!==o.TERMINATED&&(a[e].state=o.TERMINATED,clearTimeout(a[e].timer),delete a[e].cbs,delete a[e].timer)}var a,o={NEW:0,RUNNABLE:1,TERMINATED:2};return function(){a={}}(),{TimerStates:o,__timerStorage:a,__generateTimerCallback:e,createTimer:t,startTimer:r,addTimerCallback:s,getTimerState:i,clearTimer:n}}var Constants=require("constants.js"),System=require("system.js"),Whoopsie=require("whoopsie.js");module.exports=TimerService;
},{"constants.js":"/wrapper/src/libs/constants.js","system.js":"/wrapper/src/libs/system.js","whoopsie.js":"/wrapper/src/libs/whoopsie.js"}],"/wrapper/src/shells/cassandra-shell.js":[function(require,module,exports){
"use strict";function CassandraShell(){function r(r){if(!Utilities.isObject(r))return void EventsService.emit("error","invalid first-party data: `data` must be an object");if(r.hasOwnProperty("rubicon")){if(!Utilities.isObject(r.rubicon))return void EventsService.emit("error","invalid first-party data.rubicon");for(var e in r.rubicon)if(r.rubicon.hasOwnProperty(e)&&-1===["keywords","inventory","visitor"].indexOf(e))return void EventsService.emit("error","invalid first-party data: unrecognized property "+e+" of `data.rubicon`");if(r.rubicon.hasOwnProperty("keywords")&&!Utilities.isArray(r.rubicon.keywords,"string"))return void EventsService.emit("error","invalid first-party data: `data.rubicon.keywords` must be an array of strings");if(r.rubicon.hasOwnProperty("inventory")){if(!Utilities.isObject(r.rubicon.inventory))return void EventsService.emit("error","invalid first-party data: `data.rubicon.inventory` must be an object");for(var t in r.rubicon.inventory)if(r.rubicon.inventory.hasOwnProperty(t)&&!Utilities.isArray(r.rubicon.inventory[t],"string"))return void EventsService.emit("error","invalid first-party data: property "+t+" of `data.rubicon.inventory` must be an array of strings")}if(r.rubicon.hasOwnProperty("visitor")){if(!Utilities.isObject(r.rubicon.visitor))return void EventsService.emit("error","invalid first-party data: `data.rubicon.visitor` must be an object");for(var i in r.rubicon.visitor)if(r.rubicon.visitor.hasOwnProperty(i)&&!Utilities.isArray(r.rubicon.visitor[i],"string"))return void EventsService.emit("error","invalid first-party data: property "+i+" of `data.rubicon.visitor` must be an array of strings")}}try{__directInterface.Layers.PartnersLayer.setFirstPartyData(r)}catch(r){EventsService.emit("error",r)}}function e(r,e){try{if(!Utilities.isFunction(e))return EventsService.emit("error","callback must be a function"),"";if(!Utilities.isArray(r,"object"))return void EventsService.emit("error","slotDemandObjs must be an array of objects");for(var t=0;t<r.length;t++){var i=r[t];if(!i.hasOwnProperty("slot"))return void EventsService.emit("error","slotDemandObjs["+t+"]: members must contain the slot property");if(!(i.slot.getSlotElementId&&i.slot.setTargeting&&i.slot.getTargeting&&i.slot.clearTargeting))return void EventsService.emit("error","slotDemandObjs["+t+"]: `slot` must be a google slot object");if(i.hasOwnProperty("firstPartyData")){if(!Utilities.isObject(i.firstPartyData))return void EventsService.emit("error","slotDemandObjs["+t+"]: invalid first-party data: `data` must be an object");if(i.firstPartyData.hasOwnProperty("rubicon")){var n=i.firstPartyData.rubicon;if(!Utilities.isObject(n))return void EventsService.emit("error","slotDemandObjs["+t+"]: invalid rubicon first-party data");for(var a in n)if(n.hasOwnProperty(a)&&-1===["keywords","inventory","visitor","position"].indexOf(a))return void EventsService.emit("error","slotDemandObjs["+t+"]: invalid first-party data: unrecognized property of `firstPartyData.rubicon`");if(n.hasOwnProperty("keywords")&&!Utilities.isArray(n.keywords,"string"))return void EventsService.emit("error","slotDemandObjs["+t+"]: invalid first-party data: `firstPartyData.rubicon.keywords` must be an array of strings");if(!n.hasOwnProperty("inventory")){if(!Utilities.isObject(n.inventory))return void EventsService.emit("error","slotDemandObjs["+t+"]: invalid first-party data: `firstPartyData.rubicon.inventory` must be an object");for(var s in n.inventory)if(n.inventory.hasOwnProperty(s)&&!Utilities.isArray(n.inventory[s],"string"))return void EventsService.emit("error","slotDemandObjs["+t+"]: invalid first-party data: property "+s+" of `firstPartyData.rubicon.inventory` must be an array of strings")}if(n.hasOwnProperty("visitor")){if(!Utilities.isObject(n.visitor))return void EventsService.emit("error","slotDemandObjs["+t+"]: invalid first-party data: `firstPartyData.rubicon.visitor` must be an object");for(var o in n.visitor)if(n.visitor.hasOwnProperty(o)&&!Utilities.isArray(n.visitor[o],"string"))return void EventsService.emit("error","slotDemandObjs["+t+"]: invalid first-party data: property "+o+" of `firstPartyData.rubicon.visitor` must be an array of strings")}if(n.hasOwnProperty("position")&&!Utilities.isString(n.position))return void EventsService.emit("error","slotDemandObjs["+t+"]: invalid first-party data: `firstPartyData.rubicon.position` must be a string")}}}__directInterface.Layers.GptLayer.retrieveAndSetTargeting(r).then(function(){e()}).catch(function(r){EventsService.emit("error",r),setTimeout(e.bind(null,"Error occurred while retrieving demand"+r.toString()),0)})}catch(r){EventsService.emit("error",r),setTimeout(e.bind(null,"Error occurred while retrieving demand"+r.toString()),0)}}function t(r,e,t){var i="";try{if(!Utilities.isBoolean(e))return EventsService.emit("error","`once` must be a boolean"),i;if(!Utilities.isFunction(t))return EventsService.emit("error","`callback` must be a function"),i;if(!Utilities.isString(r))return EventsService.emit("error","`eventName` must be a string"),i;if(!s.hasOwnProperty(r))return EventsService.emit("error","Unrecognized event "+r),i;var n=function(){var e=Array.prototype.slice.call(arguments);t(r,JSON.stringify(e))};i=e?EventsService.once(r,n):EventsService.on(r,n)}catch(r){EventsService.emit("error",r)}return i}function i(r){try{if(!Utilities.isString(r))return void EventsService.emit("error","`subscriptionId` must be a string");EventsService.off(r)}catch(r){EventsService.emit("error",r)}}var n,__directInterface,a,s={error:1,warning:2,global_timeout_reached:3,partner_instantiated:4,partner_request_sent:5,partner_request_complete:6};if(function(){try{n=window.configs,__directInterface=Loader(n).getDirectInterface(),ComplianceService=SpaceCamp.services.ComplianceService,EventsService=SpaceCamp.services.EventsService;try{__directInterface.Layers.IdentityLayer.retrieve()}catch(r){}}catch(r){a={setFirstPartyData:function(){},retrieveAndSetDemand:function(r,e){return setTimeout(e.bind(null,"wrapper failed to load"),0),""},subscribeEvent:function(){return""},unsubscribeEvent:function(){}}}}(),a)return a;var shellInterface={};if(window[SpaceCamp.NAMESPACE])for(var o in window[SpaceCamp.NAMESPACE])window[SpaceCamp.NAMESPACE].hasOwnProperty(o)&&(shellInterface[o]=window[SpaceCamp.NAMESPACE][o]);shellInterface.setFirstPartyData=r,shellInterface.retrieveAndSetDemand=ComplianceService.delay(e),shellInterface.subscribeEvent=t,shellInterface.unsubscribeEvent=i;try{eval(window.adapter.exports)}catch(r){}return shellInterface}var Browser=require("browser.js"),CommandQueue=require("command-queue.js"),Loader=require("loader.js"),SpaceCamp=require("space-camp.js"),Utilities=require("utilities.js"),ComplianceService,EventsService;module.exports=CassandraShell;
},{"browser.js":"/wrapper/src/libs/browser.js","command-queue.js":"/wrapper/src/libs/command-queue.js","loader.js":"/wrapper/src/loader.js","space-camp.js":"/wrapper/src/space-camp.js","utilities.js":"/wrapper/src/libs/utilities.js"}],"/wrapper/src/shells/direct-bidding-shell.js":[function(require,module,exports){
"use strict";function DirectBiddingShell(){function r(r){if(!Utilities.isObject(r))return void EventsService.emit("error","invalid first-party data: `data` must be an object");if(r.hasOwnProperty("rubicon")){if(!Utilities.isObject(r.rubicon))return void EventsService.emit("error","invalid first-party data.rubicon");for(var t in r.rubicon)if(r.rubicon.hasOwnProperty(t)&&-1===["keywords","inventory","visitor"].indexOf(t))return void EventsService.emit("error","invalid first-party data: unrecognized property "+t+" of `data.rubicon`");if(r.rubicon.hasOwnProperty("keywords")&&!Utilities.isArray(r.rubicon.keywords,"string"))return void EventsService.emit("error","invalid first-party data: `data.rubicon.keywords` must be an array of strings");if(r.rubicon.hasOwnProperty("inventory")){if(!Utilities.isObject(r.rubicon.inventory))return void EventsService.emit("error","invalid first-party data: `data.rubicon.inventory` must be an object");for(var i in r.rubicon.inventory)if(r.rubicon.inventory.hasOwnProperty(i)&&!Utilities.isArray(r.rubicon.inventory[i],"string"))return void EventsService.emit("error","invalid first-party data: property "+i+" of `data.rubicon.inventory` must be an array of strings")}if(r.rubicon.hasOwnProperty("visitor")){if(!Utilities.isObject(r.rubicon.visitor))return void EventsService.emit("error","invalid first-party data: `data.rubicon.visitor` must be an object");for(var e in r.rubicon.visitor)if(r.rubicon.visitor.hasOwnProperty(e)&&!Utilities.isArray(r.rubicon.visitor[e],"string"))return void EventsService.emit("error","invalid first-party data: property "+e+" of `data.rubicon.visitor` must be an array of strings")}}try{__directInterface.Layers.PartnersLayer.setFirstPartyData(r)}catch(r){EventsService.emit("error",r)}}function t(r,t){var i={sessionId:""};try{if(!Utilities.isFunction(t))return EventsService.emit("error","callback must be a function"),"";if(!Utilities.isArray(r,"object"))return void EventsService.emit("error","htSlotDemandObjs must be an array of objects");for(var e=0;e<r.length;e++){var n=r[e];if(!n.hasOwnProperty("htSlotName"))return void EventsService.emit("error","htSlotDemandObjs["+e+"]: members must contain the htSlotName property");if(!Utilities.isString(n.htSlotName))return void EventsService.emit("error","htSlotDemandObjs["+e+"]: htSlotName must be a string");if(n.hasOwnProperty("firstPartyData")){if(!Utilities.isObject(n.firstPartyData))return void EventsService.emit("error","htSlotDemandObjs["+e+"]: invalid first-party data: `data` must be an object");if(n.firstPartyData.hasOwnProperty("rubicon")){var a=n.firstPartyData.rubicon;if(!Utilities.isObject(a))return void EventsService.emit("error","htSlotDemandObjs["+e+"]: invalid rubicon first-party data");for(var s in a)if(a.hasOwnProperty(s)&&-1===["keywords","inventory","visitor","position"].indexOf(s))return void EventsService.emit("error","htSlotDemandObjs["+e+"]: invalid first-party data: unrecognized property of `firstPartyData.rubicon`");if(a.hasOwnProperty("keywords")&&!Utilities.isArray(a.keywords,"string"))return void EventsService.emit("error","htSlotDemandObjs["+e+"]: invalid first-party data: `firstPartyData.rubicon.keywords` must be an array of strings");if(!a.hasOwnProperty("inventory")){if(!Utilities.isObject(a.inventory))return void EventsService.emit("error","htSlotDemandObjs["+e+"]: invalid first-party data: `firstPartyData.rubicon.inventory` must be an object");for(var o in a.inventory)if(a.inventory.hasOwnProperty(o)&&!Utilities.isArray(a.inventory[o],"string"))return void EventsService.emit("error","htSlotDemandObjs["+e+"]: invalid first-party data: property "+o+" of `firstPartyData.rubicon.inventory` must be an array of strings")}if(a.hasOwnProperty("visitor")){if(!Utilities.isObject(a.visitor))return void EventsService.emit("error","htSlotDemandObjs["+e+"]: invalid first-party data: `firstPartyData.rubicon.visitor` must be an object");for(var v in a.visitor)if(a.visitor.hasOwnProperty(v)&&!Utilities.isArray(a.visitor[v],"string"))return void EventsService.emit("error","htSlotDemandObjs["+e+"]: invalid first-party data: property "+v+" of `firstPartyData.rubicon.visitor` must be an array of strings")}if(a.hasOwnProperty("position")&&!Utilities.isString(a.position))return void EventsService.emit("error","htSlotDemandObjs["+e+"]: invalid first-party data: `firstPartyData.rubicon.position` must be a string")}}}i=__directInterface.Layers.DirectBiddingLayer.retrieveDemand(r),i.promise.then(function(r){t(r)}).catch(function(r){EventsService.emit("error",r),setTimeout(t.bind(null,{}),0)})}catch(r){EventsService.emit("error",r),setTimeout(t.bind(null,{}),0)}return i.sessionId}function i(r,t,i){var e="";try{if(!Utilities.isBoolean(t))return EventsService.emit("error","`once` must be a boolean"),e;if(!Utilities.isFunction(i))return EventsService.emit("error","`callback` must be a function"),e;if(!Utilities.isString(r))return EventsService.emit("error","`eventName` must be a string"),e;if(!s.hasOwnProperty(r))return EventsService.emit("error","Unrecognized event "+r),e;var n=function(){var t=Array.prototype.slice.call(arguments);i(r,JSON.stringify(t))};e=t?EventsService.once(r,n):EventsService.on(r,n)}catch(r){EventsService.emit("error",r)}return e}function e(r){try{if(!Utilities.isString(r))return void EventsService.emit("error","`subscriptionId` must be a string");EventsService.off(r)}catch(r){EventsService.emit("error",r)}}var n,__directInterface,a,s={error:1,warning:2,global_timeout_reached:3,partner_instantiated:4,partner_request_sent:5,partner_request_complete:6};if(function(){try{n=window.configs,__directInterface=Loader(n).getDirectInterface(),ComplianceService=SpaceCamp.services.ComplianceService,EventsService=SpaceCamp.services.EventsService;try{__directInterface.Layers.IdentityLayer.retrieve()}catch(r){}}catch(r){a={setFirstPartyData:function(){},retrieveDemand:function(r,t){return setTimeout(t.bind(null,{}),0),""},subscribeEvent:function(){return""},unsubscribeEvent:function(){}}}}(),a)return a;var shellInterface={};if(window[SpaceCamp.NAMESPACE])for(var o in window[SpaceCamp.NAMESPACE])window[SpaceCamp.NAMESPACE].hasOwnProperty(o)&&(shellInterface[o]=window[SpaceCamp.NAMESPACE][o]);shellInterface.setFirstPartyData=r,shellInterface.retrieveDemand=ComplianceService.delay(t),shellInterface.subscribeEvent=i,shellInterface.unsubscribeEvent=e;try{eval(window.adapter.exports)}catch(r){}return shellInterface}var Browser=require("browser.js"),CommandQueue=require("command-queue.js"),Loader=require("loader.js"),SpaceCamp=require("space-camp.js"),Utilities=require("utilities.js"),ComplianceService,EventsService;module.exports=DirectBiddingShell;
},{"browser.js":"/wrapper/src/libs/browser.js","command-queue.js":"/wrapper/src/libs/command-queue.js","loader.js":"/wrapper/src/loader.js","space-camp.js":"/wrapper/src/space-camp.js","utilities.js":"/wrapper/src/libs/utilities.js"}],"/wrapper/src/shells/post-gpt-shell.js":[function(require,module,exports){
"use strict";function PostGptShell(){function e(e){for(var t=e.parentElement.parentElement.getAttribute("id"),r=GptHelper.getGpt().pubads().getSlots(),a=0;a<r.length;a++)if(r[a].getSlotElementId()===t)return r[a]}function t(e){if(UserAgentMatcher.msie||UserAgentMatcher.msedge){var t=System.generateUniqueId(),r=document.createElement("div");r.id=t,document.body.appendChild(r);var a=GptHelper.loadGpt();a.cmd.push(function(){window.parent.googletag.pubads().getTargetingKeys().map(function(e){a.pubads().setTargeting(e,window.parent.googletag.pubads().getTargeting(e))});var r=e.getAdUnitPath(),i=[];e.getSizes().map(function(e){i.push([e.getWidth(),e.getHeight()])});var o=e.getTargetingMap(),p=a.defineSlot(r,i,t).addService(a.pubads());for(var s in o)o.hasOwnProperty(s)&&p.setTargeting(s,o[s]);p.setTargeting(n.key,n.value),a.enableServices(),a.display(t)})}else e.setTargeting(n.key,n.value),GptHelper.run(function(){window.parent.googletag.pubads().refresh([e])},window.parent.googletag)}function r(r){var a=e(r);try{var n=Browser.createHiddenIFrame(null,window),i=window.frameElement;__directInterface.Layers.PostGptLayer.display(a,n,i).catch(function(e){try{t(a)}catch(e){}})}catch(e){try{t(a)}catch(e){}}}var a,n,__directInterface,i;if(function(){try{a=window.configs,n=a.Layers[0].configs.lineItemDisablerTargeting,__directInterface=Loader(a).getDirectInterface(),ComplianceService=SpaceCamp.services.ComplianceService;try{__directInterface.Layers.IdentityLayer.retrieve()}catch(e){}}catch(r){i={display:function(r){t(e(r))}}}}(),i)return i;var shellInterface={};if(window[SpaceCamp.NAMESPACE])for(var o in window[SpaceCamp.NAMESPACE])window[SpaceCamp.NAMESPACE].hasOwnProperty(o)&&(shellInterface[o]=window[SpaceCamp.NAMESPACE][o]);shellInterface.__findGSlot=e,shellInterface.display=ComplianceService.delay(r);try{eval(window.adapter.exports)}catch(e){}return shellInterface}var Browser=require("browser.js"),CommandQueue=require("command-queue.js"),GptHelper=require("gpt-helper.js"),Loader=require("loader.js"),SpaceCamp=require("space-camp.js"),System=require("system.js"),UserAgentMatcher=require("user-agent-matcher.js"),ComplianceService;module.exports=PostGptShell;
},{"browser.js":"/wrapper/src/libs/browser.js","command-queue.js":"/wrapper/src/libs/command-queue.js","gpt-helper.js":"/wrapper/src/libs/gpt-helper.js","loader.js":"/wrapper/src/loader.js","space-camp.js":"/wrapper/src/space-camp.js","system.js":"/wrapper/src/libs/system.js","user-agent-matcher.js":"/wrapper/src/libs/external/user-agent-matcher.js"}],"/wrapper/src/shells/pre-gpt-shell.js":[function(require,module,exports){
"use strict";function PreGptShell(){function e(e){return SpaceCamp.LastLineGoogletag.display?SpaceCamp.LastLineGoogletag.display(e):window.googletag.display(e)}function r(e,r){return SpaceCamp.LastLineGoogletag.refresh?SpaceCamp.LastLineGoogletag.refresh(e,r):window.googletag.pubads().refresh(e,r)}function i(e){return SpaceCamp.LastLineGoogletag.destroySlots?SpaceCamp.LastLineGoogletag.destroySlots(e):window.googletag.destroySlots(e)}function t(){return SpaceCamp.LastLineGoogletag.enableSingleRequest?SpaceCamp.LastLineGoogletag.enableSingleRequest():window.googletag.pubads().enableSingleRequest()}function a(){return SpaceCamp.LastLineGoogletag.disableInitialLoad?SpaceCamp.LastLineGoogletag.disableInitialLoad():window.googletag.pubads().disableInitialLoad()}function n(r){try{if(!Utilities.isString(r))return EventsService.emit("error","divId must be a string"),e(r);__directInterface.Layers.GptLayer.display(r).catch(function(i){return EventsService.emit("error",i),e(r)})}catch(i){return EventsService.emit("error",i),e(r)}}function o(e,i){try{if(e&&!Utilities.isArray(e))return EventsService.emit("error","gSlots must be an array of g-slots."),r(e,i);__directInterface.Layers.GptLayer.refresh(e,i).catch(function(t){return EventsService.emit("error",t),r(e,i)})}catch(t){return EventsService.emit("error",t),r(e,i)}}function s(e){try{return e&&!Utilities.isArray(e)?(EventsService.emit("error","gSlots must be an array of g-slots."),i(e)):__directInterface.Layers.GptLayer.destroySlots(e)}catch(r){return EventsService.emit("error",r),i(e)}}function c(){try{return __directInterface.Layers.GptLayer.enableSingleRequest()}catch(e){return EventsService.emit("error",e),t()}}function l(){try{return __directInterface.Layers.GptLayer.disableInitialLoad()}catch(e){return EventsService.emit("error",e),a()}}function u(){return S}function d(e){if(!Utilities.isObject(e))return void EventsService.emit("error","invalid first-party data: `data` must be an object");if(e.hasOwnProperty("rubicon")){if(!Utilities.isObject(e.rubicon))return void EventsService.emit("error","invalid first-party data.rubicon");for(var r in e.rubicon)if(e.rubicon.hasOwnProperty(r)&&-1===["keywords","inventory","visitor"].indexOf(r))return void EventsService.emit("error","invalid first-party data: unrecognized property "+r+" of `data.rubicon`");if(e.rubicon.hasOwnProperty("keywords")&&!Utilities.isArray(e.rubicon.keywords,"string"))return void EventsService.emit("error","invalid first-party data: `data.rubicon.keywords` must be an array of strings");if(e.rubicon.hasOwnProperty("inventory")){if(!Utilities.isObject(e.rubicon.inventory))return void EventsService.emit("error","invalid first-party data: `data.rubicon.inventory` must be an object");for(var i in e.rubicon.inventory)if(e.rubicon.inventory.hasOwnProperty(i)&&!Utilities.isArray(e.rubicon.inventory[i],"string"))return void EventsService.emit("error","invalid first-party data: property "+i+" of `data.rubicon.inventory` must be an array of strings")}if(e.rubicon.hasOwnProperty("visitor")){if(!Utilities.isObject(e.rubicon.visitor))return void EventsService.emit("error","invalid first-party data: `data.rubicon.visitor` must be an object");for(var t in e.rubicon.visitor)if(e.rubicon.visitor.hasOwnProperty(t)&&!Utilities.isArray(e.rubicon.visitor[t],"string"))return void EventsService.emit("error","invalid first-party data: property "+t+" of `data.rubicon.visitor` must be an array of strings")}}try{__directInterface.Layers.PartnersLayer.setFirstPartyData(e)}catch(e){EventsService.emit("error",e)}}function g(e,r,i){var t="";try{if(!Utilities.isBoolean(r))return EventsService.emit("error","`once` must be a boolean"),t;if(!Utilities.isFunction(i))return EventsService.emit("error","`callback` must be a function"),t;if(!Utilities.isString(e))return EventsService.emit("error","`eventName` must be a string"),t;if(!b.hasOwnProperty(e))return EventsService.emit("error","Unrecognized event "+e),t;var a=function(){var r=Array.prototype.slice.call(arguments);i(e,JSON.stringify(r))};t=r?EventsService.once(e,a):EventsService.on(e,a)}catch(e){EventsService.emit("error",e)}return t}function v(e){try{if(!Utilities.isString(e))return void EventsService.emit("error","`subscriptionId` must be a string");EventsService.off(e)}catch(e){EventsService.emit("error",e)}}var p,__directInterface,y,S,b={error:1,warning:2,global_timeout_reached:3,partner_instantiated:4,partner_request_sent:5,partner_request_complete:6};if(function(){SpaceCamp.LastLineGoogletag={};try{p=window.configs,window.googletag=window.googletag||{},window.googletag.cmd=window.googletag.cmd||[],__directInterface=Loader(p).getDirectInterface(),ComplianceService=SpaceCamp.services.ComplianceService,EventsService=SpaceCamp.services.EventsService;var u=p.Layers[0].configs.override;if(u){var d=function(){u.display&&(SpaceCamp.LastLineGoogletag.display=window.googletag.display,window.googletag.display=ComplianceService.delay(n)),u.refresh&&(SpaceCamp.LastLineGoogletag.refresh=window.googletag.pubads().refresh.bind(window.googletag.pubads()),window.googletag.pubads().refresh=ComplianceService.delay(o)),u.destroySlots&&(SpaceCamp.LastLineGoogletag.destroySlots=window.googletag.destroySlots,window.googletag.destroySlots=ComplianceService.delay(s)),u.enableSingleRequest&&(SpaceCamp.LastLineGoogletag.enableSingleRequest=window.googletag.pubads().enableSingleRequest.bind(window.googletag.pubads()),window.googletag.pubads().enableSingleRequest=c),u.disableInitialLoad&&(SpaceCamp.LastLineGoogletag.disableInitialLoad=window.googletag.pubads().disableInitialLoad.bind(window.googletag.pubads()),window.googletag.pubads().disableInitialLoad=l)};SpaceCamp.initQueue.unshift(d);var g=function(){SpaceCamp.initQueue=CommandQueue(SpaceCamp.initQueue)};Utilities.isArray(window.googletag.cmd)?window.googletag.cmd.unshift(g):window.googletag.cmd.push(g)}S={refresh:ComplianceService.delay(o),enableSingleRequest:c,disableInitialLoad:l};try{__directInterface.Layers.IdentityLayer.retrieve()}catch(e){}}catch(n){y={display:e,destroySlots:i,pubads:function(){return{refresh:r,enableSingleRequest:t,disableInitialLoad:a}},setFirstPartyData:function(){},subscribeEvent:function(){return""},unsubscribeEvent:function(){}}}}(),y)return y;var shellInterface={};if(window[SpaceCamp.NAMESPACE])for(var m in window[SpaceCamp.NAMESPACE])window[SpaceCamp.NAMESPACE].hasOwnProperty(m)&&(shellInterface[m]=window[SpaceCamp.NAMESPACE][m]);shellInterface.display=ComplianceService.delay(n),shellInterface.refresh=ComplianceService.delay(o),shellInterface.destroySlots=ComplianceService.delay(s),shellInterface.enableSingleRequest=c,shellInterface.disableInitialLoad=l,shellInterface.pubads=u,shellInterface.setFirstPartyData=d,shellInterface.subscribeEvent=g,shellInterface.unsubscribeEvent=v,shellInterface.apiReady=!0;try{eval(window.adapter.exports)}catch(e){}return shellInterface}var Browser=require("browser.js"),CommandQueue=require("command-queue.js"),Loader=require("loader.js"),SpaceCamp=require("space-camp.js"),Utilities=require("utilities.js"),ComplianceService,EventsService;module.exports=PreGptShell;
},{"browser.js":"/wrapper/src/libs/browser.js","command-queue.js":"/wrapper/src/libs/command-queue.js","loader.js":"/wrapper/src/loader.js","space-camp.js":"/wrapper/src/space-camp.js","utilities.js":"/wrapper/src/libs/utilities.js"}],"/wrapper/src/space-camp.js":[function(require,module,exports){
"use strict";var SpaceCamp={NAMESPACE:"headertag",PRODUCT:"DfpMode",services:{},htSlots:[],htSlotsMap:{},DeviceTypeChecker:{},initQueue:[],globalTimeout:null,instanceId:null,version:"2.9.2"};module.exports=SpaceCamp;
},{}],"/wrapper/tests/helpers/base-configs.js":[function(require,module,exports){
'use strict';

// =============================================================================
// IMPORTS /////////////////////////////////////////////////////////////////////
// -----------------------------------------------------------------------------

var Utilities = require('./utilities');

// =============================================================================
// MAIN ////////////////////////////////////////////////////////////////////////
// -----------------------------------------------------------------------------

var baseConfigs = {
    DfpAuto: {
        shortcuts: {
            gptLayer: 'Layers[0].configs',
            partners: 'Layers[3].configs.partners'
        },
        config: {
            DeviceTypeChecker: {
                method: 'USER_AGENT',
                configs: {}
            },
            htSlots: {
                htSlotDesktopA: {
                    id: 'htSlotDesktopAId',
                    divId: 'divIdA',
                    sizeMapping: {
                        '0x0': [[300, 250], [300, 600]]
                    },
                    deviceType: 'desktop'
                },
                htSlotDesktopB: {
                    id: 'htSlotDesktopBId',
                    divId: 'divIdB',
                    sizeMapping: {
                        '0x0': [[300, 250], [300, 600]]
                    },
                    deviceType: 'desktop'
                }
            },
            Services: {
                HeaderStatsService: {
                    siteId: '123456',
                    configId: '40832032590',
                    options: {
                        auctionCycle: true
                    }
                },
                EventsService: {},
                RenderService: {},
                TimerService: {},
                ComplianceService: {
                    gdprAppliesDefault: false,
                    timeout: 0
                }
            },
            Layers: [
                {
                    layerId: 'GptLayer',
                    configs: {
                        globalTimeout: 100000,
                        enableSingleRequest: false,
                        disableInitialLoad: false,
                        override: {
                            display: false,
                            refresh: false,
                            destroySlots: false,
                            enableSingleRequest: false,
                            disableInitialLoad: false
                        },
                        slotMapping: {
                            selectors: ['divId'],
                            filters: ['deviceType']
                        }
                    }
                },
                {
                    layerId: 'MediationLayer',
                    configs: {
                        mediationLevel: 'NONE'
                    }

                },
                {
                    "layerId": "IdentityLayer",
                    "configs": {
                        "timeout": 0,
                        "partners": {
                            "AdserverOrgIp": {
                                "enabled": false,
                                "configs": {
                                    "publisherId": 11111
                                }
                            }
                        }
                    }
                },
                {
                    layerId: 'PartnersLayer',
                    configs: {
                        partners: {
                            DynamicPartnerLoader: {
                                enabled: true,
                                configs: {
                                    xSlots: {},
                                    mapping: {}
                                }
                            }
                        }
                    }
                }
            ]
        }
    },
    DfpManual: {},
    Universal: {},
    PostBid: {}
};

/**
 * Clones and returns a named configuration object.
 *
 * @param  {string} configName The name of the configuration you want.
 *
 * @return {object}            A cloned configuration object.
 */
function getConfig(configName) {
    if (!baseConfigs.hasOwnProperty(configName)) {
        return null;
    }

    var base = baseConfigs[configName];

    var configClone = Utilities.clonePlainObject(base.config);

    var out = {
        config: configClone
    };

    for (var shortcutName in base.shortcuts) {
        if (!base.shortcuts.hasOwnProperty(shortcutName)) {
            continue;
        }

        out[shortcutName] = Utilities.deepGet(
            configClone,
            base.shortcuts[shortcutName]
        );
    }

    return out;
}

// =============================================================================
// EXPORTS /////////////////////////////////////////////////////////////////////
// -----------------------------------------------------------------------------

module.exports = {
    getConfig: getConfig
};

},{"./utilities":"/wrapper/tests/helpers/utilities.js"}],"/wrapper/tests/helpers/gpt-page-maker.js":[function(require,module,exports){
'use strict';

// =============================================================================
// IMPORTS /////////////////////////////////////////////////////////////////////
// -----------------------------------------------------------------------------

var Utilities = require('./utilities');

// =============================================================================
// CONSTANTS ///////////////////////////////////////////////////////////////////
// -----------------------------------------------------------------------------

var AD_UNIT_PATHS = {
    FRIENDLYFRAME_SIZE: '/62650033/pktf-ff-size',
    FRIENDLYFRAME_PRICE: '/62650033/pktf-ff-price',
    SAFEFRAME_SIZE: '/62650033/pktf-sf-size',
    SAFEFRAME_PRICE: '/77475840/pktf/sf-price',
    LEGACY_SIZE: '/62650033/pktf-ff-legacy-size'
};

// =============================================================================
// MAIN ////////////////////////////////////////////////////////////////////////
// -----------------------------------------------------------------------------

function GptPageMaker(hostWindow, options) {
    var __window;
    var __readyPromise;
    var __gSlots;

    function unloadGpt() {
        __window.googletag.destroySlots();

        for (var divId in __gSlots) {
            if (!__gSlots.hasOwnProperty(divId)) {
                continue;
            }

            __gSlots[divId].div.parentNode.removeChild(__gSlots[divId].div);
        }

        __window.googletag = undefined;
    }

    function __loadGpt() {
        return new Promise(function (resolve) {
            // Setup window variables for GPT.
            __window.googletag = __window.googletag || {};
            __window.googletag.cmd = __window.googletag.cmd || [];

            // Push function to configure SRA/DIL and enable services as first
            // thing in the GPT command queue.
            __window.googletag.cmd.push(function () {
                if (options) {
                    if (options.disableInitialLoad) {
                        __window.googletag.pubads().disableInitialLoad();
                    }

                    if (options.enableSingleRequest) {
                        __window.googletag.pubads().enableSingleRequest();
                    }
                }

                __window.googletag.enableServices();

                resolve(__window.googletag);
            });

            // Create a new script tag pointing to the GPT library and append
            // it to the DOM.
            var script = __window.document.createElement('script');
            script.type = 'text/javascript';
            script.async = true;
            script.src = (__window.document.location.protocol === 'https:' ? 'https:' : 'http:')
            + '//www.googletagservices.com/tag/js/gpt.js';

            __window.document.head.appendChild(script);
        });
    }

    function getGpt() {
        return __window.googletag;
    }

    function getSlots() {
        return __window.googletag.pubads()
            .getSlots()
            .slice();
    }

    function getSlotsMap() {
        var map = {};

        var gSlots = getSlots();

        for (var i = 0; i < gSlots.length; i++) {
            map[gSlots[i].getSlotElementId()] = gSlots[i];
        }

        return map;
    }

    function addGSlot(configs) {
        // Create a div element for the g-slot.
        var gDiv = __window.document.createElement('div');
        gDiv.setAttribute('id', configs.divId);

        // Add the div element to the body.
        __window.document.body.appendChild(gDiv);

        // Create and register the g-slot.
        var gSlot = __window.googletag.defineSlot(
            configs.adUnitPath,
            configs.sizes,
            configs.divId
        );
        gSlot.addService(__window.googletag.pubads());

        __window.googletag.enableServices();

        __gSlots[configs.divId] = {
            div: gDiv,
            gSlot: gSlot
        };

        return gSlot;
    }

    function ready() {
        return __readyPromise;
    }

    function setPageLevelTargeting(key, value) {
        if (Utilities.getType(value) === 'string') {
            value = [value];
        }

        __window.googletag.pubads().setTargeting(key, value);
    }

    (function __constructor() {
        __window = hostWindow;
        __readyPromise = __loadGpt();
        __gSlots = {};
    })();

    return {
        unloadGpt: unloadGpt,
        getGpt: getGpt,
        getSlots: getSlots,
        getSlotsMap: getSlotsMap,
        addGSlot: addGSlot,
        ready: ready,
        setPageLevelTargeting: setPageLevelTargeting
    };
}

// =============================================================================
// EXPORTS /////////////////////////////////////////////////////////////////////
// -----------------------------------------------------------------------------

GptPageMaker.AD_UNIT_PATHS = AD_UNIT_PATHS;

module.exports = GptPageMaker;

},{"./utilities":"/wrapper/tests/helpers/utilities.js"}],"/wrapper/tests/helpers/hacks.js":[function(require,module,exports){
'use strict';

// =============================================================================
// MAIN ////////////////////////////////////////////////////////////////////////
// -----------------------------------------------------------------------------

var SpaceCamp = require('space-camp.js');
var Utilities = require('./utilities');

// =============================================================================
// MAIN ////////////////////////////////////////////////////////////////////////
// -----------------------------------------------------------------------------

function resetSpaceCamp() {
    SpaceCamp = Utilities.mergeObjects(SpaceCamp, {
        services: {},
        htSlots: [],
        htSlotsMap: {},
        DeviceTypeChecker: {},
        initQueue: [],
        globalTimeout: null,
        instanceId: null
    });
}

// =============================================================================
// EXPORTS /////////////////////////////////////////////////////////////////////
// -----------------------------------------------------------------------------

module.exports = {
    resetSpaceCamp: resetSpaceCamp
};

},{"./utilities":"/wrapper/tests/helpers/utilities.js","space-camp.js":"/wrapper/src/space-camp.js"}],"/wrapper/tests/helpers/header-stats-auditor.js":[function(require,module,exports){
'use strict';

// =============================================================================
// MAIN ////////////////////////////////////////////////////////////////////////
// -----------------------------------------------------------------------------

function parse(rawData) {
    rawData = JSON.parse(rawData);

    var parsedData = {
        htSlotStats: {}
    };

    for (var i = 0; i < rawData.sl.length; i++) {
        var htSlotStats = rawData.sl[i];

        if (!parsedData.htSlotStats.hasOwnProperty(htSlotStats.s)) {
            parsedData.htSlotStats[htSlotStats.s] = {};
        }

        for (var j = 0; j < htSlotStats.e.length; j++) {
            var htSlotEvent = htSlotStats.e[j];

            if (!parsedData.htSlotStats[htSlotStats.s].hasOwnProperty(htSlotEvent.b)) {
                parsedData.htSlotStats[htSlotStats.s][htSlotEvent.b] = {
                    bid_requests: 0,
                    bid_responses: 0,
                    bid_passes: 0,
                    bid_timeouts: 0,
                    bid_errors: 0
                };
            }

            if (parsedData.htSlotStats[htSlotStats.s][htSlotEvent.b]
                .hasOwnProperty(htSlotEvent.n)) {
                parsedData.htSlotStats[htSlotStats.s][htSlotEvent.b][htSlotEvent.n]++;
            }
        }
    }

    return parsedData;
}

function isBalanced(rawData) {
    var htSlotStats = parse(rawData).htSlotStats;

    for (var htSlotId in htSlotStats) {
        if (!htSlotStats.hasOwnProperty(htSlotId)) {
            continue;
        }

        for (var partnerStatsId in htSlotStats[htSlotId]) {
            if (!htSlotStats[htSlotId].hasOwnProperty(partnerStatsId)) {
                continue;
            }

            var stat = htSlotStats[htSlotId][partnerStatsId];
            var balance = stat.bid_requests
                - stat.bid_responses
                - stat.bid_passes
                - stat.bid_timeouts
                - stat.bid_errors;

            if (balance !== 0) {
                return false;
            }
        }
    }

    return true;
}

// =============================================================================
// EXPORTS /////////////////////////////////////////////////////////////////////
// -----------------------------------------------------------------------------

module.exports = {
    parse: parse,
    isBalanced: isBalanced
};

},{}],"/wrapper/tests/helpers/polyfills/promise.js":[function(require,module,exports){
(function (process,global){
/*!
 * @overview es6-promise - a tiny implementation of Promises/A+.
 * @copyright Copyright (c) 2014 Yehuda Katz, Tom Dale, Stefan Penner and contributors (Conversion to ES6 API by Jake Archibald)
 * @license   Licensed under MIT license
 *            See https://raw.githubusercontent.com/stefanpenner/es6-promise/master/LICENSE
 * @version   v4.2.4+314e4831
 */

(function (global, factory) {
    typeof exports === 'object' && typeof module !== 'undefined' ? module.exports = factory() :
    typeof define === 'function' && define.amd ? define(factory) :
    (global.ES6Promise = factory());
}(this, (function () { 'use strict';

function objectOrFunction(x) {
  var type = typeof x;
  return x !== null && (type === 'object' || type === 'function');
}

function isFunction(x) {
  return typeof x === 'function';
}



var _isArray = void 0;
if (Array.isArray) {
  _isArray = Array.isArray;
} else {
  _isArray = function (x) {
    return Object.prototype.toString.call(x) === '[object Array]';
  };
}

var isArray = _isArray;

var len = 0;
var vertxNext = void 0;
var customSchedulerFn = void 0;

var asap = function asap(callback, arg) {
  queue[len] = callback;
  queue[len + 1] = arg;
  len += 2;
  if (len === 2) {
    // If len is 2, that means that we need to schedule an async flush.
    // If additional callbacks are queued before the queue is flushed, they
    // will be processed by this flush that we are scheduling.
    if (customSchedulerFn) {
      customSchedulerFn(flush);
    } else {
      scheduleFlush();
    }
  }
};

function setScheduler(scheduleFn) {
  customSchedulerFn = scheduleFn;
}

function setAsap(asapFn) {
  asap = asapFn;
}

var browserWindow = typeof window !== 'undefined' ? window : undefined;
var browserGlobal = browserWindow || {};
var BrowserMutationObserver = browserGlobal.MutationObserver || browserGlobal.WebKitMutationObserver;
var isNode = typeof self === 'undefined' && typeof process !== 'undefined' && {}.toString.call(process) === '[object process]';

// test for web worker but not in IE10
var isWorker = typeof Uint8ClampedArray !== 'undefined' && typeof importScripts !== 'undefined' && typeof MessageChannel !== 'undefined';

// node
function useNextTick() {
  // node version 0.10.x displays a deprecation warning when nextTick is used recursively
  // see https://github.com/cujojs/when/issues/410 for details
  return function () {
    return process.nextTick(flush);
  };
}

// vertx
function useVertxTimer() {
  if (typeof vertxNext !== 'undefined') {
    return function () {
      vertxNext(flush);
    };
  }

  return useSetTimeout();
}

function useMutationObserver() {
  var iterations = 0;
  var observer = new BrowserMutationObserver(flush);
  var node = document.createTextNode('');
  observer.observe(node, { characterData: true });

  return function () {
    node.data = iterations = ++iterations % 2;
  };
}

// web worker
function useMessageChannel() {
  var channel = new MessageChannel();
  channel.port1.onmessage = flush;
  return function () {
    return channel.port2.postMessage(0);
  };
}

function useSetTimeout() {
  // Store setTimeout reference so es6-promise will be unaffected by
  // other code modifying setTimeout (like sinon.useFakeTimers())
  var globalSetTimeout = setTimeout;
  return function () {
    return globalSetTimeout(flush, 1);
  };
}

var queue = new Array(1000);
function flush() {
  for (var i = 0; i < len; i += 2) {
    var callback = queue[i];
    var arg = queue[i + 1];

    callback(arg);

    queue[i] = undefined;
    queue[i + 1] = undefined;
  }

  len = 0;
}

function attemptVertx() {
  try {
    var vertx = Function('return this')().require('vertx');
    vertxNext = vertx.runOnLoop || vertx.runOnContext;
    return useVertxTimer();
  } catch (e) {
    return useSetTimeout();
  }
}

var scheduleFlush = void 0;
// Decide what async method to use to triggering processing of queued callbacks:
if (isNode) {
  scheduleFlush = useNextTick();
} else if (BrowserMutationObserver) {
  scheduleFlush = useMutationObserver();
} else if (isWorker) {
  scheduleFlush = useMessageChannel();
} else if (browserWindow === undefined && typeof require === 'function') {
  scheduleFlush = attemptVertx();
} else {
  scheduleFlush = useSetTimeout();
}

function then(onFulfillment, onRejection) {
  var parent = this;

  var child = new this.constructor(noop);

  if (child[PROMISE_ID] === undefined) {
    makePromise(child);
  }

  var _state = parent._state;


  if (_state) {
    var callback = arguments[_state - 1];
    asap(function () {
      return invokeCallback(_state, child, callback, parent._result);
    });
  } else {
    subscribe(parent, child, onFulfillment, onRejection);
  }

  return child;
}

/**
  `Promise.resolve` returns a promise that will become resolved with the
  passed `value`. It is shorthand for the following:

  ```javascript
  let promise = new Promise(function(resolve, reject){
    resolve(1);
  });

  promise.then(function(value){
    // value === 1
  });
  ```

  Instead of writing the above, your code now simply becomes the following:

  ```javascript
  let promise = Promise.resolve(1);

  promise.then(function(value){
    // value === 1
  });
  ```

  @method resolve
  @static
  @param {Any} value value that the returned promise will be resolved with
  Useful for tooling.
  @return {Promise} a promise that will become fulfilled with the given
  `value`
*/
function resolve$1(object) {
  /*jshint validthis:true */
  var Constructor = this;

  if (object && typeof object === 'object' && object.constructor === Constructor) {
    return object;
  }

  var promise = new Constructor(noop);
  resolve(promise, object);
  return promise;
}

var PROMISE_ID = Math.random().toString(36).substring(2);

function noop() {}

var PENDING = void 0;
var FULFILLED = 1;
var REJECTED = 2;

var TRY_CATCH_ERROR = { error: null };

function selfFulfillment() {
  return new TypeError("You cannot resolve a promise with itself");
}

function cannotReturnOwn() {
  return new TypeError('A promises callback cannot return that same promise.');
}

function getThen(promise) {
  try {
    return promise.then;
  } catch (error) {
    TRY_CATCH_ERROR.error = error;
    return TRY_CATCH_ERROR;
  }
}

function tryThen(then$$1, value, fulfillmentHandler, rejectionHandler) {
  try {
    then$$1.call(value, fulfillmentHandler, rejectionHandler);
  } catch (e) {
    return e;
  }
}

function handleForeignThenable(promise, thenable, then$$1) {
  asap(function (promise) {
    var sealed = false;
    var error = tryThen(then$$1, thenable, function (value) {
      if (sealed) {
        return;
      }
      sealed = true;
      if (thenable !== value) {
        resolve(promise, value);
      } else {
        fulfill(promise, value);
      }
    }, function (reason) {
      if (sealed) {
        return;
      }
      sealed = true;

      reject(promise, reason);
    }, 'Settle: ' + (promise._label || ' unknown promise'));

    if (!sealed && error) {
      sealed = true;
      reject(promise, error);
    }
  }, promise);
}

function handleOwnThenable(promise, thenable) {
  if (thenable._state === FULFILLED) {
    fulfill(promise, thenable._result);
  } else if (thenable._state === REJECTED) {
    reject(promise, thenable._result);
  } else {
    subscribe(thenable, undefined, function (value) {
      return resolve(promise, value);
    }, function (reason) {
      return reject(promise, reason);
    });
  }
}

function handleMaybeThenable(promise, maybeThenable, then$$1) {
  if (maybeThenable.constructor === promise.constructor && then$$1 === then && maybeThenable.constructor.resolve === resolve$1) {
    handleOwnThenable(promise, maybeThenable);
  } else {
    if (then$$1 === TRY_CATCH_ERROR) {
      reject(promise, TRY_CATCH_ERROR.error);
      TRY_CATCH_ERROR.error = null;
    } else if (then$$1 === undefined) {
      fulfill(promise, maybeThenable);
    } else if (isFunction(then$$1)) {
      handleForeignThenable(promise, maybeThenable, then$$1);
    } else {
      fulfill(promise, maybeThenable);
    }
  }
}

function resolve(promise, value) {
  if (promise === value) {
    reject(promise, selfFulfillment());
  } else if (objectOrFunction(value)) {
    handleMaybeThenable(promise, value, getThen(value));
  } else {
    fulfill(promise, value);
  }
}

function publishRejection(promise) {
  if (promise._onerror) {
    promise._onerror(promise._result);
  }

  publish(promise);
}

function fulfill(promise, value) {
  if (promise._state !== PENDING) {
    return;
  }

  promise._result = value;
  promise._state = FULFILLED;

  if (promise._subscribers.length !== 0) {
    asap(publish, promise);
  }
}

function reject(promise, reason) {
  if (promise._state !== PENDING) {
    return;
  }
  promise._state = REJECTED;
  promise._result = reason;

  asap(publishRejection, promise);
}

function subscribe(parent, child, onFulfillment, onRejection) {
  var _subscribers = parent._subscribers;
  var length = _subscribers.length;


  parent._onerror = null;

  _subscribers[length] = child;
  _subscribers[length + FULFILLED] = onFulfillment;
  _subscribers[length + REJECTED] = onRejection;

  if (length === 0 && parent._state) {
    asap(publish, parent);
  }
}

function publish(promise) {
  var subscribers = promise._subscribers;
  var settled = promise._state;

  if (subscribers.length === 0) {
    return;
  }

  var child = void 0,
      callback = void 0,
      detail = promise._result;

  for (var i = 0; i < subscribers.length; i += 3) {
    child = subscribers[i];
    callback = subscribers[i + settled];

    if (child) {
      invokeCallback(settled, child, callback, detail);
    } else {
      callback(detail);
    }
  }

  promise._subscribers.length = 0;
}

function tryCatch(callback, detail) {
  try {
    return callback(detail);
  } catch (e) {
    TRY_CATCH_ERROR.error = e;
    return TRY_CATCH_ERROR;
  }
}

function invokeCallback(settled, promise, callback, detail) {
  var hasCallback = isFunction(callback),
      value = void 0,
      error = void 0,
      succeeded = void 0,
      failed = void 0;

  if (hasCallback) {
    value = tryCatch(callback, detail);

    if (value === TRY_CATCH_ERROR) {
      failed = true;
      error = value.error;
      value.error = null;
    } else {
      succeeded = true;
    }

    if (promise === value) {
      reject(promise, cannotReturnOwn());
      return;
    }
  } else {
    value = detail;
    succeeded = true;
  }

  if (promise._state !== PENDING) {
    // noop
  } else if (hasCallback && succeeded) {
    resolve(promise, value);
  } else if (failed) {
    reject(promise, error);
  } else if (settled === FULFILLED) {
    fulfill(promise, value);
  } else if (settled === REJECTED) {
    reject(promise, value);
  }
}

function initializePromise(promise, resolver) {
  try {
    resolver(function resolvePromise(value) {
      resolve(promise, value);
    }, function rejectPromise(reason) {
      reject(promise, reason);
    });
  } catch (e) {
    reject(promise, e);
  }
}

var id = 0;
function nextId() {
  return id++;
}

function makePromise(promise) {
  promise[PROMISE_ID] = id++;
  promise._state = undefined;
  promise._result = undefined;
  promise._subscribers = [];
}

function validationError() {
  return new Error('Array Methods must be provided an Array');
}

var Enumerator = function () {
  function Enumerator(Constructor, input) {
    this._instanceConstructor = Constructor;
    this.promise = new Constructor(noop);

    if (!this.promise[PROMISE_ID]) {
      makePromise(this.promise);
    }

    if (isArray(input)) {
      this.length = input.length;
      this._remaining = input.length;

      this._result = new Array(this.length);

      if (this.length === 0) {
        fulfill(this.promise, this._result);
      } else {
        this.length = this.length || 0;
        this._enumerate(input);
        if (this._remaining === 0) {
          fulfill(this.promise, this._result);
        }
      }
    } else {
      reject(this.promise, validationError());
    }
  }

  Enumerator.prototype._enumerate = function _enumerate(input) {
    for (var i = 0; this._state === PENDING && i < input.length; i++) {
      this._eachEntry(input[i], i);
    }
  };

  Enumerator.prototype._eachEntry = function _eachEntry(entry, i) {
    var c = this._instanceConstructor;
    var resolve$$1 = c.resolve;


    if (resolve$$1 === resolve$1) {
      var _then = getThen(entry);

      if (_then === then && entry._state !== PENDING) {
        this._settledAt(entry._state, i, entry._result);
      } else if (typeof _then !== 'function') {
        this._remaining--;
        this._result[i] = entry;
      } else if (c === Promise$2) {
        var promise = new c(noop);
        handleMaybeThenable(promise, entry, _then);
        this._willSettleAt(promise, i);
      } else {
        this._willSettleAt(new c(function (resolve$$1) {
          return resolve$$1(entry);
        }), i);
      }
    } else {
      this._willSettleAt(resolve$$1(entry), i);
    }
  };

  Enumerator.prototype._settledAt = function _settledAt(state, i, value) {
    var promise = this.promise;


    if (promise._state === PENDING) {
      this._remaining--;

      if (state === REJECTED) {
        reject(promise, value);
      } else {
        this._result[i] = value;
      }
    }

    if (this._remaining === 0) {
      fulfill(promise, this._result);
    }
  };

  Enumerator.prototype._willSettleAt = function _willSettleAt(promise, i) {
    var enumerator = this;

    subscribe(promise, undefined, function (value) {
      return enumerator._settledAt(FULFILLED, i, value);
    }, function (reason) {
      return enumerator._settledAt(REJECTED, i, reason);
    });
  };

  return Enumerator;
}();

/**
  `Promise.all` accepts an array of promises, and returns a new promise which
  is fulfilled with an array of fulfillment values for the passed promises, or
  rejected with the reason of the first passed promise to be rejected. It casts all
  elements of the passed iterable to promises as it runs this algorithm.

  Example:

  ```javascript
  let promise1 = resolve(1);
  let promise2 = resolve(2);
  let promise3 = resolve(3);
  let promises = [ promise1, promise2, promise3 ];

  Promise.all(promises).then(function(array){
    // The array here would be [ 1, 2, 3 ];
  });
  ```

  If any of the `promises` given to `all` are rejected, the first promise
  that is rejected will be given as an argument to the returned promises's
  rejection handler. For example:

  Example:

  ```javascript
  let promise1 = resolve(1);
  let promise2 = reject(new Error("2"));
  let promise3 = reject(new Error("3"));
  let promises = [ promise1, promise2, promise3 ];

  Promise.all(promises).then(function(array){
    // Code here never runs because there are rejected promises!
  }, function(error) {
    // error.message === "2"
  });
  ```

  @method all
  @static
  @param {Array} entries array of promises
  @param {String} label optional string for labeling the promise.
  Useful for tooling.
  @return {Promise} promise that is fulfilled when all `promises` have been
  fulfilled, or rejected if any of them become rejected.
  @static
*/
function all(entries) {
  return new Enumerator(this, entries).promise;
}

/**
  `Promise.race` returns a new promise which is settled in the same way as the
  first passed promise to settle.

  Example:

  ```javascript
  let promise1 = new Promise(function(resolve, reject){
    setTimeout(function(){
      resolve('promise 1');
    }, 200);
  });

  let promise2 = new Promise(function(resolve, reject){
    setTimeout(function(){
      resolve('promise 2');
    }, 100);
  });

  Promise.race([promise1, promise2]).then(function(result){
    // result === 'promise 2' because it was resolved before promise1
    // was resolved.
  });
  ```

  `Promise.race` is deterministic in that only the state of the first
  settled promise matters. For example, even if other promises given to the
  `promises` array argument are resolved, but the first settled promise has
  become rejected before the other promises became fulfilled, the returned
  promise will become rejected:

  ```javascript
  let promise1 = new Promise(function(resolve, reject){
    setTimeout(function(){
      resolve('promise 1');
    }, 200);
  });

  let promise2 = new Promise(function(resolve, reject){
    setTimeout(function(){
      reject(new Error('promise 2'));
    }, 100);
  });

  Promise.race([promise1, promise2]).then(function(result){
    // Code here never runs
  }, function(reason){
    // reason.message === 'promise 2' because promise 2 became rejected before
    // promise 1 became fulfilled
  });
  ```

  An example real-world use case is implementing timeouts:

  ```javascript
  Promise.race([ajax('foo.json'), timeout(5000)])
  ```

  @method race
  @static
  @param {Array} promises array of promises to observe
  Useful for tooling.
  @return {Promise} a promise which settles in the same way as the first passed
  promise to settle.
*/
function race(entries) {
  /*jshint validthis:true */
  var Constructor = this;

  if (!isArray(entries)) {
    return new Constructor(function (_, reject) {
      return reject(new TypeError('You must pass an array to race.'));
    });
  } else {
    return new Constructor(function (resolve, reject) {
      var length = entries.length;
      for (var i = 0; i < length; i++) {
        Constructor.resolve(entries[i]).then(resolve, reject);
      }
    });
  }
}

/**
  `Promise.reject` returns a promise rejected with the passed `reason`.
  It is shorthand for the following:

  ```javascript
  let promise = new Promise(function(resolve, reject){
    reject(new Error('WHOOPS'));
  });

  promise.then(function(value){
    // Code here doesn't run because the promise is rejected!
  }, function(reason){
    // reason.message === 'WHOOPS'
  });
  ```

  Instead of writing the above, your code now simply becomes the following:

  ```javascript
  let promise = Promise.reject(new Error('WHOOPS'));

  promise.then(function(value){
    // Code here doesn't run because the promise is rejected!
  }, function(reason){
    // reason.message === 'WHOOPS'
  });
  ```

  @method reject
  @static
  @param {Any} reason value that the returned promise will be rejected with.
  Useful for tooling.
  @return {Promise} a promise rejected with the given `reason`.
*/
function reject$1(reason) {
  /*jshint validthis:true */
  var Constructor = this;
  var promise = new Constructor(noop);
  reject(promise, reason);
  return promise;
}

function needsResolver() {
  throw new TypeError('You must pass a resolver function as the first argument to the promise constructor');
}

function needsNew() {
  throw new TypeError("Failed to construct 'Promise': Please use the 'new' operator, this object constructor cannot be called as a function.");
}

/**
  Promise objects represent the eventual result of an asynchronous operation. The
  primary way of interacting with a promise is through its `then` method, which
  registers callbacks to receive either a promise's eventual value or the reason
  why the promise cannot be fulfilled.

  Terminology
  -----------

  - `promise` is an object or function with a `then` method whose behavior conforms to this specification.
  - `thenable` is an object or function that defines a `then` method.
  - `value` is any legal JavaScript value (including undefined, a thenable, or a promise).
  - `exception` is a value that is thrown using the throw statement.
  - `reason` is a value that indicates why a promise was rejected.
  - `settled` the final resting state of a promise, fulfilled or rejected.

  A promise can be in one of three states: pending, fulfilled, or rejected.

  Promises that are fulfilled have a fulfillment value and are in the fulfilled
  state.  Promises that are rejected have a rejection reason and are in the
  rejected state.  A fulfillment value is never a thenable.

  Promises can also be said to *resolve* a value.  If this value is also a
  promise, then the original promise's settled state will match the value's
  settled state.  So a promise that *resolves* a promise that rejects will
  itself reject, and a promise that *resolves* a promise that fulfills will
  itself fulfill.


  Basic Usage:
  ------------

  ```js
  let promise = new Promise(function(resolve, reject) {
    // on success
    resolve(value);

    // on failure
    reject(reason);
  });

  promise.then(function(value) {
    // on fulfillment
  }, function(reason) {
    // on rejection
  });
  ```

  Advanced Usage:
  ---------------

  Promises shine when abstracting away asynchronous interactions such as
  `XMLHttpRequest`s.

  ```js
  function getJSON(url) {
    return new Promise(function(resolve, reject){
      let xhr = new XMLHttpRequest();

      xhr.open('GET', url);
      xhr.onreadystatechange = handler;
      xhr.responseType = 'json';
      xhr.setRequestHeader('Accept', 'application/json');
      xhr.send();

      function handler() {
        if (this.readyState === this.DONE) {
          if (this.status === 200) {
            resolve(this.response);
          } else {
            reject(new Error('getJSON: `' + url + '` failed with status: [' + this.status + ']'));
          }
        }
      };
    });
  }

  getJSON('/posts.json').then(function(json) {
    // on fulfillment
  }, function(reason) {
    // on rejection
  });
  ```

  Unlike callbacks, promises are great composable primitives.

  ```js
  Promise.all([
    getJSON('/posts'),
    getJSON('/comments')
  ]).then(function(values){
    values[0] // => postsJSON
    values[1] // => commentsJSON

    return values;
  });
  ```

  @class Promise
  @param {Function} resolver
  Useful for tooling.
  @constructor
*/

var Promise$2 = function () {
  function Promise(resolver) {
    this[PROMISE_ID] = nextId();
    this._result = this._state = undefined;
    this._subscribers = [];

    if (noop !== resolver) {
      typeof resolver !== 'function' && needsResolver();
      this instanceof Promise ? initializePromise(this, resolver) : needsNew();
    }
  }

  /**
  The primary way of interacting with a promise is through its `then` method,
  which registers callbacks to receive either a promise's eventual value or the
  reason why the promise cannot be fulfilled.
   ```js
  findUser().then(function(user){
    // user is available
  }, function(reason){
    // user is unavailable, and you are given the reason why
  });
  ```
   Chaining
  --------
   The return value of `then` is itself a promise.  This second, 'downstream'
  promise is resolved with the return value of the first promise's fulfillment
  or rejection handler, or rejected if the handler throws an exception.
   ```js
  findUser().then(function (user) {
    return user.name;
  }, function (reason) {
    return 'default name';
  }).then(function (userName) {
    // If `findUser` fulfilled, `userName` will be the user's name, otherwise it
    // will be `'default name'`
  });
   findUser().then(function (user) {
    throw new Error('Found user, but still unhappy');
  }, function (reason) {
    throw new Error('`findUser` rejected and we're unhappy');
  }).then(function (value) {
    // never reached
  }, function (reason) {
    // if `findUser` fulfilled, `reason` will be 'Found user, but still unhappy'.
    // If `findUser` rejected, `reason` will be '`findUser` rejected and we're unhappy'.
  });
  ```
  If the downstream promise does not specify a rejection handler, rejection reasons will be propagated further downstream.
   ```js
  findUser().then(function (user) {
    throw new PedagogicalException('Upstream error');
  }).then(function (value) {
    // never reached
  }).then(function (value) {
    // never reached
  }, function (reason) {
    // The `PedgagocialException` is propagated all the way down to here
  });
  ```
   Assimilation
  ------------
   Sometimes the value you want to propagate to a downstream promise can only be
  retrieved asynchronously. This can be achieved by returning a promise in the
  fulfillment or rejection handler. The downstream promise will then be pending
  until the returned promise is settled. This is called *assimilation*.
   ```js
  findUser().then(function (user) {
    return findCommentsByAuthor(user);
  }).then(function (comments) {
    // The user's comments are now available
  });
  ```
   If the assimliated promise rejects, then the downstream promise will also reject.
   ```js
  findUser().then(function (user) {
    return findCommentsByAuthor(user);
  }).then(function (comments) {
    // If `findCommentsByAuthor` fulfills, we'll have the value here
  }, function (reason) {
    // If `findCommentsByAuthor` rejects, we'll have the reason here
  });
  ```
   Simple Example
  --------------
   Synchronous Example
   ```javascript
  let result;
   try {
    result = findResult();
    // success
  } catch(reason) {
    // failure
  }
  ```
   Errback Example
   ```js
  findResult(function(result, err){
    if (err) {
      // failure
    } else {
      // success
    }
  });
  ```
   Promise Example;
   ```javascript
  findResult().then(function(result){
    // success
  }, function(reason){
    // failure
  });
  ```
   Advanced Example
  --------------
   Synchronous Example
   ```javascript
  let author, books;
   try {
    author = findAuthor();
    books  = findBooksByAuthor(author);
    // success
  } catch(reason) {
    // failure
  }
  ```
   Errback Example
   ```js
   function foundBooks(books) {
   }
   function failure(reason) {
   }
   findAuthor(function(author, err){
    if (err) {
      failure(err);
      // failure
    } else {
      try {
        findBoooksByAuthor(author, function(books, err) {
          if (err) {
            failure(err);
          } else {
            try {
              foundBooks(books);
            } catch(reason) {
              failure(reason);
            }
          }
        });
      } catch(error) {
        failure(err);
      }
      // success
    }
  });
  ```
   Promise Example;
   ```javascript
  findAuthor().
    then(findBooksByAuthor).
    then(function(books){
      // found books
  }).catch(function(reason){
    // something went wrong
  });
  ```
   @method then
  @param {Function} onFulfilled
  @param {Function} onRejected
  Useful for tooling.
  @return {Promise}
  */

  /**
  `catch` is simply sugar for `then(undefined, onRejection)` which makes it the same
  as the catch block of a try/catch statement.
  ```js
  function findAuthor(){
  throw new Error('couldn't find that author');
  }
  // synchronous
  try {
  findAuthor();
  } catch(reason) {
  // something went wrong
  }
  // async with promises
  findAuthor().catch(function(reason){
  // something went wrong
  });
  ```
  @method catch
  @param {Function} onRejection
  Useful for tooling.
  @return {Promise}
  */


  Promise.prototype.catch = function _catch(onRejection) {
    return this.then(null, onRejection);
  };

  /**
    `finally` will be invoked regardless of the promise's fate just as native
    try/catch/finally behaves

    Synchronous example:

    ```js
    findAuthor() {
      if (Math.random() > 0.5) {
        throw new Error();
      }
      return new Author();
    }

    try {
      return findAuthor(); // succeed or fail
    } catch(error) {
      return findOtherAuther();
    } finally {
      // always runs
      // doesn't affect the return value
    }
    ```

    Asynchronous example:

    ```js
    findAuthor().catch(function(reason){
      return findOtherAuther();
    }).finally(function(){
      // author was either found, or not
    });
    ```

    @method finally
    @param {Function} callback
    @return {Promise}
  */


  Promise.prototype.finally = function _finally(callback) {
    var promise = this;
    var constructor = promise.constructor;

    return promise.then(function (value) {
      return constructor.resolve(callback()).then(function () {
        return value;
      });
    }, function (reason) {
      return constructor.resolve(callback()).then(function () {
        throw reason;
      });
    });
  };

  return Promise;
}();

Promise$2.prototype.then = then;
Promise$2.all = all;
Promise$2.race = race;
Promise$2.resolve = resolve$1;
Promise$2.reject = reject$1;
Promise$2._setScheduler = setScheduler;
Promise$2._setAsap = setAsap;
Promise$2._asap = asap;

/*global self*/
function polyfill() {
  var local = void 0;

  if (typeof global !== 'undefined') {
    local = global;
  } else if (typeof self !== 'undefined') {
    local = self;
  } else {
    try {
      local = Function('return this')();
    } catch (e) {
      throw new Error('polyfill failed because global object is unavailable in this environment');
    }
  }

  var P = local.Promise;

  if (P) {
    var promiseToString = null;
    try {
      promiseToString = Object.prototype.toString.call(P.resolve());
    } catch (e) {
      // silently ignored
    }

    if (promiseToString === '[object Promise]' && !P.cast) {
      return;
    }
  }

  local.Promise = Promise$2;
}

// Strange compat..
Promise$2.polyfill = polyfill;
Promise$2.Promise = Promise$2;

Promise$2.polyfill();

return Promise$2;

})));

}).call(this,require('_process'),typeof global !== "undefined" ? global : typeof self !== "undefined" ? self : typeof window !== "undefined" ? window : {})
},{"_process":1}],"/wrapper/tests/helpers/render-checker.js":[function(require,module,exports){
'use strict';

// =============================================================================
// IMPORTS /////////////////////////////////////////////////////////////////////
// -----------------------------------------------------------------------------

var Utilities = require('./utilities');

// =============================================================================
// MAIN ////////////////////////////////////////////////////////////////////////
// -----------------------------------------------------------------------------

function dfpFriendlyFrameRender(expectedRenders) {
    expectedRenders = expectedRenders || 1;
    var actualRenders = 0;

    var fnName = '_' + Utilities.generateUniqueId();

    var promise = new Promise(function (resolve) {
        window[fnName] = function () {
            actualRenders++;

            if (actualRenders !== expectedRenders) {
                return;
            }

            resolve();

            delete window[fnName];
        };
    });

    return {
        // eslint-disable-next-line max-len
        adm: '<script>var context=window;while(true){if(context.' + fnName + '){context.' + fnName + '()}if(context.frameElement===null){break}context=context.parent}</script><div style="background-color: #32CD32; width: 100%; height: 100%; border: 2px solid #000000"><h1>DfpFriendlyFrameRender</h1></div>',
        promise: promise
    };
}

function dfpPostMessageRender(expectedRenders) {
    expectedRenders = expectedRenders || 1;
    var actualRenders = 0;

    var uniqueId = Utilities.generateUniqueId();

    var promise = new Promise(function (resolve) {
        function dfpMostMessageListener(ev) {
            if (Utilities.getType(ev.data) !== 'string' || ev.data !== uniqueId) {
                return;
            }

            actualRenders++;

            if (actualRenders !== expectedRenders) {
                return;
            }

            resolve();

            window.removeEventListener('message', dfpMostMessageListener, false);
        }

        window.addEventListener('message', dfpMostMessageListener, false);
    });

    return {
        // eslint-disable-next-line max-len
        adm: '<script>var context=window;while(true){context.parent.postMessage(\'' + uniqueId + '\', \'*\');if(context.frameElement===null){break}context=context.parent}</script><div style="background-color: #32CD32; width: 100%; height: 100%; border: 2px solid #000000"><h1>DfpPostMessageRender</h1></div>',
        promise: promise
    };
}

// =============================================================================
// EXPORTS /////////////////////////////////////////////////////////////////////
// -----------------------------------------------------------------------------

module.exports = {
    dfpPostMessageRender: dfpPostMessageRender,
    dfpFriendlyFrameRender: dfpFriendlyFrameRender
};

},{"./utilities":"/wrapper/tests/helpers/utilities.js"}],"/wrapper/tests/helpers/stub-loader.js":[function(require,module,exports){
'use strict';

// =============================================================================
// IMPORTS /////////////////////////////////////////////////////////////////////
// -----------------------------------------------------------------------------

var Utilities = require('./utilities');

// =============================================================================
// CONSTANTS ///////////////////////////////////////////////////////////////////
// -----------------------------------------------------------------------------

/**
 * A list of all the stub objects. Cannot be loaded during runtime because of
 * the way Browserify packages all the times, and lack of NodeJS `fs` library
 * access.
 *
 * @type {object[]}
 */
var ALL_STUBS = [
    require('../stubs/space-camp.stub.js'),
    require('../stubs/libs/utilities.stub.js'),
    require('../stubs/libs/size.stub.js')
];

// =============================================================================
// MAIN ////////////////////////////////////////////////////////////////////////
// -----------------------------------------------------------------------------

// Combine all the preloaded stubs into a single object for easy access.
var stubs = {};

for (var i = 0; i < ALL_STUBS.length; i++) {
    var singleStub = ALL_STUBS[i];
    stubs = Utilities.mergeObjects(stubs, singleStub);
}

/**
 * Merges the specified stubs into a single Proxyquireify-compatible stub
 * object.
 *
 * @param  {string[]}   stubNames   A list dependencies to get stubs for.
 *
 * @return {object}                 An object containing all the requested
 *                                  stubs.
 */
function load(stubNames) {
    var loadedStubs = {};

    for (var j = 0; j < stubNames.length; j++) {
        var stubName = stubNames[j];

        if (!stubs.hasOwnProperty(stubName)) {
            throw Error('Stub with name ' + stubName + ' does not exist');
        }

        loadedStubs[stubName] = stubs[stubName];
    }

    return loadedStubs;
}

// =============================================================================
// EXPORTS /////////////////////////////////////////////////////////////////////
// -----------------------------------------------------------------------------

module.exports = {
    load: load
};

},{"../stubs/libs/size.stub.js":"/wrapper/tests/stubs/libs/size.stub.js","../stubs/libs/utilities.stub.js":"/wrapper/tests/stubs/libs/utilities.stub.js","../stubs/space-camp.stub.js":"/wrapper/tests/stubs/space-camp.stub.js","./utilities":"/wrapper/tests/helpers/utilities.js"}],"/wrapper/tests/helpers/utilities.js":[function(require,module,exports){
'use strict';

// =============================================================================
// CONSTANTS ///////////////////////////////////////////////////////////////////
// -----------------------------------------------------------------------------

var REGEX_TYPE = /\s([a-zA-Z]+)/;
var REGEX_ARRAY_ACCESS = /^(.*)\[(\d+)\]$/;

var CHARACTER_SETS = {
    ALPHANUM: 'ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789',
    ALPHA: 'ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz',
    ALPHA_UPPER: 'ABCDEFGHIJKLMNOPQRSTUVWXYZ',
    ALPHA_LOWER: 'abcdefghijklmnopqrstuvwxyz',
    HEX: '0123456789abcdef',
    NUM: '0123456789'
};

// =============================================================================
// MAIN ////////////////////////////////////////////////////////////////////////
// -----------------------------------------------------------------------------

/**
 * Returns the type of any entity as all lowercase. Handles edge-cases such as
 * `typeof null === 'object'`, by returning `'null'` instead of `'object'`.
 *
 * @param  {any}    entity  The object to enumerate the type for.
 *
 * @return {string}         A lowercase string containing the type of `entity`.
 */
function getType(entity) {
    if (typeof entity === 'undefined') {
        return 'undefined';
    }

    return {}.toString.call(entity).match(REGEX_TYPE)[1].toLowerCase();
}

/**
 * Appends elements from `source` to the end of `target`.
 *
 * @param  {any[]}  target  The array to append the elements to.
 * @param  {any[]}  source  The array to append the elements from.
 *
 * @return {any[]}          A pointer to `target`.
 */
function appendToArray(target, source) {
    Array.prototype.push.apply(target, source);

    return target;
}

/**
 * Shallow copies all the top-level items in `source` to `target`. Items from
 * `source` overwrite those in `target` if they have the same property name.
 *
 * @param  {object} target  The object to copy to.
 * @param  {object} source  The object to copy from.
 *
 * @return {object}         A pointer to `target`.
 */
function mergeObjects(target, source) {
    for (var prop in source) {
        if (!source.hasOwnProperty(prop)) {
            continue;
        }

        target[prop] = source[prop];
    }

    return target;
}

/**
 * Deep clones an object.
 *
 * @param  {object} original The object to be cloned.
 *
 * @return {object}          A clone of `original`.
 */
function clonePlainObject(original) {
    return JSON.parse(JSON.stringify(original));
}

/**
 * Attempts to get a value from an object based on the provided path. If the
 * path does not exists, undefined is returned.
 *
 * @param  {object} obj  The object you want to get a value from.
 * @param  {string} path The path in the object to look for said value.
 *
 * @return {any}         If the path is valid, then the value of that node is
 *                       returned. Otherwise, `undefined`.
 */
function deepGet(obj, path) {
    var parts = path.split('.');

    var curLocation = obj;

    while (parts.length) {
        var part = parts.shift();

        var index = null;
        var matchResult = part.match(REGEX_ARRAY_ACCESS);
        if (matchResult !== null) {
            part = matchResult[1];
            index = matchResult[2];
        }

        if (!curLocation.hasOwnProperty(part)
            || (index !== null && getType(curLocation[part][index]) === 'undefined')) {
            return undefined;
        }

        curLocation = index === null ? curLocation[part] : curLocation[part][index];
    }

    return curLocation;
}

/**
 * Set value at an arbitrary location in an object. If the location does not
 * exist, it will be created.
 *
 * @param  {object} obj   The object you want to set a value in.
 * @param  {string} path  The path you want to set the value at.
 * @param  {any}    value The value you want to set at the path.
 *
 * @return {object}       Returns a reference to `obj`.
 */
function deepSet(obj, path, value) {
    var parts = path.split('.');

    var curLocation = obj;

    while (parts.length) {
        var part = parts.shift();
        var matchResult = part.match(REGEX_ARRAY_ACCESS);

        if (matchResult !== null) {
            var index = matchResult[2];
            part = matchResult[1];

            if (!curLocation.hasOwnProperty(part)) {
                curLocation[part] = [];
                curLocation[part][index] = {};
            } else if (curLocation.hasOwnProperty(part)
                && getType(curLocation[part][index]) === 'undefined') {
                curLocation[part][index] = {};
            }

            if (parts.length > 0) {
                curLocation = curLocation[part][index];
            } else {
                curLocation[part][index] = value;
            }
        } else {
            if (!curLocation.hasOwnProperty(part)
                || typeof curLocation[part] !== 'object') {
                curLocation[part] = {};
            }

            if (parts.length > 0) {
                curLocation = curLocation[part];
            } else {
                curLocation[part] = value;
            }
        }
    }

    return obj;
}

/**
 * Returns a defer-style promise. Use should be minimized as normal Promises
 * are favored.
 *
 * @return {object} An object containing the promise, and its resolve/reject
 *                  functions.
 */
function defer() {
    var deferred = {};

    deferred.promise = new Promise(function (resolve, reject) {
        deferred.resolve = resolve;
        deferred.reject = reject;
    });

    return deferred;
}

function generateUniqueId(len, charSet) {
    len = len || 8;
    charSet = charSet || 'ALPHANUM';

    var uid = '';
    for (var i = 0; i < len; i++) {
        uid += CHARACTER_SETS[charSet].charAt(
            Math.floor(Math.random() * CHARACTER_SETS[charSet].length)
        );
    }

    return uid;
}

// =============================================================================
// EXPORTS /////////////////////////////////////////////////////////////////////
// -----------------------------------------------------------------------------

module.exports = {
    getType: getType,
    appendToArray: appendToArray,
    mergeObjects: mergeObjects,
    clonePlainObject: clonePlainObject,
    deepGet: deepGet,
    deepSet: deepSet,
    defer: defer,
    generateUniqueId: generateUniqueId
};

},{}],"/wrapper/tests/helpers/xhr-filter.js":[function(require,module,exports){
'use strict';

// =============================================================================
// IMPORTS /////////////////////////////////////////////////////////////////////
// -----------------------------------------------------------------------------

var Utilities = require('./utilities');

// =============================================================================
// MAIN ////////////////////////////////////////////////////////////////////////
// -----------------------------------------------------------------------------

var filters = {
    GooglePublisherTag: {
        ads: {
            method: 'GET',
            urlRegex: /.*securepubads\.g\.doubleclick\.net\/gampad\/ads.*/
        }
    },
    HeaderStats: {
        method: 'POST',
        urlRegex: /.*as(-sec)?\.casalemedia\.com\/headerstats.*/
    },
    IndexExchangeHtb: {
        cygnus: {
            method: 'GET',
            urlRegex: /.*as(-sec)?\.casalemedia\.com\/cygnus.*/
        },
        headerstats: {
            method: 'POST',
            urlRegex: /.*as(-sec)?\.casalemedia\.com\/headerstats.*/
        }
    },
    AdformHtb: {
        adform: {
            method: 'GET',
            urlRegex: /.*adx\.adform.net\/adx.*/
        }
    },
    OptimeraHtb: {
        amazonaws: {
            method: 'GET',
            urlRegex: /.*s3\.amazonaws.com\/optimera-client.*/
        }
    }
};

function XhrFilter() {
    var __enabledFilters;

    function run(method, url) {
        for (var fName in __enabledFilters) {
            if (!__enabledFilters.hasOwnProperty(fName)) {
                continue;
            }

            if (!__enabledFilters.hasOwnProperty(fName)
                || __enabledFilters[fName] === false) {
                continue;
            }

            var filter = Utilities.deepGet(filters, fName);

            if (filter.method === method
                && filter.urlRegex.test(url) === true) {
                return false;
            }
        }

        return true;
    }

    function capture(filterNames) {
        if (Utilities.getType(filterNames) === 'string') {
            filterNames = [filterNames];
        }

        for (var i = 0; i < filterNames.length; i++) {
            var fName = filterNames[i];

            if (Utilities.deepGet(filters, fName) === undefined) {
                throw Error('Unrecognized filter "' + fName + '"');
            }

            __enabledFilters[fName] = true;
        }
    }

    function register(partnerId, requestName, requestRegex) {
        if (!filters.hasOwnProperty(partnerId)) {
            filters[partnerId] = {};
        }
        filters[partnerId][requestName] = requestRegex;
    }

    (function __constructor() {
        __enabledFilters = {};
    })();

    return {
        run: run,
        capture: capture,
        register: register
    };
}

XhrFilter.install = function (fakeXMLHttpRequest) {
    var xhrFilter = XhrFilter();

    fakeXMLHttpRequest.useFilters = true;
    fakeXMLHttpRequest.addFilter(xhrFilter.run);

    return xhrFilter;
};

XhrFilter.filters = filters;

// =============================================================================
// EXPORTS /////////////////////////////////////////////////////////////////////
// -----------------------------------------------------------------------------

module.exports = XhrFilter;

},{"./utilities":"/wrapper/tests/helpers/utilities.js"}],"/wrapper/tests/specs/system/dfp-auto/partners/partner.spec.js":[function(require,module,exports){
'use strict';

// =============================================================================
// IMPORTS /////////////////////////////////////////////////////////////////////
// -----------------------------------------------------------------------------

var UrlParse = require('url-parse');

var BaseConfigs = require('../../../../helpers/base-configs');
var GptPageMaker = require('../../../../helpers/gpt-page-maker');
var Hacks = require('../../../../helpers/hacks');
var HeaderStatsAuditor = require('../../../../helpers/header-stats-auditor');
var RenderChecker = require('../../../../helpers/render-checker');
var XhrFilter = require('../../../../helpers/xhr-filter');
var Utility = require('../../../../helpers/utilities');
var PreGptShell = require('pre-gpt-shell.js');

// =============================================================================
// MAIN ////////////////////////////////////////////////////////////////////////
// -----------------------------------------------------------------------------

describe('System Tests: Partner', function () {

    var server = null;
    var xhrFilter = null;
    var gptPage = null;
    var baseConfig = null;
    var partnerId = window.testCases.getPartnerId();
    var callbackType = window.testCases.getCallbackType();
    var config = window.testCases.getConfig();
    var architecture = window.testCases.getArchitecture();
    var statsId = window.testCases.getStatsId();

    if (architecture === 'MRA') {

        config.mapping = {
            htSlotDesktopA: ['1']
        };

    } else {

        config.mapping = {
            htSlotDesktopA: ['1', '2']
        };

    }

    function setUpGSlots() {

        gptPage.addGSlot({
            adUnitPath: GptPageMaker.AD_UNIT_PATHS.SAFEFRAME_PRICE,
            sizes: [[1, 1]],
            divId: 'divIdA'
        });

    }

    beforeEach(function () {

        // Create a Sinon fake server. This is a high-level approach to managing
        // Sinon's fake XHR. By invoking this functions, both a management
        // interface (i.e. the server) is created, and the XHR is taken over.
        server = sinon.createFakeServer();
        server.autoRespond = true;

        // Add the filtering mechanism to the server's fake XHR instance so that
        // it only captures and fakes explicitly configured URLs.
        xhrFilter = XhrFilter.install(server.xhr);
        xhrFilter.register(partnerId, 'bidRequest', window.testCases.getBidRequestRegex());

        // SpaceCamp needs to be reset on every instantiation of the wrapper
        // because it is just an object. It carries values between test
        // cases.
        Hacks.resetSpaceCamp();

        // Clear localStorage artifacts from previous tests do not affect new ones.
        localStorage.clear();

        // Clear any CMP related data.
        delete window.__cmp;

        // Load the DfpAuto base configs for each test case.
        baseConfig = BaseConfigs.getConfig('DfpAuto');

        // Set the SRA/DIL flags explicitly for all the tests in this suite.
        baseConfig.gptLayer.enableSingleRequest = true;
        baseConfig.gptLayer.disableInitialLoad = false;

        // Set `window.configs` to point to the config because that is where the
        // wrapper loads the config from.
        window.configs = baseConfig.config;

        // Create a new instance of GPT for each test case.
        gptPage = GptPageMaker(window, {
            enableSingleRequest: true,
            disableInitialLoad: false
        });

        gptPage.ready().then(function () {

            gptPage.setPageLevelTargeting('PARTNER_ID', partnerId);
            gptPage.setPageLevelTargeting('EXPECTED_PRICE', '200');

        });

        // Block network requests that partner doesn't want to reach production endpoint
        if (window.testCases.getRequestsToBlock) {

            var requestsToBlock = window.testCases.getRequestsToBlock();
            for (var request in requestsToBlock) {

                if (requestsToBlock.hasOwnProperty(request)) {

                    xhrFilter.register(partnerId, request, requestsToBlock[request]);
                    xhrFilter.capture(partnerId + '.' + request);

                    server.respondWith(requestsToBlock[request].method,
                        requestsToBlock[request].urlRegex, function (xhr) {

                            xhr.respond(
                                200,
                                '',
                                '{}'
                            );

                        });

                }

            }

        }

        // Explicitly select requests that should be captured and handled by the
        // internal fake server.
        xhrFilter.capture(partnerId + '.bidRequest');
        xhrFilter.capture('HeaderStats');

        // Prevent headerstats requests going to production endpoint
        server.respondWith(XhrFilter.filters.HeaderStats.method,
            XhrFilter.filters.HeaderStats.urlRegex, function (xhr) {

                xhr.respond(
                    200,
                    '',
                    '{}'
                );

            });

        // Update the base configs for this test.
        baseConfig.partners.DynamicPartnerLoader.enabled = true;

        window.adapter = window.adapter || {};
        window.adapter.configs = config;

        // Instantiate wrapper.
        window.headertag = PreGptShell();

    });

    afterEach(function (done) {

        setTimeout(function () {

            // Clean up Sinon's fake server. Also explicitly reset
            // `server.xhr.filters` as otherwise the filters persist between tests.
            server.xhr.filters = [];
            server.restore();

            // Clean up any instantiated wrapper.
            window.headertag = null;

            // Clean up the GPT instance and any slots that were created in the DOM.
            gptPage.ready().then(function () {

                gptPage.unloadGpt();
                done();

            });

        }, 1000);

    });

    afterAll(function () {

        delete window.testCases;

    });

    it('should instantiate correctly', function () {

        expect(window.headertag[partnerId]).toBeDefined();

        // Check for bid callback function.
        if (callbackType === 'ID') {

            expect(window.headertag[partnerId].adResponseCallback).toBeDefined();

        } else if (callbackType === 'NAME') {

            expect(window.headertag[partnerId].adResponseCallbacks).toBeDefined();

        }

    });

    it('should construct bid request correctly', function (done) {

        // Load GPT library.
        gptPage.ready().then(function () {

            // Setup g-slots on the page.
            setUpGSlots();

            // Setup how the server handles the requests that are being filtered.
            server.respondWith(XhrFilter.filters[partnerId].bidRequest.method,
                XhrFilter.filters[partnerId].bidRequest.urlRegex, function (xhr) {

                    // Parse request URL into a manageable object.
                    var request = UrlParse(xhr.url, true);
                    request.body = xhr.requestBody;

                    window.testCases.validateBidRequest(request);

                    done();

                });

            // Start the bidding process.
            window.headertag.display('divIdA');

        });

    });

    if (window.testCases.validateBidRequestWithPrivacy) {

        it('should construct bid with privacy data correctly', function (done) {

            window.__cmp = function (a, b, cb) {

                cb({
                    gdprApplies: true,
                    consentData: 'TEST_GDPR_CONSENT_STRING'
                });

            };

            // CMP data is only read on load. Since the wrapper is loaded in the
            // `beforeEach`, it misses the `__cmp` that is set in this section,
            // so the wrapper needs to be re-instantiated.
            Hacks.resetSpaceCamp();
            window.headertag = PreGptShell();

            // Load GPT library.
            gptPage.ready().then(function () {

                // Setup g-slots on the page.
                setUpGSlots();

                // Setup how the server handles the requests that are being filtered.
                server.respondWith(XhrFilter.filters[partnerId].bidRequest.method,
                    XhrFilter.filters[partnerId].bidRequest.urlRegex, function (xhr) {

                        // Parse request URL into a manageable object.
                        var request = UrlParse(xhr.url, true);
                        request.body = xhr.requestBody;

                        window.testCases.validateBidRequestWithPrivacy(request);

                        done();

                    });

                // Start the bidding process.
                window.headertag.display('divIdA');

            });

        });

    }

    if (window.testCases.validateBidRequestWithAdSrvrOrg) {

        it('should construct bid with adsrvr.org data correctly', function (done) {

            // Setup adsrvr.org identity data.
            var now = (new Date()).getTime();
            localStorage.setItem(
                'IXWRAPPERAdserverOrgIp',
                JSON.stringify({
                    t: now,
                    d: {
                        response: 'match',
                        data: {
                            TDID: 'TEST_ADSRVR_ORG_STRING'
                        }
                    },
                    e: now + 604800000
                })
            );

            // Base config has `AdserverOrgIp` disabled and wrapper is already
            // by this point, so we need to enable it and reload the wrapper.
            baseConfig.config.Layers[2].configs.partners.AdserverOrgIp.enabled = true;

            Hacks.resetSpaceCamp();
            window.headertag = PreGptShell();

            // Load GPT library.
            gptPage.ready().then(function () {

                // Setup g-slots on the page.
                setUpGSlots();

                // Setup how the server handles the requests that are being filtered.
                server.respondWith(XhrFilter.filters[partnerId].bidRequest.method,
                    XhrFilter.filters[partnerId].bidRequest.urlRegex, function (xhr) {

                        // Parse request URL into a manageable object.
                        var request = UrlParse(xhr.url, true);
                        request.body = xhr.requestBody;

                        window.testCases.validateBidRequestWithAdSrvrOrg(request);

                        done();

                    });

                // Start the bidding process.
                window.headertag.display('divIdA');

            });

        });

    }

    describe('Open Market Bids', function () {

        it('should set targeting correctly', function (done) {

            // Load GPT library.
            gptPage.ready().then(function () {

                // Setup g-slots on the page.
                setUpGSlots();

                // Setup how the server handles the requests that are being filtered.
                server.respondWith(XhrFilter.filters[partnerId].bidRequest.method,
                    XhrFilter.filters[partnerId].bidRequest.urlRegex, function (xhr) {

                        // Parse request URL into a manageable object.
                        var request = UrlParse(xhr.url, true);
                        request.body = xhr.requestBody;
                        var response = window.testCases.getValidResponse(request);

                        xhr.respond(
                            200,
                            '',
                            response
                        );

                    });

                // Overwrite the `googletag.display` function to use as a trigger to know when
                // to start the check for the targeting.
                window.googletag.display = function () {

                    var gSlots = gptPage.getSlotsMap();

                    window.testCases.validateTargeting(gSlots.divIdA.getTargetingMap());

                    done();

                };

                // Start the bidding process.
                window.headertag.display('divIdA');

            });

        });

        it('should render ads correctly (SAFEFRAME_PRICE)', function (done) {

            // Load GPT library.
            gptPage.ready().then(function () {

                // Setup g-slots on the page.
                setUpGSlots();

                // Set up render checking mechanism that will trigger when two ads have rendered
                // using the post message method.
                var checker = RenderChecker.dfpPostMessageRender(1);
                checker.promise.then(function () {

                    done();

                });

                // Setup how the server handles the requests that are being filtered.
                server.respondWith(XhrFilter.filters[partnerId].bidRequest.method,
                    XhrFilter.filters[partnerId].bidRequest.urlRegex, function (xhr) {

                        // Parse request URL into a manageable object.
                        var request = UrlParse(xhr.url, true);
                        request.body = xhr.requestBody;

                        // Respond to the request.
                        var response = window.testCases.getValidResponse(request, checker.adm);

                        xhr.respond(
                            200,
                            '',
                            response
                        );

                    });

                // Start the bidding process.
                window.headertag.display('divIdA');

            });

        });

        if (window.testCases.getPixelRequests) {

            it('should fire render pixel correctly', function (done) {

                // Load GPT library.
                gptPage.ready().then(function () {

                    // Setup g-slots on the page.
                    setUpGSlots();

                    // Setup how the server handles the requests that are being filtered.
                    server.respondWith(XhrFilter.filters[partnerId].bidRequest.method,
                        XhrFilter.filters[partnerId].bidRequest.urlRegex, function (xhr) {

                            // Parse request URL into a manageable object.
                            var request = UrlParse(xhr.url, true);
                            request.body = xhr.requestBody;

                            // Respond to the request.
                            var response = window.testCases.getValidResponse(request);

                            xhr.respond(
                                200,
                                '',
                                response
                            );

                        });

                    var pixelRequests = window.testCases.getPixelRequests();
                    var promises = [];

                    for (var pixelRequest in pixelRequests) {

                        if (pixelRequests.hasOwnProperty(pixelRequest)) {

                            continue;

                        }

                        xhrFilter.register(partnerId, pixelRequest, pixelRequests[pixelRequest]);
                        xhrFilter.capture(partnerId + '.' + pixelRequest);

                        (function () {

                            var defer = Utility.defer();
                            server.respondWith(XhrFilter.filters[partnerId][pixelRequest].method,
                                XhrFilter.filters[partnerId][pixelRequest].urlRegex, function (xhr) {

                                    // Parse request URL into a manageable object.
                                    var pixel = UrlParse(xhr.url, true);

                                    defer.resolve(pixel);

                                });

                            promises.push(defer.promise);

                        })();

                    }

                    Promise.all(promises).then(function (values) {

                        window.testCases.validatePixelRequests(values);

                        done();

                    });

                    // Start the bidding process.
                    window.headertag.display('divIdA');

                });

            });

        }

        it('should log headerstats events correctly', function (done) {

            // Load GPT library.
            gptPage.ready().then(function () {

                // Setup g-slots on the page.
                setUpGSlots();

                // Setup how the server handles the requests that are being filtered.
                server.respondWith(XhrFilter.filters[partnerId].bidRequest.method,
                    XhrFilter.filters[partnerId].bidRequest.urlRegex, function (xhr) {

                        // Parse request URL into a manageable object.
                        var request = UrlParse(xhr.url, true);
                        request.body = xhr.requestBody;
                        var response = window.testCases.getValidResponse(request);

                        xhr.respond(
                            200,
                            '',
                            response
                        );

                    });

                server.respondWith(XhrFilter.filters.HeaderStats.method,
                    XhrFilter.filters.HeaderStats.urlRegex, function (xhr) {

                        // Check to see bid requests out is equal to bid responses/passes/errors/timeouts.
                        expect(HeaderStatsAuditor.isBalanced(xhr.requestBody)).toBe(true);

                        // Check to see that the correct HeaderStats events are set for this specific case.
                        var htSlotStats = HeaderStatsAuditor.parse(xhr.requestBody).htSlotStats;
                        var count = config.mapping.htSlotDesktopA.length;

                        expect(htSlotStats.htSlotDesktopAId[statsId].bid_requests).toBe(count);
                        expect(htSlotStats.htSlotDesktopAId[statsId].bid_responses).toBe(count);

                        done();

                    });

                // Start the bidding process.
                window.headertag.display('divIdA');

            });

        });

    });

    if (window.testCases.getValidResponseWithDeal) {

        describe('Private Market Bids', function () {

            it('should set targeting correctly', function (done) {

                // Load GPT library.
                gptPage.ready().then(function () {

                    // Setup g-slots on the page.
                    setUpGSlots();

                    // Setup how the server handles the requests that are being filtered.
                    server.respondWith(XhrFilter.filters[partnerId].bidRequest.method,
                        XhrFilter.filters[partnerId].bidRequest.urlRegex, function (xhr) {

                            // Parse request URL into a manageable object.
                            var request = UrlParse(xhr.url, true);
                            request.body = xhr.requestBody;
                            var response = window.testCases.getValidResponseWithDeal(request);

                            xhr.respond(
                                200,
                                '',
                                response
                            );

                        });

                    // Overwrite the `googletag.display` function to use as a trigger to know when
                    // to start the check for the targeting.
                    window.googletag.display = function () {

                        var gSlots = gptPage.getSlotsMap();

                        window.testCases.validateTargetingWithDeal(gSlots.divIdA.getTargetingMap());

                        done();

                    };

                    // Start the bidding process.
                    window.headertag.display('divIdA');

                });

            });

        });

    }

    describe('Passes', function () {

        it('should not set targeting', function (done) {

            // Load GPT library.
            gptPage.ready().then(function () {

                // Setup g-slots on the page.
                setUpGSlots();

                // Setup how the server handles the requests that are being filtered.
                server.respondWith(XhrFilter.filters[partnerId].bidRequest.method,
                    XhrFilter.filters[partnerId].bidRequest.urlRegex, function (xhr) {

                        var request = UrlParse(xhr.url, true);
                        request.body = xhr.requestBody;
                        var response = window.testCases.getPassResponse(request);

                        xhr.respond(
                            200,
                            '',
                            response
                        );

                    });

                // Overwrite the `googletag.display` function to use as a trigger to know when
                // to start the check for the targeting.
                window.googletag.display = function () {

                    var gSlots = gptPage.getSlotsMap();

                    expect(gSlots.divIdA.getTargetingMap()).toEqual({});

                    done();

                };

                // Start the bidding process.
                window.headertag.display('divIdA');

            });

        });

        it('should log headerstats events correctly', function (done) {

            // Load GPT library.
            gptPage.ready().then(function () {

                // Setup g-slots on the page.
                setUpGSlots();

                // Setup how the server handles the requests that are being filtered.
                server.respondWith(XhrFilter.filters[partnerId].bidRequest.method,
                    XhrFilter.filters[partnerId].bidRequest.urlRegex, function (xhr) {

                        var request = UrlParse(xhr.url, true);
                        request.body = xhr.requestBody;
                        var response = window.testCases.getPassResponse(request);

                        xhr.respond(
                            200,
                            '',
                            response
                        );

                    });

                server.respondWith(XhrFilter.filters.HeaderStats.method,
                    XhrFilter.filters.HeaderStats.urlRegex, function (xhr) {

                        // Check to see bid requests out is equal to bid responses/passes/errors/timeouts.
                        expect(HeaderStatsAuditor.isBalanced(xhr.requestBody)).toBe(true);

                        // Check to see that the correct HeaderStats events are set for this specific case.
                        var htSlotStats = HeaderStatsAuditor.parse(xhr.requestBody).htSlotStats;
                        var count = config.mapping.htSlotDesktopA.length;

                        expect(htSlotStats.htSlotDesktopAId[statsId].bid_requests).toBe(count);
                        expect(htSlotStats.htSlotDesktopAId[statsId].bid_passes).toBe(count);

                        done();

                    });

                // Start the bidding process.
                window.headertag.display('divIdA');

            });

        });

    });

});

},{"../../../../helpers/base-configs":"/wrapper/tests/helpers/base-configs.js","../../../../helpers/gpt-page-maker":"/wrapper/tests/helpers/gpt-page-maker.js","../../../../helpers/hacks":"/wrapper/tests/helpers/hacks.js","../../../../helpers/header-stats-auditor":"/wrapper/tests/helpers/header-stats-auditor.js","../../../../helpers/render-checker":"/wrapper/tests/helpers/render-checker.js","../../../../helpers/utilities":"/wrapper/tests/helpers/utilities.js","../../../../helpers/xhr-filter":"/wrapper/tests/helpers/xhr-filter.js","pre-gpt-shell.js":"/wrapper/src/shells/pre-gpt-shell.js","url-parse":4}],"/wrapper/tests/stubs/libs/bid-transformer.stub.js":[function(require,module,exports){

},{}],"/wrapper/tests/stubs/libs/browser.stub.js":[function(require,module,exports){
arguments[4]["/wrapper/tests/stubs/libs/bid-transformer.stub.js"][0].apply(exports,arguments)
},{"dup":"/wrapper/tests/stubs/libs/bid-transformer.stub.js"}],"/wrapper/tests/stubs/libs/cache.stub.js":[function(require,module,exports){
arguments[4]["/wrapper/tests/stubs/libs/bid-transformer.stub.js"][0].apply(exports,arguments)
},{"dup":"/wrapper/tests/stubs/libs/bid-transformer.stub.js"}],"/wrapper/tests/stubs/libs/classify.stub.js":[function(require,module,exports){
arguments[4]["/wrapper/tests/stubs/libs/bid-transformer.stub.js"][0].apply(exports,arguments)
},{"dup":"/wrapper/tests/stubs/libs/bid-transformer.stub.js"}],"/wrapper/tests/stubs/libs/command-queue.stub.js":[function(require,module,exports){
arguments[4]["/wrapper/tests/stubs/libs/bid-transformer.stub.js"][0].apply(exports,arguments)
},{"dup":"/wrapper/tests/stubs/libs/bid-transformer.stub.js"}],"/wrapper/tests/stubs/libs/config-validators.stub.js":[function(require,module,exports){
arguments[4]["/wrapper/tests/stubs/libs/bid-transformer.stub.js"][0].apply(exports,arguments)
},{"dup":"/wrapper/tests/stubs/libs/bid-transformer.stub.js"}],"/wrapper/tests/stubs/libs/constants.stub.js":[function(require,module,exports){
arguments[4]["/wrapper/tests/stubs/libs/bid-transformer.stub.js"][0].apply(exports,arguments)
},{"dup":"/wrapper/tests/stubs/libs/bid-transformer.stub.js"}],"/wrapper/tests/stubs/libs/device-type-checker.stub.js":[function(require,module,exports){
arguments[4]["/wrapper/tests/stubs/libs/bid-transformer.stub.js"][0].apply(exports,arguments)
},{"dup":"/wrapper/tests/stubs/libs/bid-transformer.stub.js"}],"/wrapper/tests/stubs/libs/gpt-helper.stub.js":[function(require,module,exports){
arguments[4]["/wrapper/tests/stubs/libs/bid-transformer.stub.js"][0].apply(exports,arguments)
},{"dup":"/wrapper/tests/stubs/libs/bid-transformer.stub.js"}],"/wrapper/tests/stubs/libs/header-tag-slot.stub.js":[function(require,module,exports){
arguments[4]["/wrapper/tests/stubs/libs/bid-transformer.stub.js"][0].apply(exports,arguments)
},{"dup":"/wrapper/tests/stubs/libs/bid-transformer.stub.js"}],"/wrapper/tests/stubs/libs/ht-slot-mapper.stub.js":[function(require,module,exports){
arguments[4]["/wrapper/tests/stubs/libs/bid-transformer.stub.js"][0].apply(exports,arguments)
},{"dup":"/wrapper/tests/stubs/libs/bid-transformer.stub.js"}],"/wrapper/tests/stubs/libs/network.stub.js":[function(require,module,exports){
arguments[4]["/wrapper/tests/stubs/libs/bid-transformer.stub.js"][0].apply(exports,arguments)
},{"dup":"/wrapper/tests/stubs/libs/bid-transformer.stub.js"}],"/wrapper/tests/stubs/libs/openrtb.stub.js":[function(require,module,exports){
arguments[4]["/wrapper/tests/stubs/libs/bid-transformer.stub.js"][0].apply(exports,arguments)
},{"dup":"/wrapper/tests/stubs/libs/bid-transformer.stub.js"}],"/wrapper/tests/stubs/libs/openrtb2_5.stub.js":[function(require,module,exports){
arguments[4]["/wrapper/tests/stubs/libs/bid-transformer.stub.js"][0].apply(exports,arguments)
},{"dup":"/wrapper/tests/stubs/libs/bid-transformer.stub.js"}],"/wrapper/tests/stubs/libs/scribe.stub.js":[function(require,module,exports){
arguments[4]["/wrapper/tests/stubs/libs/bid-transformer.stub.js"][0].apply(exports,arguments)
},{"dup":"/wrapper/tests/stubs/libs/bid-transformer.stub.js"}],"/wrapper/tests/stubs/libs/size.stub.js":[function(require,module,exports){
arguments[4]["/wrapper/tests/stubs/libs/bid-transformer.stub.js"][0].apply(exports,arguments)
},{"dup":"/wrapper/tests/stubs/libs/bid-transformer.stub.js"}],"/wrapper/tests/stubs/libs/system.stub.js":[function(require,module,exports){
arguments[4]["/wrapper/tests/stubs/libs/bid-transformer.stub.js"][0].apply(exports,arguments)
},{"dup":"/wrapper/tests/stubs/libs/bid-transformer.stub.js"}],"/wrapper/tests/stubs/libs/utilities.stub.js":[function(require,module,exports){
'use strict';

module.exports = {
    'utilities.js': {
        isArray: function () {
            return true;
        }
    }
};

},{}],"/wrapper/tests/stubs/libs/whoopsie.stub.js":[function(require,module,exports){
arguments[4]["/wrapper/tests/stubs/libs/bid-transformer.stub.js"][0].apply(exports,arguments)
},{"dup":"/wrapper/tests/stubs/libs/bid-transformer.stub.js"}],"/wrapper/tests/stubs/space-camp.stub.js":[function(require,module,exports){
'use strict';

module.exports = {
    'space-camp.js': {
        services: {
            EventsService: {
                emit: function () {}
            },
            RenderService: {
                registerPartner: function () {},
                registerAd: function () {}
            },
            TimerService: {
                addTimerCallback: function () {}
            }
        }
    }
};

},{}]},{},[]);
